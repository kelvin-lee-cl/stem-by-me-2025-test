# 📸 照片審核系統說明文檔

## 🎯 系統概述

本系統為 STEM-by-ME 2025 遊戲新增了人工檢查照片加分功能，主要針對「趣味親子打卡」關卡進行特殊處理。

## 🔄 主要變更

### 1. 關卡密碼提交邏輯修改 (`stem-by-me-2024/script.js`)

**修改前：**
- 所有關卡提交密碼後都會自動加分

**修改後：**
- **趣味親子打卡** 關卡：提交密碼後不自動加分，需要上傳照片並等待人工審核
- **其他關卡**：保持原有邏輯，提交密碼後自動加分

### 2. 照片上傳邏輯修改 (`stem-by-me-2024/script.js`)

**修改前：**
- 所有照片都上傳到 `photos` 集合

**修改後：**
- **趣味親子打卡** 照片：上傳到 `reviewPhotos` 集合，狀態為 `pending`
- **其他照片**：保持原有邏輯，上傳到 `photos` 集合

### 3. 管理員頁面新增功能 (`admin.html`)

#### 新增頁面區域
- **人工檢查照片加分** 區域
- 照片審核狀態篩選器
- 照片審核操作按鈕

#### 新增功能
- 查看待審核照片
- 通過/拒絕照片
- 手動輸入加分分數
- 查看照片詳情

## 📊 數據結構

### reviewPhotos 集合結構
```javascript
{
  userID: "玩家ID",
  fileName: "檔案名稱",
  originalName: "原始檔案名稱",
  timestamp: "上傳時間",
  size: "檔案大小",
  type: "檔案類型",
  dataURL: "Base64 圖片數據",
  locationCode: "位置代碼",
  locationName: "位置名稱",
  gameType: "遊戲類型",
  score: "建議分數",
  coordinates: { lat: 緯度, lng: 經度 },
  locationDescription: "位置描述",
  locationAddress: "位置地址",
  locationCategory: "位置類別",
  status: "pending|approved|rejected",
  suggestedScore: "建議分數",
  reviewedAt: "審核時間",
  reviewedBy: "審核者",
  approvedScore: "審核通過的分數",
  rejectedReason: "拒絕原因"
}
```

## 🎮 遊戲流程

### 趣味親子打卡關卡流程
1. 玩家選擇位置
2. 輸入正確的關卡代碼
3. 系統顯示「位置完成，等待人工審核加分」
4. 玩家上傳照片
5. 照片進入審核隊列
6. 管理員在 admin.html 中審核照片
7. 審核通過後玩家獲得加分

### 其他關卡流程
1. 玩家選擇位置
2. 輸入正確的關卡代碼
3. 系統自動加分並顯示成功訊息

## 🔧 管理員操作指南

### 1. 登入管理員頁面
- 訪問 `admin.html`
- 輸入管理員密碼：`ADMIN2025`

### 2. 查看待審核照片
- 點擊「🔧 管理員面板」按鈕
- 找到「🔍 人工檢查照片加分」區域
- 篩選器選擇「待審核」

### 3. 審核照片
- 查看照片詳情
- 輸入加分分數
- 點擊「通過」或「拒絕」按鈕
- 如果拒絕，需要輸入拒絕原因

### 4. 查看審核結果
- 篩選器選擇「已通過」或「已拒絕」
- 查看審核歷史記錄

## 🧪 測試功能

### 測試頁面
- 訪問 `test_photo_review.html`
- 測試 Firebase 連接
- 檢查位置數據
- 測試照片審核流程

### 測試步驟
1. 點擊「測試 Firebase 連接」
2. 點擊「檢查位置數據」
3. 點擊「測試照片審核流程」
4. 在 admin.html 中查看測試照片

## 📝 代碼修改詳情

### script.js 主要修改
1. **checkPassword() 函數**：新增親子打卡關卡的條件判斷
2. **uploadPhotoToFirebase() 函數**：新增照片類型判斷和審核隊列上傳

### admin.html 主要修改
1. **新增 CSS 樣式**：審核頁面的視覺設計
2. **新增 HTML 結構**：審核區域的頁面元素
3. **新增 JavaScript 函數**：
   - `loadReviewPhotos()`：載入審核照片
   - `displayReviewPhotos()`：顯示審核照片
   - `approvePhoto()`：通過照片
   - `rejectPhoto()`：拒絕照片
   - `showNotification()`：顯示通知

## ⚠️ 注意事項

1. **親子打卡關卡**：只有遊戲類型為「趣味親子打卡」的關卡才會進入審核流程
2. **照片審核**：管理員需要手動審核每張照片並決定加分分數
3. **數據同步**：審核通過後會自動更新玩家的總分數
4. **Firebase 連接**：確保 Firebase 配置正確且連接正常

## 🚀 部署說明

1. 確保所有文件都已更新
2. 檢查 Firebase 配置是否正確
3. 測試管理員登入功能
4. 測試照片上傳和審核流程
5. 確認數據同步正常

## 📞 技術支援

如有問題，請檢查：
1. Firebase 連接狀態
2. 瀏覽器控制台錯誤訊息
3. 網絡連接狀態
4. 文件路徑是否正確

---

**版本：** 1.0  
**更新日期：** 2025年1月  
**開發者：** STEM-by-ME 團隊
