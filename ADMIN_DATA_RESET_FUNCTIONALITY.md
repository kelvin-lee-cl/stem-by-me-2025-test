# Admin æ•¸æ“šé‡ç½®åŠŸèƒ½å¯¦ç¾

## æ¦‚è¿°
åœ¨ `admin.html` ä¸­å¯¦ç¾äº†å®Œæ•´çš„é‡ç½®æ‰€æœ‰ç©å®¶æ•¸æ“šå’Œæ¸…é™¤æ‰€æœ‰ç…§ç‰‡åŠŸèƒ½ï¼Œé€™äº›åŠŸèƒ½æœƒåŒæ­¥æ¸…é™¤ Firebase ä¸­çš„æ•¸æ“šä¸¦æ›´æ–° admin æ’è¡Œæ¦œå’Œç…§ç‰‡é¡¯ç¤ºã€‚

## åŠŸèƒ½å¯¦ç¾

### 1. é‡ç½®æ‰€æœ‰ç©å®¶æ•¸æ“š (`resetAllUsers`)

**åŠŸèƒ½æè¿°ï¼š**
- æ¸…é™¤ Firebase ä¸­ `gameScores` é›†åˆçš„æ‰€æœ‰åˆ†æ•¸è¨˜éŒ„
- æ¸…é™¤ Firebase ä¸­ `photos` é›†åˆçš„æ‰€æœ‰ç…§ç‰‡æ•¸æ“š
- é‡ç½®æœ¬åœ°æ•¸æ“šé™£åˆ—
- åŒæ­¥æ›´æ–°æ‰€æœ‰ç›¸é—œé¡¯ç¤º

**å¯¦ç¾ç´°ç¯€ï¼š**
```javascript
async function resetAllUsers() {
    // Firebase é€£æ¥æª¢æŸ¥
    if (!window.db) {
        showNotification('é‡ç½®å¤±æ•—', 'Firebase æœªé€£æ¥', 'error');
        return;
    }

    // é›™é‡ç¢ºèªå°è©±æ¡†
    if (!confirm('ç¢ºå®šè¦é‡ç½®æ‰€æœ‰ç©å®¶æ•¸æ“šå—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤éŠ·ï¼\n\né€™å°‡æ¸…é™¤ï¼š\nâ€¢ æ‰€æœ‰éŠæˆ²åˆ†æ•¸è¨˜éŒ„\nâ€¢ æ‰€æœ‰ç©å®¶çµ±è¨ˆæ•¸æ“š\nâ€¢ æ’è¡Œæ¦œæ•¸æ“š')) {
        return;
    }

    // æ¸…é™¤ gameScores é›†åˆ
    const scoresSnapshot = await window.db.collection('gameScores').get();
    const deletePromises = scoresSnapshot.docs.map(doc => doc.ref.delete());
    await Promise.all(deletePromises);

    // æ¸…é™¤ photos é›†åˆ
    const photosSnapshot = await window.db.collection('photos').get();
    const deletePhotoPromises = photosSnapshot.docs.map(doc => doc.ref.delete());
    await Promise.all(deletePhotoPromises);

    // é‡ç½®æœ¬åœ°æ•¸æ“š
    allScores = [];
    allPhotos = [];

    // æ›´æ–°é¡¯ç¤º
    updateStatistics();
    displayScores();
    loadAllPhotos();
    loadWinnersList();

    // æˆåŠŸé€šçŸ¥
    showNotification('é‡ç½®æˆåŠŸ', `å·²æ¸…é™¤ ${scoresSnapshot.size} æ¢åˆ†æ•¸è¨˜éŒ„å’Œ ${photosSnapshot.size} å¼µç…§ç‰‡`, 'success');
}
```

### 2. æ¸…é™¤æ‰€æœ‰ç…§ç‰‡ (`clearAllPhotos`)

**åŠŸèƒ½æè¿°ï¼š**
- æ¸…é™¤ Firebase ä¸­ `photos` é›†åˆçš„æ‰€æœ‰ç…§ç‰‡æ•¸æ“š
- é‡ç½®æœ¬åœ°ç…§ç‰‡æ•¸æ“šé™£åˆ—
- åŒæ­¥æ›´æ–°ç…§ç‰‡é¡¯ç¤ºå’Œçµ±è¨ˆ

**å¯¦ç¾ç´°ç¯€ï¼š**
```javascript
async function clearAllPhotos() {
    // Firebase é€£æ¥æª¢æŸ¥
    if (!window.db) {
        showNotification('æ¸…é™¤å¤±æ•—', 'Firebase æœªé€£æ¥', 'error');
        return;
    }

    // é›™é‡ç¢ºèªå°è©±æ¡†
    if (!confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰ç…§ç‰‡å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤éŠ·ï¼\n\né€™å°‡æ¸…é™¤ï¼š\nâ€¢ æ‰€æœ‰ä¸Šå‚³çš„ç…§ç‰‡\nâ€¢ ç…§ç‰‡ç›¸é—œçš„çµ±è¨ˆæ•¸æ“š')) {
        return;
    }

    // æ¸…é™¤ photos é›†åˆ
    const photosSnapshot = await window.db.collection('photos').get();
    const deletePromises = photosSnapshot.docs.map(doc => doc.ref.delete());
    await Promise.all(deletePromises);

    // é‡ç½®æœ¬åœ°ç…§ç‰‡æ•¸æ“š
    allPhotos = [];

    // æ›´æ–°é¡¯ç¤º
    loadAllPhotos();
    updateStatistics();

    // æˆåŠŸé€šçŸ¥
    showNotification('æ¸…é™¤æˆåŠŸ', `å·²æ¸…é™¤ ${photosSnapshot.size} å¼µç…§ç‰‡`, 'success');
}
```

## å®‰å…¨ç‰¹æ€§

### 1. é›™é‡ç¢ºèªæ©Ÿåˆ¶
- æ¯å€‹é‡ç½®/æ¸…é™¤æ“ä½œéƒ½éœ€è¦ç”¨æˆ¶äºŒæ¬¡ç¢ºèª
- ç¢ºèªå°è©±æ¡†è©³ç´°èªªæ˜å°‡è¦æ¸…é™¤çš„å…§å®¹
- é˜²æ­¢æ„å¤–æ“ä½œ

### 2. Firebase é€£æ¥æª¢æŸ¥
- åœ¨åŸ·è¡Œæ“ä½œå‰æª¢æŸ¥ Firebase é€£æ¥ç‹€æ…‹
- å¦‚æœæœªé€£æ¥ï¼Œé¡¯ç¤ºéŒ¯èª¤é€šçŸ¥ä¸¦åœæ­¢æ“ä½œ

### 3. éŒ¯èª¤è™•ç†
- å®Œæ•´çš„ try-catch éŒ¯èª¤è™•ç†
- è©³ç´°çš„éŒ¯èª¤è¨Šæ¯é¡¯ç¤º
- æ§åˆ¶å°æ—¥èªŒè¨˜éŒ„

## åŒæ­¥æ›´æ–°æ©Ÿåˆ¶

### é‡ç½®æ‰€æœ‰ç©å®¶æ•¸æ“šå¾Œæœƒæ›´æ–°ï¼š
1. **çµ±è¨ˆæ•¸æ“š** (`updateStatistics()`)
   - ç¸½ç©å®¶æ•¸
   - æ´»èºç©å®¶æ•¸
   - å®ŒæˆéŠæˆ²æ•¸
   - ç¸½åˆ†æ•¸

2. **åˆ†æ•¸é¡¯ç¤º** (`displayScores()`)
   - åˆ†æ•¸åˆ—è¡¨
   - ç¯©é¸åŠŸèƒ½
   - æ’åºåŠŸèƒ½

3. **ç…§ç‰‡é¡¯ç¤º** (`loadAllPhotos()`)
   - ç…§ç‰‡ç¶²æ ¼
   - ç…§ç‰‡çµ±è¨ˆ
   - æ’åºé¸é …

4. **æ’è¡Œæ¦œ** (`loadWinnersList()`)
   - å‰äº”åç©å®¶
   - ç©å®¶çµ±è¨ˆ
   - æœ€æ–°éŠæˆ²ä¿¡æ¯

### æ¸…é™¤æ‰€æœ‰ç…§ç‰‡å¾Œæœƒæ›´æ–°ï¼š
1. **ç…§ç‰‡é¡¯ç¤º** (`loadAllPhotos()`)
   - æ¸…ç©ºç…§ç‰‡ç¶²æ ¼
   - é‡ç½®ç…§ç‰‡çµ±è¨ˆ

2. **çµ±è¨ˆæ•¸æ“š** (`updateStatistics()`)
   - æ›´æ–°ç…§ç‰‡ç›¸é—œçµ±è¨ˆ

## ç”¨æˆ¶é«”é©—

### 1. é€²åº¦é€šçŸ¥
- æ“ä½œé–‹å§‹æ™‚é¡¯ç¤ºã€Œé‡ç½®ä¸­ã€æˆ–ã€Œæ¸…é™¤ä¸­ã€é€šçŸ¥
- æ“ä½œå®Œæˆå¾Œé¡¯ç¤ºæˆåŠŸé€šçŸ¥å’Œæ¸…é™¤æ•¸é‡

### 2. è©³ç´°åé¥‹
- æˆåŠŸé€šçŸ¥åŒ…å«æ¸…é™¤çš„è¨˜éŒ„æ•¸é‡
- éŒ¯èª¤é€šçŸ¥åŒ…å«å…·é«”éŒ¯èª¤è¨Šæ¯

### 3. æ§åˆ¶å°æ—¥èªŒ
- è©³ç´°çš„æ“ä½œæ—¥èªŒè¨˜éŒ„
- ä¾¿æ–¼èª¿è©¦å’Œç›£æ§

## æŠ€è¡“å¯¦ç¾

### 1. éåŒæ­¥æ“ä½œ
- ä½¿ç”¨ `async/await` è™•ç† Firebase æ“ä½œ
- ä¸¦è¡Œåˆªé™¤å¤šå€‹æ–‡æª”ä»¥æé«˜æ•ˆç‡

### 2. æ‰¹é‡åˆªé™¤
- ä½¿ç”¨ `Promise.all()` ä¸¦è¡ŒåŸ·è¡Œåˆªé™¤æ“ä½œ
- æé«˜å¤§é‡æ•¸æ“šåˆªé™¤çš„æ•ˆç‡

### 3. æ•¸æ“šä¸€è‡´æ€§
- åŒæ™‚æ¸…é™¤ Firebase å’Œæœ¬åœ°æ•¸æ“š
- ç¢ºä¿æ•¸æ“šåŒæ­¥

## ä½¿ç”¨æ–¹å¼

### é‡ç½®æ‰€æœ‰ç©å®¶æ•¸æ“šï¼š
1. é»æ“Šã€ŒğŸ”„ é‡ç½®æ‰€æœ‰ç©å®¶æ•¸æ“šã€æŒ‰éˆ•
2. åœ¨ç¢ºèªå°è©±æ¡†ä¸­é»æ“Šã€Œç¢ºå®šã€
3. ç­‰å¾…æ“ä½œå®Œæˆ

### æ¸…é™¤æ‰€æœ‰ç…§ç‰‡ï¼š
1. é»æ“Šã€ŒğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰ç…§ç‰‡ã€æŒ‰éˆ•
2. åœ¨ç¢ºèªå°è©±æ¡†ä¸­é»æ“Šã€Œç¢ºå®šã€
3. ç­‰å¾…æ“ä½œå®Œæˆ

## æ³¨æ„äº‹é …

1. **ä¸å¯æ’¤éŠ·æ“ä½œ**ï¼šé€™äº›æ“ä½œæœƒæ°¸ä¹…åˆªé™¤æ•¸æ“šï¼Œç„¡æ³•æ¢å¾©
2. **éœ€è¦ Firebase é€£æ¥**ï¼šæ“ä½œéœ€è¦ç©©å®šçš„ Firebase é€£æ¥
3. **å¤§é‡æ•¸æ“šè™•ç†**ï¼šå°æ–¼å¤§é‡æ•¸æ“šï¼Œæ“ä½œå¯èƒ½éœ€è¦ä¸€äº›æ™‚é–“
4. **æ¬Šé™è¦æ±‚**ï¼šéœ€è¦é©ç•¶çš„ Firebase æ¬Šé™æ‰èƒ½åŸ·è¡Œåˆªé™¤æ“ä½œ

## Firebase é€£æ¥å•é¡Œè¨ºæ–·

### å¸¸è¦‹å•é¡Œï¼šã€ŒFirebase æœªé€£æ¥ã€

å¦‚æœé‡åˆ°ã€ŒFirebase æœªé€£æ¥ã€éŒ¯èª¤ï¼Œè«‹æŒ‰ä»¥ä¸‹æ­¥é©Ÿè¨ºæ–·ï¼š

#### 1. ä½¿ç”¨è¨ºæ–·å·¥å…·
æ‰“é–‹ `firebase-connection-test.html` é é¢é€²è¡Œå®Œæ•´è¨ºæ–·ï¼š
- æ¸¬è©¦ Firebase SDK è¼‰å…¥
- æ¸¬è©¦ Firebase åˆå§‹åŒ–
- æ¸¬è©¦ Firebase é€£æ¥
- æ¸¬è©¦æ•¸æ“šåº«æ“ä½œ
- åŸ·è¡Œå®Œæ•´è¨ºæ–·

#### 2. æª¢æŸ¥æ§åˆ¶å°æ—¥èªŒ
åœ¨ç€è¦½å™¨é–‹ç™¼è€…å·¥å…·ä¸­æŸ¥çœ‹æ§åˆ¶å°æ—¥èªŒï¼š
```javascript
// æª¢æŸ¥ Firebase åˆå§‹åŒ–ç‹€æ…‹
console.log('window.db:', window.db);
console.log('firebase:', typeof firebase);
console.log('firebase.firestore:', typeof firebase.firestore);
```

#### 3. å¸¸è¦‹è§£æ±ºæ–¹æ¡ˆ

**å•é¡Œ 1ï¼šFirebase SDK æœªè¼‰å…¥**
- æª¢æŸ¥ç¶²çµ¡é€£æ¥
- ç¢ºèª Firebase SDK è…³æœ¬æ­£ç¢ºè¼‰å…¥
- æª¢æŸ¥ç€è¦½å™¨æ§åˆ¶å°æ˜¯å¦æœ‰ 404 éŒ¯èª¤

**å•é¡Œ 2ï¼šFirebase åˆå§‹åŒ–å¤±æ•—**
- æª¢æŸ¥ `firebaseConfig` é…ç½®æ˜¯å¦æ­£ç¢º
- ç¢ºèª API Key å’Œé …ç›® ID æœ‰æ•ˆ
- æª¢æŸ¥ Firebase é …ç›®æ˜¯å¦å•Ÿç”¨

**å•é¡Œ 3ï¼šFirestore æ¬Šé™å•é¡Œ**
- æª¢æŸ¥ Firestore å®‰å…¨è¦å‰‡
- ç¢ºèªè¦å‰‡å…è¨±è®€å¯«æ“ä½œ
- æª¢æŸ¥é …ç›®è¨­ç½®ä¸­çš„ API é™åˆ¶

**å•é¡Œ 4ï¼šç¶²çµ¡é€£æ¥å•é¡Œ**
- æª¢æŸ¥ç¶²çµ¡é€£æ¥ç‹€æ…‹
- ç¢ºèªé˜²ç«ç‰†è¨­ç½®
- æª¢æŸ¥ä»£ç†è¨­ç½®

#### 4. å¢å¼·è¨ºæ–·åŠŸèƒ½

åœ¨ `admin.html` ä¸­å·²æ·»åŠ ï¼š
- `checkFirebaseConnection()` å‡½æ•¸ï¼šè©³ç´°æª¢æŸ¥ Firebase é€£æ¥ç‹€æ…‹
- å¢å¼·çš„éŒ¯èª¤è¨Šæ¯ï¼šæä¾›æ›´å…·é«”çš„éŒ¯èª¤ä¿¡æ¯
- è©³ç´°çš„æ§åˆ¶å°æ—¥èªŒï¼šä¾¿æ–¼èª¿è©¦å•é¡Œ

#### 5. æ¸¬è©¦é€£æ¥
```javascript
// æ‰‹å‹•æ¸¬è©¦ Firebase é€£æ¥
function testFirebaseConnection() {
    if (!window.db) {
        console.error('âŒ window.db is null or undefined');
        return false;
    }
    
    window.db.collection('test').doc('test').get().then(() => {
        console.log('âœ… Firebase connection test successful');
    }).catch(error => {
        console.error('âŒ Firebase connection test failed:', error);
    });
}
```

## ç›¸é—œæ–‡ä»¶

- `admin.html` - ä¸»è¦å¯¦ç¾æ–‡ä»¶
- `firebase-connection-test.html` - Firebase é€£æ¥è¨ºæ–·å·¥å…·
- `FIREBASE_UPLOAD_STRUCTURE.md` - Firebase æ•¸æ“šçµæ§‹æ–‡æª”
- `ADMIN_FIREBASE_FORMAT_CONSISTENCY.md` - Admin Firebase æ ¼å¼ä¸€è‡´æ€§æ–‡æª”
