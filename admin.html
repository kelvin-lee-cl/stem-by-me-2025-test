<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STEM-by-ME 2025 - ç®¡ç†å“¡é é¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');

        body {
            font-family: 'Orbitron', 'Courier New', monospace;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 25%, #16213e 50%, #0f3460 75%, #533483 100%);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .container {
            background: rgba(10, 10, 10, 0.9);
            border: 2px solid #00ffff;
            border-radius: 0;
            box-shadow:
                0 0 20px rgba(0, 255, 255, 0.5),
                inset 0 0 20px rgba(0, 255, 255, 0.1);
            overflow: hidden;
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            backdrop-filter: blur(10px);
        }

        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, #00ffff, transparent);
            animation: scan 3s linear infinite;
        }

        @keyframes scan {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }

        .header {
            background: linear-gradient(135deg, #ff0080 0%, #8000ff 50%, #0080ff 100%);
            color: #ffffff;
            padding: 30px;
            text-align: center;
            position: relative;
            border-bottom: 3px solid #00ffff;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
            animation: shimmer 2s ease-in-out infinite;
        }

        @keyframes shimmer {

            0%,
            100% {
                transform: translateX(-100%);
            }

            50% {
                transform: translateX(100%);
            }
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 3px;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .content {
            padding: 40px;
            max-width: 100%;
            background: rgba(0, 0, 0, 0.8);
            color: #00ffff;
        }

        /* Login Form Styles */
        .login-form {
            max-width: 400px;
            margin: 0 auto;
            text-align: center;
            background: rgba(0, 0, 0, 0.7);
            padding: 30px;
            border: 2px solid #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #000000;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
        }

        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #00ffff;
            border-radius: 0;
            font-size: 16px;
            background: rgba(0, 0, 0, 0.8);
            color: #00ffff;
            font-family: 'Orbitron', monospace;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
        }

        .form-group input:focus {
            outline: none;
            border-color: #ff0080;
            box-shadow: 0 0 20px rgba(255, 0, 128, 0.5);
            background: rgba(0, 0, 0, 0.9);
        }

        .form-group input::placeholder {
            color: rgba(0, 255, 255, 0.5);
        }

        .login-btn {
            background: linear-gradient(135deg, #ff0080 0%, #8000ff 100%);
            color: #ffffff;
            border: 2px solid #00ffff;
            padding: 15px 30px;
            border-radius: 0;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(255, 0, 128, 0.5);
        }

        .login-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }



        .error-message {
            background: rgba(255, 0, 0, 0.2);
            color: #ff0080;
            padding: 15px;
            border: 2px solid #ff0080;
            border-radius: 0;
            margin-bottom: 20px;
            display: none;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 0 15px rgba(255, 0, 128, 0.5);
            font-weight: bold;
        }

        /* Admin Dashboard Styles */
        .admin-dashboard {
            display: none;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 25px;
            border-bottom: 3px solid #00ffff;
            position: relative;
        }

        .dashboard-header::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, #00ffff, #ff0080, #8000ff, #00ffff);
            animation: borderGlow 3s linear infinite;
        }

        @keyframes borderGlow {
            0% {
                background-position: 0% 50%;
            }

            100% {
                background-position: 100% 50%;
            }
        }

        .dashboard-header h2 {
            font-size: 2.2em;
            color: #00ffff;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
            font-weight: 900;
        }

        .logout-btn {
            background: rgba(255, 0, 0, 0.2);
            color: #ff0080;
            border: 2px solid #ff0080;
            padding: 12px 24px;
            border-radius: 0;
            cursor: pointer;
            font-weight: bold;
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(255, 0, 128, 0.3);
        }



        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.8);
            padding: 25px;
            border-radius: 0;
            text-align: center;
            border: 2px solid #00ffff;
            box-shadow:
                0 0 20px rgba(0, 255, 255, 0.3),
                inset 0 0 20px rgba(0, 255, 255, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }



        .stat-number {
            font-size: 2.5em;
            font-weight: 900;
            color: #00ffff;
            margin-bottom: 10px;
            text-shadow: 0 0 15px rgba(0, 255, 255, 0.8);
            position: relative;
            z-index: 1;
        }

        .stat-label {
            color: #ffffff;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            z-index: 1;
        }

        .filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 0;
            border: 2px solid #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
            position: relative;
        }

        .filters::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #00ffff, #ff0080, #8000ff, #00ffff);
            animation: borderGlow 3s linear infinite;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .filter-group label {
            font-weight: bold;
            color: #00ffff;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
        }

        .filter-group select,
        .filter-group input {
            padding: 12px 15px;
            border: 2px solid #00ffff;
            border-radius: 0;
            font-size: 14px;
            background: rgba(0, 0, 0, 0.8);
            color: #00ffff;
            font-family: 'Orbitron', monospace;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
        }

        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: #ff0080;
            box-shadow: 0 0 20px rgba(255, 0, 128, 0.5);
            background: rgba(0, 0, 0, 0.9);
        }

        .filter-group select option {
            background: #000;
            color: #00ffff;
        }

        .refresh-btn {
            background: rgba(40, 167, 69, 0.2);
            color: #00ff00;
            border: 2px solid #00ff00;
            padding: 12px 20px;
            border-radius: 0;
            cursor: pointer;
            font-weight: bold;
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .refresh-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 0, 0.2), transparent);
            transition: left 0.5s;
        }



        .export-btn {
            background: rgba(23, 162, 184, 0.2);
            color: #00ffff;
            border: 2px solid #00ffff;
            padding: 12px 20px;
            border-radius: 0;
            cursor: pointer;
            font-weight: bold;
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
        }

        .export-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }



        .status-btn {
            background: rgba(111, 66, 193, 0.2);
            color: #8000ff;
            border: 2px solid #8000ff;
            padding: 12px 20px;
            border-radius: 0;
            cursor: pointer;
            font-weight: bold;
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(128, 0, 255, 0.3);
            position: relative;
            overflow: hidden;
        }

        .status-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(128, 0, 255, 0.2), transparent);
            transition: left 0.5s;
        }



        .info-btn {
            background: rgba(32, 201, 151, 0.2);
            color: #20c997;
            border: 2px solid #20c997;
            padding: 12px 20px;
            border-radius: 0;
            cursor: pointer;
            font-weight: bold;
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(32, 201, 151, 0.3);
            position: relative;
            overflow: hidden;
        }

        .info-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(32, 201, 151, 0.2), transparent);
            transition: left 0.5s;
        }



        /* Status Modal Styles */
        .status-modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
        }

        .status-modal-content {
            background: rgba(0, 0, 0, 0.95);
            margin: 5% auto;
            padding: 30px;
            border-radius: 0;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            border: 2px solid #00ffff;
            box-shadow:
                0 0 30px rgba(0, 255, 255, 0.5),
                inset 0 0 30px rgba(0, 255, 255, 0.1);
            position: relative;
        }

        .status-modal-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #00ffff, #ff0080, #8000ff, #00ffff);
            animation: borderGlow 3s linear infinite;
        }

        .status-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #00ffff;
        }

        .status-modal-header h3 {
            color: #00ffff;
            font-size: 1.5em;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
        }

        .status-modal-close {
            background: rgba(255, 0, 0, 0.2);
            color: #ff0080;
            border: 2px solid #ff0080;
            padding: 10px 15px;
            border-radius: 0;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(255, 0, 128, 0.3);
        }



        /* Status Summary Card */
        .status-summary {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 4px solid #667eea;
        }

        .status-summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .status-summary-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
        }

        .status-summary-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 10px;
        }

        .status-stat {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-stat-label {
            font-size: 0.9em;
            color: #666;
        }

        .status-stat-value {
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
        }

        .status-stat-success {
            background: #d4edda;
            color: #155724;
        }

        .status-stat-warning {
            background: #fff3cd;
            color: #856404;
        }

        .status-stat-error {
            background: #f8d7da;
            color: #721c24;
        }

        .status-stat-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        /* Status Table */
        .status-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .status-table th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: bold;
        }

        .status-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
        }



        .status-table tr:last-child td {
            border-bottom: none;
        }

        .status-badge {
            padding: 6px 16px;
            border-radius: 0;
            font-weight: bold;
            font-size: 0.8em;
            text-align: center;
            min-width: 80px;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: 1px solid;
            box-shadow: 0 0 10px;
        }

        .status-badge-success {
            background: rgba(0, 255, 0, 0.2);
            color: #00ff00;
            border-color: #00ff00;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
        }

        .status-badge-error {
            background: rgba(255, 0, 0, 0.2);
            color: #ff0080;
            border-color: #ff0080;
            box-shadow: 0 0 10px rgba(255, 0, 128, 0.3);
        }

        .status-badge-warning {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
            border-color: #ffc107;
            box-shadow: 0 0 10px rgba(255, 193, 7, 0.3);
        }

        .status-badge-info {
            background: rgba(0, 255, 255, 0.2);
            color: #00ffff;
            border-color: #00ffff;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
        }

        .status-details {
            font-size: 0.9em;
            color: #666;
            font-style: italic;
            margin-top: 5px;
        }

        /* Legend Styles */
        .legend-section {
            margin-bottom: 30px;
        }

        .legend-section h4 {
            color: #ffffff;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .legend-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .legend-item p {
            margin: 0;
            font-size: 0.9em;
            color: #666;
        }

        .legend-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .legend-list-item {
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .legend-list-item strong {
            color: #333;
            display: block;
            margin-bottom: 5px;
        }

        .legend-list-item p {
            margin: 0;
            font-size: 0.9em;
            color: #666;
        }

        .scores-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(0, 0, 0, 0.9);
            border-radius: 0;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
            border: 2px solid #00ffff;
        }

        .scores-table th {
            background: linear-gradient(135deg, #ff0080 0%, #8000ff 50%, #0080ff 100%);
            color: #ffffff;
            padding: 18px 20px;
            text-align: left;
            font-weight: bold;
            font-size: 1.1em;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
            border-bottom: 2px solid #00ffff;
        }

        .scores-table td {
            padding: 16px 20px;
            border-bottom: 1px solid rgba(0, 255, 255, 0.3);
            font-size: 1em;
            color: #00ffff;
            background: rgba(0, 0, 0, 0.7);
        }



        .status-win {
            background: rgba(0, 255, 0, 0.2);
            color: #00ff00;
            padding: 6px 12px;
            border-radius: 0;
            font-size: 0.8em;
            font-weight: bold;
            border: 1px solid #00ff00;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
        }

        .status-lose {
            background: rgba(255, 0, 0, 0.2);
            color: #ff0080;
            padding: 6px 12px;
            border-radius: 0;
            font-size: 0.8em;
            font-weight: bold;
            border: 1px solid #ff0080;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 0 10px rgba(255, 0, 128, 0.3);
        }

        .loading {
            text-align: center;
            padding: 60px;
            color: #00ffff;
            font-size: 1.1em;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 0;
            border: 2px dashed #00ffff;
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
            position: relative;
        }

        .loading::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 40px;
            height: 40px;
            margin: -20px 0 0 -20px;
            border: 3px solid transparent;
            border-top: 3px solid #00ffff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .no-data {
            text-align: center;
            padding: 60px;
            color: #ff0080;
            font-style: italic;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 0;
            border: 2px dashed #ff0080;
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 0 0 20px rgba(255, 0, 128, 0.3);
        }

        .dashboard-section {
            margin-bottom: 50px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 0;
            padding: 30px;
            border: 2px solid #00ffff;
            box-shadow:
                0 0 20px rgba(0, 255, 255, 0.3),
                inset 0 0 20px rgba(0, 255, 255, 0.1);
            position: relative;
        }

        .dashboard-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #00ffff, #ff0080, #8000ff, #00ffff);
            animation: borderGlow 3s linear infinite;
        }

        .dashboard-section h3 {
            font-size: 1.5em;
            font-weight: bold;
            color: #00ffff;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #00ffff;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                margin: 0;
                border-radius: 0;
            }

            .content {
                padding: 20px;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .dashboard-header h2 {
                font-size: 1.6em;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .stat-card {
                padding: 20px;
            }

            .filters {
                grid-template-columns: 1fr;
                gap: 15px;
                padding: 20px;
            }

            .dashboard-section {
                padding: 20px;
                margin-bottom: 30px;
            }

            .dashboard-section h3 {
                font-size: 1.3em;
            }

            .scores-table {
                font-size: 0.9em;
            }

            .scores-table th,
            .scores-table td {
                padding: 12px 15px;
            }

            .status-modal-content {
                margin: 10px;
                width: calc(100% - 20px);
                max-width: none;
                padding: 20px;
            }

            .status-summary-stats {
                flex-direction: column;
                gap: 10px;
            }

            .status-table {
                font-size: 0.9em;
            }

            .status-table th,
            .status-table td {
                padding: 10px 12px;
            }

            .legend-grid {
                grid-template-columns: 1fr;
            }

            .legend-item {
                flex-direction: column;
                text-align: center;
            }

            .loading,
            .no-data {
                padding: 40px 20px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ® STEM-by-ME 2025</h1>
            <p>ç®¡ç†å“¡æ§åˆ¶å° / Admin Dashboard</p>
        </div>

        <div class="content">
            <!-- Login Form -->
            <div id="loginForm" class="login-form">
                <h2 style="margin-bottom: 30px; color: #333;">ç®¡ç†å“¡ç™»å…¥</h2>
                <div id="errorMessage" class="error-message"></div>
                <div class="form-group">
                    <label for="adminPassword">ç®¡ç†å“¡å¯†ç¢¼</label>
                    <input type="password" id="adminPassword" placeholder="è«‹è¼¸å…¥ç®¡ç†å“¡å¯†ç¢¼">
                </div>
                <button class="login-btn" onclick="login()">ç™»å…¥</button>
            </div>

            <!-- Admin Dashboard -->
            <div id="adminDashboard" class="admin-dashboard">
                <div class="dashboard-header">
                    <h2>ğŸ“Š ç©å®¶åˆ†æ•¸çµ±è¨ˆ</h2>
                    <button class="logout-btn" onclick="logout()">ç™»å‡º</button>
                </div>

                <!-- Statistics -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalPlayers">0</div>
                        <div class="stat-label">ç¸½ç©å®¶æ•¸</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalGames">0</div>
                        <div class="stat-label">ç¸½éŠæˆ²æ¬¡æ•¸</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalWins">0</div>
                        <div class="stat-label">ç¸½å‹åˆ©æ¬¡æ•¸</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="avgScore">0</div>
                        <div class="stat-label">å¹³å‡åˆ†æ•¸</div>
                    </div>
                </div>

                <!-- Filters -->
                <div class="filters">
                    <div class="filter-group">
                        <label>éŠæˆ²ç¯©é¸</label>
                        <select id="gameFilter">
                            <option value="">æ‰€æœ‰éŠæˆ²</option>
                            <option value="game1">éŠæˆ² 1</option>
                            <option value="game2">éŠæˆ² 2</option>
                            <option value="game3">éŠæˆ² 3</option>
                            <option value="game4">éŠæˆ² 4</option>
                            <option value="game5">éŠæˆ² 5</option>
                            <option value="game6">éŠæˆ² 6</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>ç‹€æ…‹ç¯©é¸</label>
                        <select id="statusFilter">
                            <option value="">æ‰€æœ‰ç‹€æ…‹</option>
                            <option value="win">å‹åˆ©</option>
                            <option value="lose">å¤±æ•—</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>ç©å®¶åç¨±</label>
                        <input type="text" id="playerFilter" placeholder="æœå°‹ç©å®¶åç¨±">
                    </div>
                    <div class="filter-group">
                        <label>&nbsp;</label>
                        <button class="refresh-btn" onclick="loadScores()">ğŸ”„ é‡æ–°æ•´ç†</button>
                    </div>
                    <div class="filter-group">
                        <label>&nbsp;</label>
                        <button class="export-btn" onclick="exportToExcel()">ğŸ“Š å°å‡º Excel</button>
                    </div>
                    <div class="filter-group">
                        <label>&nbsp;</label>
                        <button class="status-btn" onclick="checkSystemStatus()">ğŸ” è©³ç´°ç‹€æ…‹</button>
                    </div>
                    <div class="filter-group">
                        <label>&nbsp;</label>
                        <button class="refresh-btn" onclick="startRealTimeMonitoring()" id="monitorBtn">ğŸ“¡
                            é–‹å§‹å¯¦æ™‚ç›£æ¸¬</button>
                    </div>
                    <div class="filter-group">
                        <label>&nbsp;</label>
                        <button class="info-btn" onclick="showStatusLegend()">â„¹ï¸ ç‹€æ…‹èªªæ˜</button>
                    </div>
                </div>

                <!-- Scores Table -->
                <div class="dashboard-section">
                    <h3>ğŸ“Š ç©å®¶åˆ†æ•¸è¨˜éŒ„</h3>
                    <div id="scoresContainer">
                        <div class="loading">è¼‰å…¥ä¸­...</div>
                    </div>
                </div>

                <!-- System Status Section -->
                <div class="dashboard-section">
                    <h3>ğŸ” ç³»çµ±ç‹€æ…‹ç›£æ¸¬</h3>
                    <div id="systemStatusContainer">
                        <div class="loading">è¼‰å…¥ç³»çµ±ç‹€æ…‹ä¸­...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- System Status Modal -->
    <div id="statusModal" class="status-modal">
        <div class="status-modal-content">
            <div class="status-modal-header">
                <h3>ğŸ” ç³»çµ±ç‹€æ…‹æª¢æŸ¥</h3>
                <button class="status-modal-close" onclick="closeStatusModal()">&times;</button>
            </div>
            <div id="statusContent">
                <div class="loading">æª¢æŸ¥ä¸­...</div>
            </div>
        </div>
    </div>

    <!-- Status Legend Modal -->
    <div id="legendModal" class="status-modal">
        <div class="status-modal-content">
            <div class="status-modal-header">
                <h3>â„¹ï¸ ç³»çµ±ç‹€æ…‹èªªæ˜</h3>
                <button class="status-modal-close" onclick="closeLegendModal()">&times;</button>
            </div>
            <div id="legendContent">
                <div class="legend-section">
                    <h4>ğŸ¯ ç‹€æ…‹æŒ‡ç¤ºå™¨èªªæ˜</h4>
                    <div class="legend-grid">
                        <div class="legend-item">
                            <span class="status-badge status-badge-success">æˆåŠŸ</span>
                            <p>ç³»çµ±åŠŸèƒ½æ­£å¸¸é‹ä½œï¼Œç„¡éœ€ä»»ä½•æ“ä½œ</p>
                        </div>
                        <div class="legend-item">
                            <span class="status-badge status-badge-warning">è­¦å‘Š</span>
                            <p>ç³»çµ±åŠŸèƒ½æ­£å¸¸ï¼Œä½†éœ€è¦æ³¨æ„æˆ–å¯èƒ½éœ€è¦é—œæ³¨</p>
                        </div>
                        <div class="legend-item">
                            <span class="status-badge status-badge-error">éŒ¯èª¤</span>
                            <p>ç³»çµ±å‡ºç¾å•é¡Œï¼Œéœ€è¦ç«‹å³è™•ç†æˆ–æª¢æŸ¥</p>
                        </div>
                        <div class="legend-item">
                            <span class="status-badge status-badge-info">è³‡è¨Š</span>
                            <p>æä¾›ç³»çµ±ç›¸é—œè³‡è¨Šï¼Œé€šå¸¸ç‚ºæ­£å¸¸ç‹€æ…‹</p>
                        </div>
                    </div>
                </div>

                <div class="legend-section">
                    <h4>ğŸ“Š ç›£æ¸¬é …ç›®è©³ç´°èªªæ˜</h4>
                    <div class="legend-list">
                        <div class="legend-list-item">
                            <strong>Firebase é€£æ¥</strong>
                            <p>æª¢æŸ¥èˆ‡ Firebase æ•¸æ“šåº«çš„é€£æ¥ç‹€æ…‹ã€‚æ­£å¸¸è¡¨ç¤ºå¯ä»¥æˆåŠŸè®€å–å’Œå¯«å…¥æ•¸æ“šï¼Œç•°å¸¸è¡¨ç¤ºç„¡æ³•é€£æ¥æ•¸æ“šåº«ã€‚</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>ç®¡ç†å“¡èªè­‰</strong>
                            <p>æª¢æŸ¥ç•¶å‰ç®¡ç†å“¡ç™»å…¥ç‹€æ…‹ã€‚å·²ç™»å…¥è¡¨ç¤ºå¯ä»¥æ­£å¸¸ä½¿ç”¨ç®¡ç†åŠŸèƒ½ï¼Œæœªç™»å…¥éœ€è¦é‡æ–°è¼¸å…¥å¯†ç¢¼ã€‚</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>æ•¸æ“šå¯ç”¨æ€§</strong>
                            <p>æª¢æŸ¥æ˜¯å¦æœ‰å¯ç”¨çš„ç©å®¶åˆ†æ•¸æ•¸æ“šã€‚é¡¯ç¤ºå·²è¼‰å…¥çš„è¨˜éŒ„æ•¸é‡ï¼Œç„¡æ•¸æ“šè¡¨ç¤ºå°šæœªæœ‰ç©å®¶é€²è¡ŒéŠæˆ²ã€‚</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>ç€è¦½å™¨ç›¸å®¹æ€§</strong>
                            <p>æª¢æŸ¥ç€è¦½å™¨æ˜¯å¦æ”¯æ´æ‰€éœ€åŠŸèƒ½ï¼ŒåŒ…æ‹¬ Firebase SDKã€Excel å°å‡ºã€æœ¬åœ°å­˜å„²ç­‰ã€‚å®Œå…¨æ”¯æ´è¡¨ç¤ºæ‰€æœ‰åŠŸèƒ½æ­£å¸¸ã€‚</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>ç¶²è·¯é€£æ¥</strong>
                            <p>æª¢æŸ¥ç¶²è·¯é€£æ¥ç‹€æ…‹ã€‚åœ¨ç·šè¡¨ç¤ºå¯ä»¥æ­£å¸¸è¨ªå•ç¶²è·¯ï¼Œé›¢ç·šè¡¨ç¤ºç¶²è·¯é€£æ¥å·²æ–·é–‹ã€‚</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>è¨˜æ†¶é«”ä½¿ç”¨</strong>
                            <p>æª¢æŸ¥ç€è¦½å™¨è¨˜æ†¶é«”ä½¿ç”¨æƒ…æ³ã€‚ä½æ–¼80%ç‚ºæ­£å¸¸ï¼Œ80-95%ç‚ºè­¦å‘Šï¼Œè¶…é95%ç‚ºç•°å¸¸ã€‚ç„¡æ³•æª¢æ¸¬è¡¨ç¤ºç€è¦½å™¨ä¸æ”¯æ´æ­¤åŠŸèƒ½ã€‚</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>æœ€å¾Œæ›´æ–°</strong>
                            <p>æª¢æŸ¥æ•¸æ“šæœ€å¾Œæ›´æ–°æ™‚é–“ã€‚5åˆ†é˜å…§ç‚ºã€Œæœ€è¿‘æ›´æ–°ã€ï¼Œ5-30åˆ†é˜ç‚ºã€Œè¼ƒèˆŠæ•¸æ“šã€ï¼Œè¶…é30åˆ†é˜ç‚ºã€Œæ•¸æ“šéèˆŠã€ã€‚æ•¸æ“šéèˆŠå¯èƒ½è¡¨ç¤ºç³»çµ±å•é¡Œæˆ–ç„¡ç©å®¶æ´»å‹•ã€‚</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>æ´»èºç”¨æˆ¶</strong>
                            <p>ç›£æ¸¬éå»30åˆ†é˜å…§çš„æ´»èºç”¨æˆ¶æ•¸é‡ã€‚é¡¯ç¤ºæ´»èºç”¨æˆ¶æ•¸å’ŒéŠæˆ²æ¬¡æ•¸ï¼Œ0äººè¡¨ç¤ºè©²æ™‚æ®µå…§æ²’æœ‰ç©å®¶é€²è¡ŒéŠæˆ²ã€‚</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>æœ€å—æ­¡è¿éŠæˆ²</strong>
                            <p>åˆ†æå“ªå€‹éŠæˆ²è¢«ç©å¾—æœ€å¤šã€‚é¡¯ç¤ºéŠæˆ²åç¨±ã€ç¸½éŠæˆ²æ¬¡æ•¸å’Œå‹ç‡ç™¾åˆ†æ¯”ï¼Œå¹«åŠ©äº†è§£ç©å®¶åå¥½ã€‚</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>ä½¿ç”¨è¶¨å‹¢</strong>
                            <p>æ¯”è¼ƒä»Šæ—¥èˆ‡æ˜¨æ—¥çš„ä½¿ç”¨é‡è®ŠåŒ–ã€‚ä¸Šå‡è¶¨å‹¢è¡¨ç¤ºä½¿ç”¨é‡å¢åŠ ï¼Œä¸‹é™è¶¨å‹¢è¡¨ç¤ºä½¿ç”¨é‡æ¸›å°‘ï¼ŒæŒå¹³è¡¨ç¤ºç„¡è®ŠåŒ–ã€‚</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>é«˜å³°ä½¿ç”¨æ™‚æ®µ</strong>
                            <p>åˆ†æä¸€å¤©ä¸­æœ€æ´»èºçš„ä½¿ç”¨æ™‚æ®µã€‚é¡¯ç¤º24å°æ™‚ä¸­éŠæˆ²æ¬¡æ•¸æœ€å¤šçš„æ™‚æ®µï¼Œå¹«åŠ©äº†è§£ç©å®¶ä½¿ç”¨ç¿’æ…£ã€‚</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>å¹³å‡éŠæˆ²æ™‚é•·</strong>
                            <p>è¨ˆç®—ç”¨æˆ¶å¹³å‡éŠæˆ²æ™‚é–“ã€‚è¼ƒçŸ­ï¼ˆ<2åˆ†é˜ï¼‰ç‚ºè­¦å‘Šï¼Œæ­£å¸¸ï¼ˆ2-5åˆ†é˜ï¼‰ç‚ºæˆåŠŸï¼Œè¼ƒé•·ï¼ˆ>5åˆ†é˜ï¼‰ç‚ºè³‡è¨Šã€‚åŸºæ–¼æœ‰æ™‚é–“è¨˜éŒ„çš„éŠæˆ²è¨ˆç®—ã€‚</p>
                        </div>
                    </div>
                </div>

                <div class="legend-section">
                    <h4>ğŸ” ç‹€æ…‹æŒ‡ç¤ºå™¨è©³ç´°èªªæ˜</h4>
                    <div class="legend-list">
                        <div class="legend-list-item">
                            <strong>ğŸŸ¢ æˆåŠŸï¼ˆç¶ è‰²ï¼‰</strong>
                            <p>ç³»çµ±åŠŸèƒ½æ­£å¸¸é‹ä½œï¼Œç„¡éœ€ä»»ä½•æ“ä½œã€‚è¡¨ç¤ºè©²é …ç›®æª¢æŸ¥é€šéï¼Œé‹è¡Œè‰¯å¥½ã€‚</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>ğŸŸ¡ è­¦å‘Šï¼ˆé»ƒè‰²ï¼‰</strong>
                            <p>ç³»çµ±åŠŸèƒ½æ­£å¸¸ï¼Œä½†éœ€è¦æ³¨æ„æˆ–å¯èƒ½éœ€è¦é—œæ³¨ã€‚å»ºè­°æª¢æŸ¥ç›¸é—œè¨­ç½®æˆ–ç­‰å¾…æ”¹å–„ã€‚</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>ğŸ”´ éŒ¯èª¤ï¼ˆç´…è‰²ï¼‰</strong>
                            <p>ç³»çµ±å‡ºç¾å•é¡Œï¼Œéœ€è¦ç«‹å³è™•ç†æˆ–æª¢æŸ¥ã€‚å¯èƒ½å½±éŸ¿ç³»çµ±æ­£å¸¸é‹ä½œï¼Œå»ºè­°å„ªå…ˆè§£æ±ºã€‚</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>ğŸ”µ è³‡è¨Šï¼ˆè—è‰²ï¼‰</strong>
                            <p>æä¾›ç³»çµ±ç›¸é—œè³‡è¨Šï¼Œé€šå¸¸ç‚ºæ­£å¸¸ç‹€æ…‹ã€‚ç”¨æ–¼é¡¯ç¤ºçµ±è¨ˆæ•¸æ“šæˆ–ç„¡æ³•æª¢æ¸¬çš„é …ç›®ã€‚</p>
                        </div>
                    </div>
                </div>

                <div class="legend-section">
                    <h4>ğŸ’¡ å¸¸è¦‹å•é¡Œèªªæ˜</h4>
                    <div class="legend-list">
                        <div class="legend-list-item">
                            <strong>ã€Œæ•¸æ“šéèˆŠã€æ˜¯ä»€éº¼æ„æ€ï¼Ÿ</strong>
                            <p>è¡¨ç¤ºæœ€å¾Œä¸€æ¬¡æ•¸æ“šæ›´æ–°å·²è¶…é30åˆ†é˜ã€‚å¯èƒ½åŸå› ï¼š1) ç›®å‰æ²’æœ‰ç©å®¶é€²è¡ŒéŠæˆ²ï¼ˆæ­£å¸¸æƒ…æ³ï¼‰ï¼›2) ç³»çµ±ç„¡æ³•è¨˜éŒ„æ–°æ•¸æ“šï¼ˆéœ€è¦æª¢æŸ¥ï¼‰ï¼›3) ç¶²è·¯æˆ–Firebaseé€£æ¥å•é¡Œã€‚</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>ã€Œæ´»èºç”¨æˆ¶ 0 äººã€æ­£å¸¸å—ï¼Ÿ</strong>
                            <p>åœ¨ééŠæˆ²æ™‚é–“æˆ–ç³»çµ±å‰›éƒ¨ç½²æ™‚æ˜¯æ­£å¸¸çš„ã€‚å¦‚æœé•·æ™‚é–“é¡¯ç¤º0äººä¸”ã€Œæ•¸æ“šéèˆŠã€ï¼Œå»ºè­°æª¢æŸ¥éŠæˆ²é é¢æ˜¯å¦æ­£å¸¸é‹ä½œã€‚</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>ã€Œè¨˜æ†¶é«”ä½¿ç”¨ ç„¡æ³•æª¢æ¸¬ã€æ€éº¼è¾¦ï¼Ÿ</strong>
                            <p>é€™æ˜¯æ­£å¸¸çš„ï¼ŒæŸäº›ç€è¦½å™¨ï¼ˆå¦‚Safariï¼‰ä¸æ”¯æ´è¨˜æ†¶é«”æª¢æ¸¬åŠŸèƒ½ã€‚ä¸å½±éŸ¿ç³»çµ±æ­£å¸¸é‹ä½œã€‚</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>ã€Œä½¿ç”¨è¶¨å‹¢ æŒå¹³ã€è¡¨ç¤ºä»€éº¼ï¼Ÿ</strong>
                            <p>è¡¨ç¤ºä»Šæ—¥èˆ‡æ˜¨æ—¥çš„éŠæˆ²æ¬¡æ•¸ç›¸åŒã€‚åœ¨ç³»çµ±å‰›éƒ¨ç½²æˆ–ä½¿ç”¨é‡ç©©å®šçš„æƒ…æ³ä¸‹æ˜¯æ­£å¸¸çš„ã€‚</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>å¦‚ä½•åˆ¤æ–·ç³»çµ±æ˜¯å¦æ­£å¸¸ï¼Ÿ</strong>
                            <p>æŸ¥çœ‹ã€Œæ•´é«”ç³»çµ±ç‹€æ…‹ã€ï¼šç¶ è‰²ã€Œç³»çµ±æ­£å¸¸ã€è¡¨ç¤ºä¸€åˆ‡è‰¯å¥½ï¼›é»ƒè‰²ã€Œç³»çµ±è­¦å‘Šã€è¡¨ç¤ºéœ€è¦æ³¨æ„ï¼›ç´…è‰²ã€Œç³»çµ±ç•°å¸¸ã€è¡¨ç¤ºéœ€è¦ç«‹å³è™•ç†ã€‚</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase Configuration -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <!-- SheetJS for Excel Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD5x_L2yAP9ndQJRBeC31Z6nNrh4okt9uo",
            authDomain: "stem-by-me-app.firebaseapp.com",
            projectId: "stem-by-me-app",
            storageBucket: "stem-by-me-app.firebasestorage.app",
            messagingSenderId: "216736327145",
            appId: "1:216736327145:web:e01721f8e0c6a960a19778",
            measurementId: "G-WWSS5PJVP1"
        };

        // Initialize Firebase
        let db;
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            console.log('Firebase initialized successfully');
        } catch (error) {
            console.error('Firebase initialization error:', error);
        }

        // Admin password
        const ADMIN_PASSWORD = 'ADMIN2025';

        // Global variables
        let allScores = [];
        let isAuthenticated = false;

        // Check authentication on page load
        document.addEventListener('DOMContentLoaded', function () {
            checkAuthStatus();

            // Add event listeners for filters
            const gameFilter = document.getElementById('gameFilter');
            const statusFilter = document.getElementById('statusFilter');
            const playerFilter = document.getElementById('playerFilter');
            const adminPassword = document.getElementById('adminPassword');

            if (gameFilter) {
                gameFilter.addEventListener('change', displayScores);
            }
            if (statusFilter) {
                statusFilter.addEventListener('change', displayScores);
            }
            if (playerFilter) {
                playerFilter.addEventListener('input', displayScores);
            }
            if (adminPassword) {
                adminPassword.addEventListener('keypress', function (e) {
                    if (e.key === 'Enter') {
                        login();
                    }
                });
            }
        });

        function checkAuthStatus() {
            const authStatus = sessionStorage.getItem('adminAuthStatus');
            if (authStatus === 'authenticated') {
                isAuthenticated = true;
                showDashboard();
                loadScores();
            } else {
                showLoginForm();
            }
        }

        function login() {
            const password = document.getElementById('adminPassword').value;
            const errorMessage = document.getElementById('errorMessage');

            if (password === ADMIN_PASSWORD) {
                isAuthenticated = true;
                sessionStorage.setItem('adminAuthStatus', 'authenticated');
                showDashboard();
                loadScores();
                errorMessage.style.display = 'none';
            } else {
                errorMessage.textContent = 'å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹é‡æ–°è¼¸å…¥';
                errorMessage.style.display = 'block';
                document.getElementById('adminPassword').value = '';
            }
        }

        function logout() {
            isAuthenticated = false;
            sessionStorage.removeItem('adminAuthStatus');
            showLoginForm();
        }

        function showLoginForm() {
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('adminDashboard').style.display = 'none';
        }

        function showDashboard() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('adminDashboard').style.display = 'block';
            // Auto-load system status when dashboard is shown
            setTimeout(() => {
                checkSystemStatusInline();
            }, 1000);
        }

        async function loadScores() {
            const container = document.getElementById('scoresContainer');
            container.innerHTML = '<div class="loading">è¼‰å…¥ä¸­...</div>';

            try {
                if (!db) {
                    throw new Error('Firebase not initialized');
                }

                const scoresRef = db.collection('gameScores');
                const snapshot = await scoresRef.orderBy('timestamp', 'desc').get();

                allScores = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    let timestamp;
                    try {
                        timestamp = data.timestamp && typeof data.timestamp.toDate === 'function'
                            ? data.timestamp.toDate()
                            : new Date();
                    } catch (error) {
                        console.warn('Error converting timestamp:', error);
                        timestamp = new Date();
                    }

                    allScores.push({
                        id: doc.id,
                        ...data,
                        timestamp: timestamp
                    });
                });

                updateStatistics();
                displayScores();
                // Auto-update system status when scores are loaded
                checkSystemStatusInline();

            } catch (error) {
                console.error('Error loading scores:', error);
                container.innerHTML = '<div class="no-data">è¼‰å…¥å¤±æ•—: ' + error.message + '</div>';
            }
        }

        function updateStatistics() {
            const totalPlayers = new Set(allScores.map(score => score.playerName)).size;
            const totalGames = allScores.length;
            const totalWins = allScores.filter(score => score.status === 'win').length;
            const avgScore = totalGames > 0 ? Math.round(allScores.reduce((sum, score) => sum + score.score, 0) / totalGames) : 0;

            document.getElementById('totalPlayers').textContent = totalPlayers;
            document.getElementById('totalGames').textContent = totalGames;
            document.getElementById('totalWins').textContent = totalWins;
            document.getElementById('avgScore').textContent = avgScore;
        }

        function displayScores() {
            const gameFilter = document.getElementById('gameFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            const playerFilter = document.getElementById('playerFilter').value.toLowerCase();

            let filteredScores = allScores.filter(score => {
                const matchGame = !gameFilter || score.gameId === gameFilter;
                const matchStatus = !statusFilter || score.status === statusFilter;
                const matchPlayer = !playerFilter || score.playerName.toLowerCase().includes(playerFilter);
                return matchGame && matchStatus && matchPlayer;
            });

            const container = document.getElementById('scoresContainer');

            if (filteredScores.length === 0) {
                container.innerHTML = '<div class="no-data">æ²’æœ‰æ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„è¨˜éŒ„</div>';
                return;
            }

            let tableHTML = `
                <table class="scores-table">
                    <thead>
                        <tr>
                            <th>ç©å®¶åç¨±</th>
                            <th>éŠæˆ²</th>
                            <th>åˆ†æ•¸</th>
                            <th>ç‹€æ…‹</th>
                            <th>éŠæˆ²æ™‚é–“</th>
                            <th>ç¸½åˆ†</th>
                            <th>æ™‚é–“æˆ³</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            filteredScores.forEach(score => {
                const gameName = score.gameId ? `éŠæˆ² ${score.gameId.replace('game', '')}` : 'æœªçŸ¥éŠæˆ²';
                const statusClass = score.status === 'win' ? 'status-win' : 'status-lose';
                const statusText = score.status === 'win' ? 'å‹åˆ©' : 'å¤±æ•—';
                const gameTime = score.gameTime ? `${Math.round(score.gameTime)}ç§’` : 'N/A';
                let timestamp;
                try {
                    timestamp = score.timestamp && typeof score.timestamp.toLocaleString === 'function'
                        ? score.timestamp.toLocaleString('zh-TW')
                        : 'N/A';
                } catch (error) {
                    console.warn('Error formatting timestamp:', error);
                    timestamp = 'N/A';
                }

                tableHTML += `
                    <tr>
                        <td>${score.playerName || 'åŒ¿åç©å®¶'}</td>
                        <td>${gameName}</td>
                        <td>${score.score}</td>
                        <td><span class="${statusClass}">${statusText}</span></td>
                        <td>${gameTime}</td>
                        <td>${score.totalScore || score.score}</td>
                        <td>${timestamp}</td>
                    </tr>
                `;
            });

            tableHTML += '</tbody></table>';
            container.innerHTML = tableHTML;
        }

        // Inline System Status Check function
        async function checkSystemStatusInline() {
            const container = document.getElementById('systemStatusContainer');
            container.innerHTML = '<div class="loading">ğŸ” æ­£åœ¨é€²è¡Œå…¨é¢ç³»çµ±æª¢æŸ¥...</div>';

            const statusChecks = [];

            // 1. Check Firebase Connection
            try {
                if (!db) {
                    statusChecks.push({
                        label: 'Firebase é€£æ¥',
                        status: 'error',
                        value: 'æœªåˆå§‹åŒ–',
                        details: 'Firebase æ•¸æ“šåº«æœªæ­£ç¢ºåˆå§‹åŒ–'
                    });
                } else {
                    // Test Firebase connection
                    const testRef = db.collection('gameScores');
                    const testSnapshot = await testRef.limit(1).get();

                    statusChecks.push({
                        label: 'Firebase é€£æ¥',
                        status: 'success',
                        value: 'æ­£å¸¸',
                        details: 'æˆåŠŸé€£æ¥åˆ° Firebase Firestore'
                    });
                }
            } catch (error) {
                statusChecks.push({
                    label: 'Firebase é€£æ¥',
                    status: 'error',
                    value: 'é€£æ¥å¤±æ•—',
                    details: `éŒ¯èª¤: ${error.message}`
                });
            }

            // 2. Check Authentication Status
            const authStatus = sessionStorage.getItem('adminAuthStatus');
            statusChecks.push({
                label: 'ç®¡ç†å“¡èªè­‰',
                status: authStatus === 'authenticated' ? 'success' : 'warning',
                value: authStatus === 'authenticated' ? 'å·²ç™»å…¥' : 'æœªç™»å…¥',
                details: authStatus === 'authenticated' ? 'ç®¡ç†å“¡å·²æˆåŠŸç™»å…¥' : 'éœ€è¦é‡æ–°ç™»å…¥'
            });

            // 3. Check Data Availability
            try {
                if (allScores.length > 0) {
                    statusChecks.push({
                        label: 'æ•¸æ“šå¯ç”¨æ€§',
                        status: 'success',
                        value: `${allScores.length} ç­†è¨˜éŒ„`,
                        details: `å·²è¼‰å…¥ ${allScores.length} ç­†ç©å®¶åˆ†æ•¸è¨˜éŒ„`
                    });
                } else {
                    statusChecks.push({
                        label: 'æ•¸æ“šå¯ç”¨æ€§',
                        status: 'warning',
                        value: 'ç„¡æ•¸æ“š',
                        details: 'å°šæœªè¼‰å…¥ä»»ä½•ç©å®¶åˆ†æ•¸è¨˜éŒ„'
                    });
                }
            } catch (error) {
                statusChecks.push({
                    label: 'æ•¸æ“šå¯ç”¨æ€§',
                    status: 'error',
                    value: 'è¼‰å…¥å¤±æ•—',
                    details: `éŒ¯èª¤: ${error.message}`
                });
            }

            // 4. Check Browser Compatibility
            const browserChecks = [];

            // Check if Firebase is available
            if (typeof firebase !== 'undefined') {
                browserChecks.push('Firebase SDK âœ“');
            } else {
                browserChecks.push('Firebase SDK âœ—');
            }

            // Check if XLSX is available
            if (typeof XLSX !== 'undefined') {
                browserChecks.push('Excel å°å‡º âœ“');
            } else {
                browserChecks.push('Excel å°å‡º âœ—');
            }

            // Check localStorage support
            if (typeof localStorage !== 'undefined') {
                browserChecks.push('æœ¬åœ°å­˜å„² âœ“');
            } else {
                browserChecks.push('æœ¬åœ°å­˜å„² âœ—');
            }

            // Check sessionStorage support
            if (typeof sessionStorage !== 'undefined') {
                browserChecks.push('æœƒè©±å­˜å„² âœ“');
            } else {
                browserChecks.push('æœƒè©±å­˜å„² âœ—');
            }

            const browserStatus = browserChecks.every(check => check.includes('âœ“')) ? 'success' : 'warning';
            const browserValue = browserChecks.every(check => check.includes('âœ“')) ? 'å®Œå…¨æ”¯æ´' : 'éƒ¨åˆ†æ”¯æ´';

            statusChecks.push({
                label: 'ç€è¦½å™¨ç›¸å®¹æ€§',
                status: browserStatus,
                value: browserValue,
                details: browserChecks.join(', ')
            });

            // 5. Check Network Status
            if (navigator.onLine) {
                statusChecks.push({
                    label: 'ç¶²è·¯é€£æ¥',
                    status: 'success',
                    value: 'åœ¨ç·š',
                    details: 'ç¶²è·¯é€£æ¥æ­£å¸¸'
                });
            } else {
                statusChecks.push({
                    label: 'ç¶²è·¯é€£æ¥',
                    status: 'error',
                    value: 'é›¢ç·š',
                    details: 'ç¶²è·¯é€£æ¥å·²æ–·é–‹'
                });
            }

            // 6. Check System Performance
            const memoryInfo = performance.memory ? {
                used: Math.round(performance.memory.usedJSHeapSize / 1024 / 1024),
                total: Math.round(performance.memory.totalJSHeapSize / 1024 / 1024),
                limit: Math.round(performance.memory.jsHeapSizeLimit / 1024 / 1024)
            } : null;

            if (memoryInfo) {
                const memoryUsage = Math.round((memoryInfo.used / memoryInfo.limit) * 100);
                const memoryStatus = memoryUsage < 80 ? 'success' : memoryUsage < 95 ? 'warning' : 'error';

                statusChecks.push({
                    label: 'è¨˜æ†¶é«”ä½¿ç”¨',
                    status: memoryStatus,
                    value: `${memoryUsage}%`,
                    details: `å·²ä½¿ç”¨ ${memoryInfo.used}MB / ${memoryInfo.limit}MB`
                });
            } else {
                statusChecks.push({
                    label: 'è¨˜æ†¶é«”ä½¿ç”¨',
                    status: 'info',
                    value: 'ç„¡æ³•æª¢æ¸¬',
                    details: 'ç€è¦½å™¨ä¸æ”¯æ´è¨˜æ†¶é«”è³‡è¨Šæª¢æ¸¬'
                });
            }

            // 7. Check Last Data Update
            if (allScores.length > 0) {
                const latestScore = allScores[0];
                const lastUpdate = latestScore.timestamp;
                const timeDiff = Date.now() - lastUpdate.getTime();
                const minutesDiff = Math.round(timeDiff / 1000 / 60);

                let updateStatus, updateValue, updateDetails;

                if (minutesDiff < 5) {
                    updateStatus = 'success';
                    updateValue = 'æœ€è¿‘æ›´æ–°';
                    updateDetails = `${minutesDiff} åˆ†é˜å‰`;
                } else if (minutesDiff < 30) {
                    updateStatus = 'warning';
                    updateValue = 'è¼ƒèˆŠæ•¸æ“š';
                    updateDetails = `${minutesDiff} åˆ†é˜å‰`;
                } else {
                    updateStatus = 'error';
                    updateValue = 'æ•¸æ“šéèˆŠ';
                    updateDetails = `${minutesDiff} åˆ†é˜å‰`;
                }

                statusChecks.push({
                    label: 'æœ€å¾Œæ›´æ–°',
                    status: updateStatus,
                    value: updateValue,
                    details: updateDetails
                });
            } else {
                statusChecks.push({
                    label: 'æœ€å¾Œæ›´æ–°',
                    status: 'info',
                    value: 'ç„¡æ•¸æ“š',
                    details: 'å°šæœªè¼‰å…¥ä»»ä½•æ•¸æ“š'
                });
            }

            // 8. Check Active Users (Real-time monitoring)
            try {
                const recentScores = allScores.filter(score => {
                    const scoreTime = score.timestamp.getTime();
                    const timeDiff = Date.now() - scoreTime;
                    return timeDiff < 30 * 60 * 1000; // Last 30 minutes
                });

                const activeUsers = new Set(recentScores.map(score => score.playerName)).size;
                const recentGames = recentScores.length;

                if (activeUsers > 0) {
                    statusChecks.push({
                        label: 'æ´»èºç”¨æˆ¶',
                        status: 'success',
                        value: `${activeUsers} äºº`,
                        details: `éå»30åˆ†é˜å…§æœ‰ ${activeUsers} ä½ç”¨æˆ¶é€²è¡Œäº† ${recentGames} å ´éŠæˆ²`
                    });
                } else {
                    statusChecks.push({
                        label: 'æ´»èºç”¨æˆ¶',
                        status: 'warning',
                        value: '0 äºº',
                        details: 'éå»30åˆ†é˜å…§æ²’æœ‰ç”¨æˆ¶æ´»å‹•'
                    });
                }
            } catch (error) {
                statusChecks.push({
                    label: 'æ´»èºç”¨æˆ¶',
                    status: 'error',
                    value: 'æª¢æ¸¬å¤±æ•—',
                    details: `éŒ¯èª¤: ${error.message}`
                });
            }

            // 9. Check Game Activity Distribution
            try {
                const gameStats = {};
                allScores.forEach(score => {
                    const gameId = score.gameId || 'unknown';
                    if (!gameStats[gameId]) {
                        gameStats[gameId] = { total: 0, wins: 0 };
                    }
                    gameStats[gameId].total++;
                    if (score.status === 'win') {
                        gameStats[gameId].wins++;
                    }
                });

                const mostPlayedGame = Object.entries(gameStats)
                    .sort(([, a], [, b]) => b.total - a.total)[0];

                if (mostPlayedGame) {
                    const [gameId, stats] = mostPlayedGame;
                    const gameName = gameId === 'unknown' ? 'æœªçŸ¥éŠæˆ²' : `éŠæˆ² ${gameId.replace('game', '')}`;
                    const winRate = Math.round((stats.wins / stats.total) * 100);

                    statusChecks.push({
                        label: 'æœ€å—æ­¡è¿éŠæˆ²',
                        status: 'info',
                        value: gameName,
                        details: `ç¸½éŠæˆ²æ¬¡æ•¸: ${stats.total}, å‹ç‡: ${winRate}%`
                    });
                } else {
                    statusChecks.push({
                        label: 'æœ€å—æ­¡è¿éŠæˆ²',
                        status: 'info',
                        value: 'ç„¡æ•¸æ“š',
                        details: 'å°šæœªæœ‰éŠæˆ²è¨˜éŒ„'
                    });
                }
            } catch (error) {
                statusChecks.push({
                    label: 'æœ€å—æ­¡è¿éŠæˆ²',
                    status: 'error',
                    value: 'åˆ†æå¤±æ•—',
                    details: `éŒ¯èª¤: ${error.message}`
                });
            }

            // 10. Check System Performance Trends
            try {
                const today = new Date();
                today.setHours(0, 0, 0, 0);

                const todayScores = allScores.filter(score => {
                    const scoreDate = new Date(score.timestamp);
                    scoreDate.setHours(0, 0, 0, 0);
                    return scoreDate.getTime() === today.getTime();
                });

                const yesterday = new Date(today);
                yesterday.setDate(yesterday.getDate() - 1);

                const yesterdayScores = allScores.filter(score => {
                    const scoreDate = new Date(score.timestamp);
                    scoreDate.setHours(0, 0, 0, 0);
                    return scoreDate.getTime() === yesterday.getTime();
                });

                const todayGames = todayScores.length;
                const yesterdayGames = yesterdayScores.length;

                let trendStatus, trendValue, trendDetails;

                if (todayGames > yesterdayGames) {
                    const increase = Math.round(((todayGames - yesterdayGames) / yesterdayGames) * 100);
                    trendStatus = 'success';
                    trendValue = 'ä¸Šå‡è¶¨å‹¢';
                    trendDetails = `ä»Šæ—¥ ${todayGames} å ´ vs æ˜¨æ—¥ ${yesterdayGames} å ´ (+${increase}%)`;
                } else if (todayGames < yesterdayGames) {
                    const decrease = Math.round(((yesterdayGames - todayGames) / yesterdayGames) * 100);
                    trendStatus = 'warning';
                    trendValue = 'ä¸‹é™è¶¨å‹¢';
                    trendDetails = `ä»Šæ—¥ ${todayGames} å ´ vs æ˜¨æ—¥ ${yesterdayGames} å ´ (-${decrease}%)`;
                } else {
                    trendStatus = 'info';
                    trendValue = 'æŒå¹³';
                    trendDetails = `ä»Šæ—¥ ${todayGames} å ´ vs æ˜¨æ—¥ ${yesterdayGames} å ´ (0%)`;
                }

                statusChecks.push({
                    label: 'ä½¿ç”¨è¶¨å‹¢',
                    status: trendStatus,
                    value: trendValue,
                    details: trendDetails
                });
            } catch (error) {
                statusChecks.push({
                    label: 'ä½¿ç”¨è¶¨å‹¢',
                    status: 'error',
                    value: 'åˆ†æå¤±æ•—',
                    details: `éŒ¯èª¤: ${error.message}`
                });
            }

            // 11. Check Peak Usage Times
            try {
                const hourStats = new Array(24).fill(0);
                allScores.forEach(score => {
                    const hour = score.timestamp.getHours();
                    hourStats[hour]++;
                });

                const peakHour = hourStats.indexOf(Math.max(...hourStats));
                const peakGames = hourStats[peakHour];

                if (peakGames > 0) {
                    statusChecks.push({
                        label: 'é«˜å³°ä½¿ç”¨æ™‚æ®µ',
                        status: 'info',
                        value: `${peakHour}:00`,
                        details: `è©²æ™‚æ®µæœ‰ ${peakGames} å ´éŠæˆ²ï¼Œç‚ºæœ€æ´»èºæ™‚æ®µ`
                    });
                } else {
                    statusChecks.push({
                        label: 'é«˜å³°ä½¿ç”¨æ™‚æ®µ',
                        status: 'info',
                        value: 'ç„¡æ•¸æ“š',
                        details: 'å°šæœªæœ‰è¶³å¤ çš„éŠæˆ²è¨˜éŒ„ä¾†åˆ†æä½¿ç”¨æ™‚æ®µ'
                    });
                }
            } catch (error) {
                statusChecks.push({
                    label: 'é«˜å³°ä½¿ç”¨æ™‚æ®µ',
                    status: 'error',
                    value: 'åˆ†æå¤±æ•—',
                    details: `éŒ¯èª¤: ${error.message}`
                });
            }

            // 12. Check Average Session Duration
            try {
                const sessionsWithTime = allScores.filter(score => score.gameTime && score.gameTime > 0);

                if (sessionsWithTime.length > 0) {
                    const avgSessionTime = sessionsWithTime.reduce((sum, score) => sum + score.gameTime, 0) / sessionsWithTime.length;
                    const avgMinutes = Math.round(avgSessionTime / 60 * 10) / 10;

                    let sessionStatus, sessionValue;
                    if (avgMinutes < 2) {
                        sessionStatus = 'warning';
                        sessionValue = 'è¼ƒçŸ­';
                    } else if (avgMinutes < 5) {
                        sessionStatus = 'success';
                        sessionValue = 'æ­£å¸¸';
                    } else {
                        sessionStatus = 'info';
                        sessionValue = 'è¼ƒé•·';
                    }

                    statusChecks.push({
                        label: 'å¹³å‡éŠæˆ²æ™‚é•·',
                        status: sessionStatus,
                        value: sessionValue,
                        details: `å¹³å‡ ${avgMinutes} åˆ†é˜ (åŸºæ–¼ ${sessionsWithTime.length} å ´éŠæˆ²)`
                    });
                } else {
                    statusChecks.push({
                        label: 'å¹³å‡éŠæˆ²æ™‚é•·',
                        status: 'info',
                        value: 'ç„¡æ•¸æ“š',
                        details: 'æ²’æœ‰è¨˜éŒ„éŠæˆ²æ™‚é•·çš„æ•¸æ“š'
                    });
                }
            } catch (error) {
                statusChecks.push({
                    label: 'å¹³å‡éŠæˆ²æ™‚é•·',
                    status: 'error',
                    value: 'åˆ†æå¤±æ•—',
                    details: `éŒ¯èª¤: ${error.message}`
                });
            }

            // Calculate summary statistics
            const successCount = statusChecks.filter(check => check.status === 'success').length;
            const errorCount = statusChecks.filter(check => check.status === 'error').length;
            const warningCount = statusChecks.filter(check => check.status === 'warning').length;
            const infoCount = statusChecks.filter(check => check.status === 'info').length;

            const overallStatus = errorCount > 0 ? 'error' : warningCount > 0 ? 'warning' : 'success';
            const overallValue = errorCount > 0 ? 'ç³»çµ±ç•°å¸¸' : warningCount > 0 ? 'ç³»çµ±è­¦å‘Š' : 'ç³»çµ±æ­£å¸¸';

            // Create status table with same style as scores table
            let statusHTML = `
                <table class="scores-table">
                    <thead>
                        <tr>
                            <th>æª¢æŸ¥é …ç›®</th>
                            <th>ç‹€æ…‹</th>
                            <th>è©³ç´°è³‡è¨Š</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            statusChecks.forEach(check => {
                statusHTML += `
                    <tr>
                        <td><strong>${check.label}</strong></td>
                        <td><span class="status-badge status-badge-${check.status}">${check.value}</span></td>
                        <td>${check.details}</td>
                    </tr>
                `;
            });

            statusHTML += '</tbody></table>';

            // Add summary statistics at the top (similar to stats-grid)
            const summaryHTML = `
                <div class="stats-grid" style="margin-bottom: 30px;">
                    <div class="stat-card">
                        <div class="stat-number" style="color: #28a745;">${successCount}</div>
                        <div class="stat-label">æˆåŠŸé …ç›®</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #ffc107;">${warningCount}</div>
                        <div class="stat-label">è­¦å‘Šé …ç›®</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #dc3545;">${errorCount}</div>
                        <div class="stat-label">éŒ¯èª¤é …ç›®</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #17a2b8;">${infoCount}</div>
                        <div class="stat-label">è³‡è¨Šé …ç›®</div>
                    </div>
                </div>
                <div style="margin-bottom: 20px; padding: 15px; background: #000000; border-radius: 10px; border-left: 4px solid #667eea;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <h3 style="margin: 0; color: #00FFFF;">æ•´é«”ç³»çµ±ç‹€æ…‹</h3>
                        <span class="status-badge status-badge-${overallStatus}" style="font-size: 1em; padding: 8px 16px;">${overallValue}</span>
                    </div>
                </div>
            `;

            container.innerHTML = summaryHTML + statusHTML;
        }

        // Modal System Status Check function (for button click)
        async function checkSystemStatus() {
            const modal = document.getElementById('statusModal');
            const content = document.getElementById('statusContent');

            modal.style.display = 'block';
            content.innerHTML = '<div class="loading">ğŸ” æ­£åœ¨é€²è¡Œå…¨é¢ç³»çµ±æª¢æŸ¥...</div>';

            // Use the same logic as inline function
            await checkSystemStatusInline();

            // Copy the content to modal
            const inlineContent = document.getElementById('systemStatusContainer').innerHTML;
            content.innerHTML = inlineContent;
        }

        function closeStatusModal() {
            document.getElementById('statusModal').style.display = 'none';
        }

        // Close modal when clicking outside
        window.onclick = function (event) {
            const statusModal = document.getElementById('statusModal');
            const legendModal = document.getElementById('legendModal');

            if (event.target === statusModal) {
                closeStatusModal();
            }
            if (event.target === legendModal) {
                closeLegendModal();
            }
        }

        // Real-time monitoring variables
        let monitoringInterval = null;
        let isMonitoring = false;

        // Real-time monitoring function
        function startRealTimeMonitoring() {
            const monitorBtn = document.getElementById('monitorBtn');

            if (!isMonitoring) {
                // Start monitoring
                isMonitoring = true;
                monitorBtn.textContent = 'â¹ï¸ åœæ­¢å¯¦æ™‚ç›£æ¸¬';
                monitorBtn.style.background = '#dc3545';

                // Set up interval for real-time updates (every 30 seconds)
                monitoringInterval = setInterval(() => {
                    loadScores().then(() => {
                        // Update statistics and system status
                        updateStatistics();
                        displayScores();
                        checkSystemStatusInline();
                    });
                }, 30000); // 30 seconds

                // Show notification
                showNotification('å¯¦æ™‚ç›£æ¸¬å·²å•Ÿå‹•', 'ç³»çµ±å°‡æ¯30ç§’è‡ªå‹•æ›´æ–°æ•¸æ“š', 'success');
            } else {
                // Stop monitoring
                isMonitoring = false;
                monitorBtn.textContent = 'ğŸ“¡ é–‹å§‹å¯¦æ™‚ç›£æ¸¬';
                monitorBtn.style.background = '#28a745';

                if (monitoringInterval) {
                    clearInterval(monitoringInterval);
                    monitoringInterval = null;
                }

                // Show notification
                showNotification('å¯¦æ™‚ç›£æ¸¬å·²åœæ­¢', 'ç³»çµ±ç‹€æ…‹ç›£æ¸¬å·²é—œé–‰', 'info');
            }
        }

        // Show status legend function
        function showStatusLegend() {
            const modal = document.getElementById('legendModal');
            modal.style.display = 'block';
        }

        // Close legend modal function
        function closeLegendModal() {
            document.getElementById('legendModal').style.display = 'none';
        }

        // Notification function
        function showNotification(title, message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#d4edda' : type === 'error' ? '#f8d7da' : '#d1ecf1'};
                color: ${type === 'success' ? '#155724' : type === 'error' ? '#721c24' : '#0c5460'};
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 10001;
                max-width: 300px;
                font-family: Arial, sans-serif;
                border-left: 4px solid ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : '#17a2b8'};
            `;

            notification.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 5px;">${title}</div>
                <div style="font-size: 0.9em;">${message}</div>
            `;

            document.body.appendChild(notification);

            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 5000);
        }

        // Export to Excel function
        function exportToExcel() {
            try {
                // Get current filtered scores
                const gameFilter = document.getElementById('gameFilter').value;
                const statusFilter = document.getElementById('statusFilter').value;
                const playerFilter = document.getElementById('playerFilter').value.toLowerCase();

                let filteredScores = allScores.filter(score => {
                    const matchGame = !gameFilter || score.gameId === gameFilter;
                    const matchStatus = !statusFilter || score.status === statusFilter;
                    const matchPlayer = !playerFilter || score.playerName.toLowerCase().includes(playerFilter);
                    return matchGame && matchStatus && matchPlayer;
                });

                if (filteredScores.length === 0) {
                    alert('æ²’æœ‰æ•¸æ“šå¯ä»¥å°å‡ºï¼');
                    return;
                }

                // Prepare data for Excel
                const excelData = filteredScores.map(score => {
                    let timestamp;
                    try {
                        timestamp = score.timestamp && typeof score.timestamp.toLocaleString === 'function'
                            ? score.timestamp.toLocaleString('zh-TW')
                            : 'N/A';
                    } catch (error) {
                        timestamp = 'N/A';
                    }

                    return {
                        'ç©å®¶åç¨±': score.playerName || 'åŒ¿åç©å®¶',
                        'éŠæˆ²': score.gameId ? `éŠæˆ² ${score.gameId.replace('game', '')}` : 'æœªçŸ¥éŠæˆ²',
                        'åˆ†æ•¸': score.score,
                        'ç‹€æ…‹': score.status === 'win' ? 'å‹åˆ©' : 'å¤±æ•—',
                        'éŠæˆ²æ™‚é–“(ç§’)': score.gameTime ? Math.round(score.gameTime) : 'N/A',
                        'ç¸½åˆ†': score.totalScore || score.score,
                        'æ™‚é–“æˆ³': timestamp
                    };
                });

                // Create workbook and worksheet
                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.json_to_sheet(excelData);

                // Set column widths
                const colWidths = [
                    { wch: 15 }, // ç©å®¶åç¨±
                    { wch: 10 }, // éŠæˆ²
                    { wch: 8 },  // åˆ†æ•¸
                    { wch: 8 },  // ç‹€æ…‹
                    { wch: 12 }, // éŠæˆ²æ™‚é–“
                    { wch: 8 },  // ç¸½åˆ†
                    { wch: 20 }  // æ™‚é–“æˆ³
                ];
                ws['!cols'] = colWidths;

                // Add worksheet to workbook
                XLSX.utils.book_append_sheet(wb, ws, 'ç©å®¶åˆ†æ•¸çµ±è¨ˆ');

                // Generate filename with current date
                const now = new Date();
                const dateStr = now.getFullYear() +
                    String(now.getMonth() + 1).padStart(2, '0') +
                    String(now.getDate()).padStart(2, '0') + '_' +
                    String(now.getHours()).padStart(2, '0') +
                    String(now.getMinutes()).padStart(2, '0');

                const filename = `STEM-by-ME_ç©å®¶åˆ†æ•¸çµ±è¨ˆ_${dateStr}.xlsx`;

                // Export the file
                XLSX.writeFile(wb, filename);

                // Show success message
                alert(`âœ… Excel æ–‡ä»¶å·²æˆåŠŸå°å‡ºï¼\næ–‡ä»¶åï¼š${filename}\nè¨˜éŒ„æ•¸ï¼š${filteredScores.length} ç­†`);

            } catch (error) {
                console.error('Export to Excel error:', error);
                alert('âŒ å°å‡º Excel æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š' + error.message);
            }
        }


    </script>
</body>

</html>