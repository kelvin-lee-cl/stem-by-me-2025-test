<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STEM-by-ME 2025 - 管理員頁面</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');

        body {
            font-family: 'Orbitron', 'Courier New', monospace;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 25%, #16213e 50%, #0f3460 75%, #533483 100%);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .container {
            background: rgba(10, 10, 10, 0.9);
            border: 2px solid #00ffff;
            border-radius: 0;
            box-shadow:
                0 0 20px rgba(0, 255, 255, 0.5),
                inset 0 0 20px rgba(0, 255, 255, 0.1);
            overflow: hidden;
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            backdrop-filter: blur(10px);
        }

        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, #00ffff, transparent);
            animation: scan 3s linear infinite;
        }

        @keyframes scan {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }

        .header {
            background: linear-gradient(135deg, #ff0080 0%, #8000ff 50%, #0080ff 100%);
            color: #ffffff;
            padding: 30px;
            text-align: center;
            position: relative;
            border-bottom: 3px solid #00ffff;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
            animation: shimmer 2s ease-in-out infinite;
        }

        @keyframes shimmer {

            0%,
            100% {
                transform: translateX(-100%);
            }

            50% {
                transform: translateX(100%);
            }
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
                opacity: 0.3;
            }

            50% {
                transform: scale(1.1);
                opacity: 0.6;
            }
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 3px;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .content {
            padding: 40px;
            max-width: 100%;
            background: rgba(0, 0, 0, 0.8);
            color: #00ffff;
        }

        /* Login Form Styles */
        .login-form {
            max-width: 400px;
            margin: 0 auto;
            text-align: center;
            background: rgba(0, 0, 0, 0.7);
            padding: 30px;
            border: 2px solid #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #000000;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
        }

        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #00ffff;
            border-radius: 0;
            font-size: 16px;
            background: rgba(0, 0, 0, 0.8);
            color: #00ffff;
            font-family: 'Orbitron', monospace;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
        }

        .form-group input:focus {
            outline: none;
            border-color: #ff0080;
            box-shadow: 0 0 20px rgba(255, 0, 128, 0.5);
            background: rgba(0, 0, 0, 0.9);
        }

        .form-group input::placeholder {
            color: rgba(0, 255, 255, 0.5);
        }

        .login-btn {
            background: linear-gradient(135deg, #ff0080 0%, #8000ff 100%);
            color: #ffffff;
            border: 2px solid #00ffff;
            padding: 15px 30px;
            border-radius: 0;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(255, 0, 128, 0.5);
        }

        .login-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }



        .error-message {
            background: rgba(255, 0, 0, 0.2);
            color: #ff0080;
            padding: 15px;
            border: 2px solid #ff0080;
            border-radius: 0;
            margin-bottom: 20px;
            display: none;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 0 15px rgba(255, 0, 128, 0.5);
            font-weight: bold;
        }

        /* Admin Dashboard Styles */
        .admin-dashboard {
            display: none;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 25px;
            border-bottom: 3px solid #00ffff;
            position: relative;
        }

        .dashboard-header::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, #00ffff, #ff0080, #8000ff, #00ffff);
            animation: borderGlow 3s linear infinite;
        }

        @keyframes borderGlow {
            0% {
                background-position: 0% 50%;
            }

            100% {
                background-position: 100% 50%;
            }
        }

        .dashboard-header h2 {
            font-size: 2.2em;
            color: #00ffff;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
            font-weight: 900;
        }

        .logout-btn {
            background: rgba(255, 0, 0, 0.2);
            color: #ff0080;
            border: 2px solid #ff0080;
            padding: 12px 24px;
            border-radius: 0;
            cursor: pointer;
            font-weight: bold;
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(255, 0, 128, 0.3);
        }



        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.8);
            padding: 25px;
            border-radius: 0;
            text-align: center;
            border: 2px solid #00ffff;
            box-shadow:
                0 0 20px rgba(0, 255, 255, 0.3),
                inset 0 0 20px rgba(0, 255, 255, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }



        .stat-number {
            font-size: 2.5em;
            font-weight: 900;
            color: #00ffff;
            margin-bottom: 10px;
            text-shadow: 0 0 15px rgba(0, 255, 255, 0.8);
            position: relative;
            z-index: 1;
        }

        .stat-label {
            color: #ffffff;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            z-index: 1;
        }

        .filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 0;
            border: 2px solid #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
            position: relative;
        }

        .filters::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #00ffff, #ff0080, #8000ff, #00ffff);
            animation: borderGlow 3s linear infinite;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .filter-group label {
            font-weight: bold;
            color: #00ffff;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
        }

        .filter-group select,
        .filter-group input {
            padding: 12px 15px;
            border: 2px solid #00ffff;
            border-radius: 0;
            font-size: 14px;
            background: rgba(0, 0, 0, 0.8);
            color: #00ffff;
            font-family: 'Orbitron', monospace;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
        }

        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: #ff0080;
            box-shadow: 0 0 20px rgba(255, 0, 128, 0.5);
            background: rgba(0, 0, 0, 0.9);
        }

        .filter-group select option {
            background: #000;
            color: #00ffff;
        }

        .refresh-btn {
            background: rgba(40, 167, 69, 0.2);
            color: #00ff00;
            border: 2px solid #00ff00;
            padding: 12px 20px;
            border-radius: 0;
            cursor: pointer;
            font-weight: bold;
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .refresh-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 0, 0.2), transparent);
            transition: left 0.5s;
        }



        .export-btn {
            background: rgba(23, 162, 184, 0.2);
            color: #00ffff;
            border: 2px solid #00ffff;
            padding: 12px 20px;
            border-radius: 0;
            cursor: pointer;
            font-weight: bold;
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
        }

        .export-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }



        .status-btn {
            background: rgba(111, 66, 193, 0.2);
            color: #8000ff;
            border: 2px solid #8000ff;
            padding: 12px 20px;
            border-radius: 0;
            cursor: pointer;
            font-weight: bold;
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(128, 0, 255, 0.3);
            position: relative;
            overflow: hidden;
        }

        .status-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(128, 0, 255, 0.2), transparent);
            transition: left 0.5s;
        }



        .info-btn {
            background: rgba(32, 201, 151, 0.2);
            color: #20c997;
            border: 2px solid #20c997;
            padding: 12px 20px;
            border-radius: 0;
            cursor: pointer;
            font-weight: bold;
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(32, 201, 151, 0.3);
            position: relative;
            overflow: hidden;
        }

        .info-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(32, 201, 151, 0.2), transparent);
            transition: left 0.5s;
        }

        .test-btn {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
            border: 2px solid #ff6b6b;
            padding: 12px 20px;
            border-radius: 0;
            cursor: pointer;
            font-weight: bold;
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(255, 107, 107, 0.3);
            position: relative;
            overflow: hidden;
        }

        .test-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 107, 107, 0.2), transparent);
            transition: left 0.5s;
        }

        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 25px rgba(255, 107, 107, 0.5);
        }



        /* Status Modal Styles */
        .status-modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
        }

        .status-modal-content {
            background: rgba(0, 0, 0, 0.95);
            margin: 5% auto;
            padding: 30px;
            border-radius: 0;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            border: 2px solid #00ffff;
            box-shadow:
                0 0 30px rgba(0, 255, 255, 0.5),
                inset 0 0 30px rgba(0, 255, 255, 0.1);
            position: relative;
        }

        .status-modal-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #00ffff, #ff0080, #8000ff, #00ffff);
            animation: borderGlow 3s linear infinite;
        }

        .status-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #00ffff;
        }

        .status-modal-header h3 {
            color: #00ffff;
            font-size: 1.5em;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
        }

        .status-modal-close {
            background: rgba(255, 0, 0, 0.2);
            color: #ff0080;
            border: 2px solid #ff0080;
            padding: 10px 15px;
            border-radius: 0;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(255, 0, 128, 0.3);
        }



        /* Status Summary Card */
        .status-summary {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 4px solid #667eea;
        }

        .status-summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .status-summary-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
        }

        .status-summary-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 10px;
        }

        .status-stat {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-stat-label {
            font-size: 0.9em;
            color: #666;
        }

        .status-stat-value {
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
        }

        .status-stat-success {
            background: #d4edda;
            color: #155724;
        }

        .status-stat-warning {
            background: #fff3cd;
            color: #856404;
        }

        .status-stat-error {
            background: #f8d7da;
            color: #721c24;
        }

        .status-stat-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        /* Status Table */
        .status-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .status-table th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: bold;
        }

        .status-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
        }



        .status-table tr:last-child td {
            border-bottom: none;
        }

        .status-badge {
            padding: 6px 16px;
            border-radius: 0;
            font-weight: bold;
            font-size: 0.8em;
            text-align: center;
            min-width: 80px;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: 1px solid;
            box-shadow: 0 0 10px;
        }

        .status-badge-success {
            background: rgba(0, 255, 0, 0.2);
            color: #00ff00;
            border-color: #00ff00;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
        }

        .status-badge-error {
            background: rgba(255, 0, 0, 0.2);
            color: #ff0080;
            border-color: #ff0080;
            box-shadow: 0 0 10px rgba(255, 0, 128, 0.3);
        }

        .status-badge-warning {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
            border-color: #ffc107;
            box-shadow: 0 0 10px rgba(255, 193, 7, 0.3);
        }

        .status-badge-info {
            background: rgba(0, 255, 255, 0.2);
            color: #00ffff;
            border-color: #00ffff;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
        }

        .status-details {
            font-size: 0.9em;
            color: #666;
            font-style: italic;
            margin-top: 5px;
        }

        /* Legend Styles */
        .legend-section {
            margin-bottom: 30px;
        }

        .legend-section h4 {
            color: #ffffff;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .legend-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .legend-item p {
            margin: 0;
            font-size: 0.9em;
            color: #666;
        }

        .legend-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .legend-list-item {
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .legend-list-item strong {
            color: #333;
            display: block;
            margin-bottom: 5px;
        }

        .legend-list-item p {
            margin: 0;
            font-size: 0.9em;
            color: #666;
        }

        .scores-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(0, 0, 0, 0.9);
            border-radius: 0;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
            border: 2px solid #00ffff;
        }

        .scores-table th {
            background: linear-gradient(135deg, #ff0080 0%, #8000ff 50%, #0080ff 100%);
            color: #ffffff;
            padding: 18px 20px;
            text-align: left;
            font-weight: bold;
            font-size: 1.1em;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
            border-bottom: 2px solid #00ffff;
        }

        .scores-table td {
            padding: 16px 20px;
            border-bottom: 1px solid rgba(0, 255, 255, 0.3);
            font-size: 1em;
            color: #00ffff;
            background: rgba(0, 0, 0, 0.7);
        }



        .status-win {
            background: rgba(0, 255, 0, 0.2);
            color: #00ff00;
            padding: 6px 12px;
            border-radius: 0;
            font-size: 0.8em;
            font-weight: bold;
            border: 1px solid #00ff00;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
        }

        .status-lose {
            background: rgba(255, 0, 0, 0.2);
            color: #ff0080;
            padding: 6px 12px;
            border-radius: 0;
            font-size: 0.8em;
            font-weight: bold;
            border: 1px solid #ff0080;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 0 10px rgba(255, 0, 128, 0.3);
        }

        .loading {
            text-align: center;
            padding: 60px;
            color: #00ffff;
            font-size: 1.1em;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 0;
            border: 2px dashed #00ffff;
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
            position: relative;
        }

        .loading::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 40px;
            height: 40px;
            margin: -20px 0 0 -20px;
            border: 3px solid transparent;
            border-top: 3px solid #00ffff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .no-data {
            text-align: center;
            padding: 60px;
            color: #ff0080;
            font-style: italic;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 0;
            border: 2px dashed #ff0080;
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 0 0 20px rgba(255, 0, 128, 0.3);
        }

        .dashboard-section {
            margin-bottom: 50px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 0;
            padding: 30px;
            border: 2px solid #00ffff;
            box-shadow:
                0 0 20px rgba(0, 255, 255, 0.3),
                inset 0 0 20px rgba(0, 255, 255, 0.1);
            position: relative;
        }

        .dashboard-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #00ffff, #ff0080, #8000ff, #00ffff);
            animation: borderGlow 3s linear infinite;
        }

        .dashboard-section h3 {
            font-size: 1.5em;
            font-weight: bold;
            color: #00ffff;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #00ffff;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
        }

        /* Admin Panel Styles */
        .admin-section {
            position: relative;
            margin-bottom: 30px;
        }

        .admin-toggle {
            background: linear-gradient(135deg, #ff0080 0%, #8000ff 100%);
            color: #ffffff;
            border: 2px solid #00ffff;
            padding: 15px 30px;
            border-radius: 0;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 25px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(255, 0, 128, 0.5);
        }

        .admin-toggle::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .admin-toggle:hover::before {
            left: 100%;
        }

        .admin-toggle:hover {
            background: linear-gradient(135deg, #8000ff 0%, #ff0080 100%);
            transform: translateY(-2px);
            box-shadow: 0 0 30px rgba(255, 0, 128, 0.7);
        }

        .admin-toggle.active {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            border-color: #ff0080;
        }

        #admin-panel {
            display: none;
            background: rgba(0, 0, 0, 0.8);
            padding: 30px;
            border: 2px solid #00ffff;
            border-radius: 0;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
            margin-bottom: 30px;
        }

        /* Admin Stats */
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 35px;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.8);
            padding: 25px;
            border-radius: 0;
            text-align: center;
            border: 2px solid #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        .stat-card:hover::before {
            left: 100%;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
        }

        .stat-card h4 {
            color: #00ffff;
            margin-bottom: 15px;
            font-size: 1.1em;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
        }

        .stat-card .stat-value {
            font-size: 32px;
            font-weight: 900;
            color: #00ffff;
            text-shadow: 0 0 15px rgba(0, 255, 255, 0.8);
        }

        /* Admin Controls */
        .admin-controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 35px;
            justify-content: center;
        }

        .admin-controls .btn {
            min-width: 140px;
        }

        /* User Management */
        .user-management {
            background: rgba(0, 0, 0, 0.8);
            padding: 25px;
            border-radius: 0;
            margin-bottom: 30px;
            border: 2px solid #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }

        .user-management h4 {
            color: #00ffff;
            margin-bottom: 20px;
            font-size: 1.3em;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
        }

        .user-search {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .user-search input {
            padding: 12px 15px;
            border: 2px solid #00ffff;
            border-radius: 0;
            font-size: 14px;
            background: rgba(0, 0, 0, 0.8);
            color: #00ffff;
            font-family: 'Orbitron', monospace;
            flex: 1;
            min-width: 200px;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
        }

        .user-search input:focus {
            outline: none;
            border-color: #ff0080;
            box-shadow: 0 0 20px rgba(255, 0, 128, 0.5);
            background: rgba(0, 0, 0, 0.9);
        }

        .user-search input::placeholder {
            color: rgba(0, 255, 255, 0.5);
        }

        #user-details {
            display: none;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 0;
            margin-top: 20px;
            border: 2px solid #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
            color: #00ffff;
        }

        .group-badge {
            padding: 4px 12px;
            border-radius: 0;
            font-size: 12px;
            font-weight: bold;
            margin-left: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .group-badge.junior {
            background: rgba(0, 255, 255, 0.2);
            color: #00ffff;
            border: 1px solid #00ffff;
        }

        .group-badge.senior {
            background: rgba(255, 0, 128, 0.2);
            color: #ff0080;
            border: 1px solid #ff0080;
        }

        /* Winners Section */
        .winners-section {
            margin-bottom: 35px;
        }

        .winners-section h4 {
            color: #00ffff;
            margin-bottom: 20px;
            font-size: 1.3em;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
        }

        #winners-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .winner-card {
            background: rgba(0, 0, 0, 0.8);
            padding: 25px;
            border-radius: 0;
            text-align: center;
            position: relative;
            transition: all 0.3s ease;
            border: 2px solid #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }

        .winner-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
        }

        .rank-badge {
            position: absolute;
            top: -10px;
            left: -10px;
            width: 35px;
            height: 35px;
            border-radius: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 16px;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .rank-1 {
            background: linear-gradient(135deg, #ff0080, #8000ff);
            border: 2px solid #ff0080;
        }

        .rank-2 {
            background: linear-gradient(135deg, #00ffff, #0080ff);
            border: 2px solid #00ffff;
        }

        .rank-3 {
            background: linear-gradient(135deg, #8000ff, #ff0080);
            border: 2px solid #8000ff;
        }

        .rank-4 {
            background: linear-gradient(135deg, #00ff00, #008000);
            border: 2px solid #00ff00;
        }

        .rank-5 {
            background: linear-gradient(135deg, #ff8000, #ff4000);
            border: 2px solid #ff8000;
        }

        .winner-photo {
            font-size: 60px;
            margin-bottom: 15px;
            color: #00ffff;
        }

        .winner-info h4 {
            color: #00ffff;
            margin-bottom: 12px;
            font-size: 1.2em;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
        }

        .winner-info p {
            color: #ffffff;
            margin-bottom: 8px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .winner-info .latest-game,
        .winner-info .latest-location {
            color: #00ffff;
            font-weight: bold;
            margin-bottom: 10px;
            padding: 5px;
            background: rgba(0, 255, 255, 0.1);
            border-left: 3px solid #00ffff;
            border-radius: 0;
        }

        .winner-score {
            font-size: 24px;
            font-weight: bold;
            color: #00ff00;
            margin-top: 15px;
            text-shadow: 0 0 10px rgba(0, 255, 0, 0.8);
        }

        /* Photos Section */
        .photos-section h4 {
            color: #00ffff;
            margin-bottom: 20px;
            font-size: 1.3em;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
        }

        /* Manual Review Section */
        .manual-review-section {
            margin-bottom: 35px;
        }

        .manual-review-section h4 {
            color: #00ffff;
            margin-bottom: 20px;
            font-size: 1.3em;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
        }

        .review-controls {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .review-controls label {
            font-weight: bold;
            color: #00ffff;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
        }

        .review-controls select {
            padding: 8px 12px;
            border: 2px solid #00ffff;
            border-radius: 0;
            font-size: 14px;
            background: rgba(0, 0, 0, 0.8);
            color: #00ffff;
            font-family: 'Orbitron', monospace;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
        }

        .review-controls select:focus {
            outline: none;
            border-color: #ff0080;
            box-shadow: 0 0 20px rgba(255, 0, 128, 0.5);
            background: rgba(0, 0, 0, 0.9);
        }

        .review-controls select option {
            background: #000;
            color: #00ffff;
        }

        #review-photos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .review-photo-card {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 0;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
            transition: all 0.3s ease;
            position: relative;
            border: 2px solid #00ffff;
        }

        .review-photo-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
        }

        .review-photo-card.pending {
            border-color: #ff8000;
            box-shadow: 0 0 20px rgba(255, 128, 0, 0.3);
        }

        .review-photo-card.approved {
            border-color: #00ff00;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
        }

        .review-photo-card.rejected {
            border-color: #ff0080;
            box-shadow: 0 0 20px rgba(255, 0, 128, 0.3);
        }

        .review-photo-image-container {
            height: 200px;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border-bottom: 2px solid #00ffff;
        }

        /* Photo Format Test Section */
        .photo-format-test-section {
            margin-bottom: 35px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid #ff0080;
            border-radius: 0;
        }

        .photo-format-test-section h4 {
            color: #ff0080;
            margin-bottom: 20px;
            font-size: 1.3em;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 0 5px rgba(255, 0, 128, 0.5);
        }

        .test-controls {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .test-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 0;
            font-family: 'Orbitron', monospace;
            white-space: pre-wrap;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #ff0080;
            color: #ff0080;
        }

        .test-result.success {
            background: rgba(0, 255, 0, 0.1);
            color: #00ff00;
            border-color: #00ff00;
        }

        .test-result.error {
            background: rgba(255, 0, 128, 0.1);
            color: #ff0080;
            border-color: #ff0080;
        }

        .test-result.info {
            background: rgba(0, 255, 255, 0.1);
            color: #00ffff;
            border-color: #00ffff;
        }

        #photoFormatDisplayTest .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        #photoFormatDisplayTest .photo-card {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 0;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(255, 0, 128, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }

        #photoFormatDisplayTest .photo-card.review-photo {
            border: 2px solid;
            position: relative;
        }

        #photoFormatDisplayTest .photo-card.review-photo.pending {
            border-color: #ffc107;
            box-shadow: 0 0 20px rgba(255, 193, 7, 0.3);
        }

        #photoFormatDisplayTest .photo-card.review-photo.approved {
            border-color: #28a745;
            box-shadow: 0 0 20px rgba(40, 167, 69, 0.3);
        }

        #photoFormatDisplayTest .photo-card.review-photo.rejected {
            border-color: #dc3545;
            box-shadow: 0 0 20px rgba(220, 53, 69, 0.3);
        }

        #photoFormatDisplayTest .photo-status-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: 1px solid;
            z-index: 10;
        }

        #photoFormatDisplayTest .photo-status-badge.pending {
            background: rgba(255, 193, 7, 0.2);
            color: #856404;
            border-color: #ffc107;
        }

        #photoFormatDisplayTest .photo-status-badge.approved {
            background: rgba(40, 167, 69, 0.2);
            color: #155724;
            border-color: #28a745;
        }

        #photoFormatDisplayTest .photo-status-badge.rejected {
            background: rgba(220, 53, 69, 0.2);
            color: #721c24;
            border-color: #dc3545;
        }

        #photoFormatDisplayTest .photo-image-container {
            height: 200px;
            background: rgba(255, 0, 128, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }

        #photoFormatDisplayTest .photo-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        #photoFormatDisplayTest .photo-info {
            padding: 20px;
        }

        #photoFormatDisplayTest .photo-filename-display {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 14px;
            color: #ff0080;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        #photoFormatDisplayTest .photo-user,
        #photoFormatDisplayTest .photo-timestamp,
        #photoFormatDisplayTest .photo-size {
            font-size: 12px;
            color: #00ffff;
            margin-bottom: 5px;
        }

        #photoFormatDisplayTest .photo-game-type {
            color: #ff0080;
            font-weight: bold;
            margin-bottom: 10px;
            padding: 5px;
            background: rgba(255, 0, 128, 0.1);
            border-radius: 5px;
            font-size: 12px;
        }

        #photoFormatDisplayTest .photo-location-details {
            margin-top: 10px;
            padding: 10px;
            background: rgba(255, 0, 128, 0.05);
            border-left: 3px solid #ff0080;
            border-radius: 5px;
        }

        #photoFormatDisplayTest .photo-location-details div {
            margin-bottom: 3px;
            font-size: 11px;
            color: #00ffff;
        }

        .review-photo-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .review-photo-info {
            padding: 20px;
            background: rgba(0, 0, 0, 0.8);
        }

        .review-photo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .review-status-badge {
            padding: 4px 12px;
            border-radius: 0;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .review-status-badge.pending {
            background: rgba(255, 128, 0, 0.2);
            color: #ff8000;
            border: 1px solid #ff8000;
        }

        .review-status-badge.approved {
            background: rgba(0, 255, 0, 0.2);
            color: #00ff00;
            border: 1px solid #00ff00;
        }

        .review-status-badge.rejected {
            background: rgba(255, 0, 128, 0.2);
            color: #ff0080;
            border: 1px solid #ff0080;
        }

        .review-photo-details {
            margin-bottom: 15px;
        }

        .review-photo-details p {
            font-size: 12px;
            color: #ffffff;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .review-photo-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .review-action-btn {
            padding: 8px 16px;
            border: 2px solid;
            border-radius: 0;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 80px;
        }

        .review-action-btn.approve {
            background: rgba(0, 255, 0, 0.2);
            color: #00ff00;
            border-color: #00ff00;
        }

        .review-action-btn.approve:hover {
            background: rgba(0, 255, 0, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.5);
        }

        .review-action-btn.reject {
            background: rgba(255, 0, 128, 0.2);
            color: #ff0080;
            border-color: #ff0080;
        }

        .review-action-btn.reject:hover {
            background: rgba(255, 0, 128, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(255, 0, 128, 0.5);
        }

        .review-action-btn.view {
            background: rgba(0, 255, 255, 0.2);
            color: #00ffff;
            border-color: #00ffff;
        }

        .review-action-btn.view:hover {
            background: rgba(0, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
        }

        .review-score-input {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid #00ffff;
            border-radius: 0;
            font-size: 14px;
            background: rgba(0, 0, 0, 0.8);
            color: #00ffff;
            font-family: 'Orbitron', monospace;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
        }

        .review-score-input:focus {
            outline: none;
            border-color: #ff0080;
            box-shadow: 0 0 20px rgba(255, 0, 128, 0.5);
            background: rgba(0, 0, 0, 0.9);
        }

        .review-score-input::placeholder {
            color: rgba(0, 255, 255, 0.5);
        }

        .photos-controls {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .photos-controls label {
            font-weight: bold;
            color: #00ffff;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
        }

        .photos-controls select {
            padding: 8px 12px;
            border: 2px solid #00ffff;
            border-radius: 0;
            font-size: 14px;
            background: rgba(0, 0, 0, 0.8);
            color: #00ffff;
            font-family: 'Orbitron', monospace;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
        }

        .photos-controls select:focus {
            outline: none;
            border-color: #ff0080;
            box-shadow: 0 0 20px rgba(255, 0, 128, 0.5);
            background: rgba(0, 0, 0, 0.9);
        }

        .photos-controls select option {
            background: #000;
            color: #00ffff;
        }

        #all-photos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
        }

        .photo-card {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 0;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
            transition: all 0.3s ease;
            position: relative;
            border: 2px solid #00ffff;
        }

        .photo-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
        }

        .photo-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(135deg, #00ffff, #ff0080);
            transform: scaleX(0);
            transition: transform 0.3s ease;
            z-index: 1;
        }

        .photo-card:hover::before {
            transform: scaleX(1);
        }

        .photo-card.approved-photo {
            border: 2px solid #00ff00;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
        }

        .photo-card.approved-photo:hover {
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.5);
        }

        .photo-approval-info {
            margin: 10px 0;
            padding: 8px;
            background: rgba(0, 255, 0, 0.1);
            border-radius: 4px;
            border-left: 3px solid #00ff00;
        }

        .approval-badge {
            color: #00ff00;
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .approved-score {
            color: #00ff00;
            font-weight: bold;
        }

        .reviewed-by,
        .reviewed-at {
            color: #cccccc;
            font-size: 11px;
        }

        .photo-image-container {
            height: 160px;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border-bottom: 2px solid #00ffff;
        }

        .photo-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-image-placeholder {
            text-align: center;
            color: #00ffff;
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
        }

        .photo-icon {
            font-size: 40px;
            margin-bottom: 8px;
            color: #00ffff;
        }

        .photo-filename {
            font-size: 12px;
            word-break: break-all;
            padding: 0 10px;
            color: #00ffff;
        }

        .photo-info {
            padding: 15px;
            background: rgba(0, 0, 0, 0.8);
        }

        .photo-filename-display {
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 14px;
            color: #00ffff;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
        }

        .photo-user,
        .photo-timestamp,
        .photo-size,
        .photo-game-type,
        .photo-location-details,
        .photo-approval-info {
            font-size: 12px;
            color: #ffffff;
            margin-bottom: 3px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .photo-game-type {
            color: #00ffff;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .photo-location-details {
            margin: 8px 0;
            padding: 8px;
            background: rgba(0, 255, 255, 0.1);
            border-left: 3px solid #00ffff;
            border-radius: 0;
        }

        .photo-location-details div {
            margin-bottom: 2px;
            font-size: 11px;
        }

        /* Loading and No Data States */
        .loading,
        .no-photos {
            text-align: center;
            padding: 50px;
            color: #00ffff;
            font-style: italic;
            font-size: 1.1em;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
        }

        /* Button Styles */
        .btn {
            padding: 15px 30px;
            border: 2px solid #00ffff;
            border-radius: 0;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:disabled {
            cursor: not-allowed;
            opacity: 0.7;
            transform: none !important;
        }

        .btn.loading {
            color: transparent;
            pointer-events: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .btn.loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 18px;
            height: 18px;
            margin: -9px 0 0 -9px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 0.4s linear infinite;
            opacity: 1;
        }

        .btn.loading::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 24px;
            height: 24px;
            margin: -12px 0 0 -12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: pulse 0.8s ease-in-out infinite;
            opacity: 0.3;
        }

        .btn-success {
            background: rgba(0, 255, 0, 0.2);
            color: #00ff00;
            border-color: #00ff00;
        }

        .btn-success:hover {
            background: rgba(0, 255, 0, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.5);
        }

        .btn-primary {
            background: rgba(0, 255, 255, 0.2);
            color: #00ffff;
            border-color: #00ffff;
        }

        .btn-primary:hover {
            background: rgba(0, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
        }

        .btn-danger {
            background: rgba(255, 0, 128, 0.2);
            color: #ff0080;
            border-color: #ff0080;
        }

        .btn-danger:hover {
            background: rgba(255, 0, 128, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 0 30px rgba(255, 0, 128, 0.5);
        }

        .btn-warning {
            background: rgba(255, 128, 0, 0.2);
            color: #ff8000;
            border-color: #ff8000;
        }

        .btn-warning:hover {
            background: rgba(255, 128, 0, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 0 30px rgba(255, 128, 0, 0.5);
        }

        .btn-info {
            background: rgba(128, 0, 255, 0.2);
            color: #8000ff;
            border-color: #8000ff;
        }

        .btn-info:hover {
            background: rgba(128, 0, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 0 30px rgba(128, 0, 255, 0.5);
        }

        /* Firebase Status Styles */
        .firebase-status {
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 0;
            margin-bottom: 30px;
            border: 2px solid #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }

        .firebase-status h4 {
            color: #00ffff;
            margin-bottom: 15px;
            font-size: 1.2em;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
        }

        #firebase-status-display {
            color: #ffffff;
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .status-item {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 0;
            border-left: 3px solid #00ffff;
            background: rgba(0, 0, 0, 0.5);
        }

        .status-item.success {
            border-left-color: #00ff00;
            color: #00ff00;
        }

        .status-item.warning {
            border-left-color: #ff8000;
            color: #ff8000;
        }

        .status-item.error {
            border-left-color: #ff0080;
            color: #ff0080;
        }

        /* Notification Styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #00ffff;
            border-radius: 0;
            padding: 20px;
            color: #00ffff;
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
            z-index: 10000;
            max-width: 400px;
            animation: slideIn 0.3s ease-out;
        }

        .notification.success {
            border-color: #00ff00;
            color: #00ff00;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
        }

        .notification.error {
            border-color: #ff0080;
            color: #ff0080;
            box-shadow: 0 0 20px rgba(255, 0, 128, 0.5);
        }

        .notification.warning {
            border-color: #ff8000;
            color: #ff8000;
            box-shadow: 0 0 20px rgba(255, 128, 0, 0.5);
        }

        .notification.info {
            border-color: #8000ff;
            color: #8000ff;
            box-shadow: 0 0 20px rgba(128, 0, 255, 0.5);
        }

        .notification-title {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 8px;
            text-shadow: 0 0 5px currentColor;
        }

        .notification-message {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .notification-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: currentColor;
            font-size: 18px;
            cursor: pointer;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .notification-close:hover {
            transform: scale(1.2);
            text-shadow: 0 0 10px currentColor;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #c0392b, #a93226);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }

        .btn-warning:hover {
            background: linear-gradient(135deg, #e67e22, #d35400);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(243, 156, 18, 0.4);
        }

        .btn-info {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
        }

        .btn-info:hover {
            background: linear-gradient(135deg, #138496, #117a8b);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(23, 162, 184, 0.4);
        }

        @keyframes pulse {
            0% {
                transform: scale(0.9);
                opacity: 0.2;
            }

            50% {
                transform: scale(1.1);
                opacity: 0.4;
            }

            100% {
                transform: scale(1.3);
                opacity: 0.2;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                margin: 0;
                border-radius: 0;
            }

            .content {
                padding: 20px;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .dashboard-header h2 {
                font-size: 1.6em;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .stat-card {
                padding: 20px;
            }

            .filters {
                grid-template-columns: 1fr;
                gap: 15px;
                padding: 20px;
            }

            .dashboard-section {
                padding: 20px;
                margin-bottom: 30px;
            }

            .dashboard-section h3 {
                font-size: 1.3em;
            }

            .scores-table {
                font-size: 0.9em;
            }

            .scores-table th,
            .scores-table td {
                padding: 12px 15px;
            }

            .status-modal-content {
                margin: 10px;
                width: calc(100% - 20px);
                max-width: none;
                padding: 20px;
            }

            .status-summary-stats {
                flex-direction: column;
                gap: 10px;
            }

            .status-table {
                font-size: 0.9em;
            }

            .status-table th,
            .status-table td {
                padding: 10px 12px;
            }

            .legend-grid {
                grid-template-columns: 1fr;
            }

            .legend-item {
                flex-direction: column;
                text-align: center;
            }

            .loading,
            .no-data {
                padding: 40px 20px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>🎮 STEM-by-ME 2025</h1>
            <p>管理員控制台 / Admin Dashboard</p>
        </div>

        <div class="content">
            <!-- Login Form -->
            <div id="loginForm" class="login-form">
                <h2 style="margin-bottom: 30px; color: #333;">管理員登入</h2>
                <div id="errorMessage" class="error-message"></div>
                <div class="form-group">
                    <label for="adminPassword">管理員密碼</label>
                    <input type="password" id="adminPassword" placeholder="請輸入管理員密碼">
                </div>
                <button class="login-btn" onclick="login()">登入</button>
            </div>

            <!-- Admin Dashboard -->
            <div id="adminDashboard" class="admin-dashboard">
                <div class="dashboard-header">
                    <h2>📊 玩家分數統計</h2>
                    <button class="logout-btn" onclick="logout()">登出</button>
                </div>

                <!-- Statistics -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalPlayers">0</div>
                        <div class="stat-label">總玩家數</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalGames">0</div>
                        <div class="stat-label">總遊戲次數</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalWins">0</div>
                        <div class="stat-label">總勝利次數</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="avgScore">0</div>
                        <div class="stat-label">平均分數</div>
                    </div>
                </div>

                <!-- Filters -->
                <div class="filters">
                    <div class="filter-group">
                        <label>遊戲篩選</label>
                        <select id="gameFilter">
                            <option value="">所有遊戲</option>
                            <option value="game1">遊戲 1</option>
                            <option value="game2">遊戲 2</option>
                            <option value="game3">遊戲 3</option>
                            <option value="game4">遊戲 4</option>
                            <option value="game5">遊戲 5</option>
                            <option value="game6">遊戲 6</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>狀態篩選</label>
                        <select id="statusFilter">
                            <option value="">所有狀態</option>
                            <option value="win">勝利</option>
                            <option value="lose">失敗</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>玩家名稱</label>
                        <input type="text" id="playerFilter" placeholder="搜尋玩家名稱">
                    </div>
                    <div class="filter-group">
                        <label>&nbsp;</label>
                        <button class="refresh-btn" onclick="loadScores()">🔄 重新整理</button>
                    </div>
                    <div class="filter-group">
                        <label>&nbsp;</label>
                        <button class="export-btn" onclick="exportToExcel()">📊 導出 Excel</button>
                    </div>
                    <div class="filter-group">
                        <label>&nbsp;</label>
                        <button class="status-btn" onclick="checkSystemStatus()">🔍 詳細狀態</button>
                    </div>
                    <div class="filter-group">
                        <label>&nbsp;</label>
                        <button class="refresh-btn" onclick="startRealTimeMonitoring()" id="monitorBtn">📡
                            開始實時監測</button>
                    </div>
                    <div class="filter-group">
                        <label>&nbsp;</label>
                        <button class="info-btn" onclick="showStatusLegend()">ℹ️ 狀態說明</button>
                    </div>
                    <div class="filter-group">
                        <label>&nbsp;</label>
                        <button class="test-btn" onclick="createTestData()">🧪 創建測試數據</button>
                    </div>
                    <div class="filter-group">
                        <label>&nbsp;</label>
                        <button class="test-btn" onclick="createTestReviewPhoto()">📸 創建測試審核照片</button>
                    </div>
                    <button class="btn btn-primary" id="refresh-photos">🔄 重新載入照片</button>
                    <button class="btn btn-success" id="export-data">📊 匯出數據</button>
                    <button class="btn btn-warning" id="export-users">👥 匯出玩家數據</button>
                    <button class="btn btn-danger" id="reset-all-users">⚠️ 重置所有玩家</button>
                    <button class="btn btn-danger" id="clear-all-photos">🗑️ 清除所有照片</button>
                    <button class="btn btn-info" onclick="testPhotoUpload()">🔍 測試照片系統</button>
                    <button class="btn btn-info" onclick="createTestPhoto()">📸 創建測試照片</button>
                    <button class="btn btn-info" onclick="checkFirebaseStatus()">🔥 檢查 Firebase</button>
                    <button class="btn btn-info" onclick="debugReviewPhotos()">🔍 調試審核照片</button>
                    <button class="btn btn-info" onclick="showDocumentIDs()">🆔 顯示文檔ID</button>
                </div>

                <!-- Scores Table -->
                <div class="dashboard-section">
                    <h3>📊 玩家分數記錄</h3>
                    <div id="scoresContainer">
                        <div class="loading">載入中...</div>
                    </div>
                </div>

                <!-- System Status Section -->
                <div class="dashboard-section">
                    <h3>🔍 系統狀態監測</h3>
                    <div id="systemStatusContainer">
                        <div class="loading">載入系統狀態中...</div>
                    </div>
                </div>
            </div>
        </div>
        <button class="admin-toggle" id="admin-toggle">🔧 管理員面板</button>

        <div id="admin-panel">
            <!-- Admin Stats -->
            <div class="admin-stats">
                <div class="stat-card">
                    <h4>總玩家數</h4>
                    <div class="stat-value" id="total-users">0</div>
                </div>
                <div class="stat-card">
                    <h4>活躍玩家</h4>
                    <div class="stat-value" id="active-users">0</div>
                </div>
                <div class="stat-card">
                    <h4>完成遊戲</h4>
                    <div class="stat-value" id="completed-users">0</div>
                </div>
                <div class="stat-card">
                    <h4>總分數</h4>
                    <div class="stat-value" id="total-score">0</div>
                </div>
            </div>

            <!-- Group Stats -->
            <div id="junior-stats"></div>
            <div id="senior-stats"></div>

            <!-- Firebase Status -->
            <div class="firebase-status"
                style="margin-bottom: 20px; padding: 15px; border-radius: 10px; background: #f8f9fa; border-left: 4px solid #17a2b8;">
                <h4 style="margin: 0 0 10px 0; color: #2c3e50;">🔥 Firebase 狀態</h4>
                <div id="firebase-status-display" style="color: #000000;">
                    <p>載入中...</p>
                </div>
            </div>

            <!-- Admin Controls -->
            

            <!-- User Management -->
            <div class="user-management">
                <h4>👤 玩家管理</h4>
                <div class="user-search">
                    <input type="text" id="user-search-input" placeholder="輸入玩家編號">
                    <button class="btn btn-primary" id="search-user-btn">搜尋</button>
                </div>

                <div id="user-details">
                    <h4 id="selected-user-name"></h4>
                    <p>完成位置: <span id="user-completed-count">0</span>/21</p>
                    <p>當前分數: <span id="user-current-score">0</span>分</p>
                    <div style="margin-top: 15px;">
                        <input type="number" id="user-points-input" placeholder="新分數"
                            style="width: 120px; margin-right: 15px; padding: 8px 12px; border: 2px solid #e1e8ed; border-radius: 8px;">
                        <button class="btn btn-success" id="update-user-points-btn">更新分數</button>
                    </div>
                    <div id="user-photos-grid" style="margin-top: 20px;"></div>
                </div>
            </div>

            <!-- Winners Section -->
            <div class="winners-section">
                <h4>🏆 排行榜 (前5名)</h4>
                <div id="winners-list"></div>
            </div>

            <!-- Photos Section -->
            <div class="photos-section">
                <h4>✅ 已人工審核批准的照片</h4>
                <div class="photos-controls">
                    <label for="sort-order">排序方式: </label>
                    <select id="sort-order">
                        <option value="newest">最新上傳</option>
                        <option value="oldest">最早上傳</option>
                        <option value="score-high">批准分數 (高→低)</option>
                        <option value="score-low">批准分數 (低→高)</option>
                        <option value="high-to-low">檔案大小 (大→小)</option>
                        <option value="low-to-high">檔案大小 (小→大)</option>
                    </select>
                </div>
                <div id="all-photos-grid"></div>
            </div>

            <!-- Manual Photo Review Section -->
            <div class="manual-review-section">
                <h4>🔍 人工檢查照片加分</h4>
                <div class="review-controls">
                    <label for="review-filter">篩選狀態: </label>
                    <select id="review-filter">
                        <option value="pending">待審核</option>
                        <option value="approved">已通過</option>
                        <option value="rejected">已拒絕</option>
                        <option value="all">全部</option>
                    </select>
                    <button class="btn btn-primary" onclick="refreshReviewPhotos()">🔄 重新載入</button>
                    <button class="btn btn-success" onclick="approveAllPendingPhotos()">✅ 批量批准所有待審核照片</button>
                </div>
                <div id="review-photos-grid"></div>
            </div>

            <!-- Photo Format Test Section -->
            <div class="photo-format-test-section">
                <h4>🔍 照片格式一致性測試</h4>
                <div class="test-controls">
                    <button class="btn btn-info" onclick="testPhotoFormatConsistency()">測試照片格式一致性</button>
                    <button class="btn btn-info" onclick="createTestPhotos()">創建測試照片</button>
                    <button class="btn btn-info" onclick="displayTestPhotos()">顯示測試照片</button>
                </div>
                <div id="photoFormatTestResult" class="test-result"></div>
                <div id="photoFormatDisplayTest"></div>
            </div>
        </div>
    </div>

    <!-- System Status Modal -->
    <div id="statusModal" class="status-modal">
        <div class="status-modal-content">
            <div class="status-modal-header">
                <h3>🔍 系統狀態檢查</h3>
                <button class="status-modal-close" onclick="closeStatusModal()">&times;</button>
            </div>
            <div id="statusContent">
                <div class="loading">檢查中...</div>
            </div>
        </div>
    </div>

    <!-- Status Legend Modal -->
    <div id="legendModal" class="status-modal">
        <div class="status-modal-content">
            <div class="status-modal-header">
                <h3>ℹ️ 系統狀態說明</h3>
                <button class="status-modal-close" onclick="closeLegendModal()">&times;</button>
            </div>
            <div id="legendContent">
                <div class="legend-section">
                    <h4>🎯 狀態指示器說明</h4>
                    <div class="legend-grid">
                        <div class="legend-item">
                            <span class="status-badge status-badge-success">成功</span>
                            <p>系統功能正常運作，無需任何操作</p>
                        </div>
                        <div class="legend-item">
                            <span class="status-badge status-badge-warning">警告</span>
                            <p>系統功能正常，但需要注意或可能需要關注</p>
                        </div>
                        <div class="legend-item">
                            <span class="status-badge status-badge-error">錯誤</span>
                            <p>系統出現問題，需要立即處理或檢查</p>
                        </div>
                        <div class="legend-item">
                            <span class="status-badge status-badge-info">資訊</span>
                            <p>提供系統相關資訊，通常為正常狀態</p>
                        </div>
                    </div>
                </div>

                <div class="legend-section">
                    <h4>📊 監測項目詳細說明</h4>
                    <div class="legend-list">
                        <div class="legend-list-item">
                            <strong>Firebase 連接</strong>
                            <p>檢查與 Firebase 數據庫的連接狀態。正常表示可以成功讀取和寫入數據，異常表示無法連接數據庫。</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>管理員認證</strong>
                            <p>檢查當前管理員登入狀態。已登入表示可以正常使用管理功能，未登入需要重新輸入密碼。</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>數據可用性</strong>
                            <p>檢查是否有可用的玩家分數數據。顯示已載入的記錄數量，無數據表示尚未有玩家進行遊戲。</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>瀏覽器相容性</strong>
                            <p>檢查瀏覽器是否支援所需功能，包括 Firebase SDK、Excel 導出、本地存儲等。完全支援表示所有功能正常。</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>網路連接</strong>
                            <p>檢查網路連接狀態。在線表示可以正常訪問網路，離線表示網路連接已斷開。</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>記憶體使用</strong>
                            <p>檢查瀏覽器記憶體使用情況。低於80%為正常，80-95%為警告，超過95%為異常。無法檢測表示瀏覽器不支援此功能。</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>最後更新</strong>
                            <p>檢查數據最後更新時間。5分鐘內為「最近更新」，5-30分鐘為「較舊數據」，超過30分鐘為「數據過舊」。數據過舊可能表示系統問題或無玩家活動。</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>活躍用戶</strong>
                            <p>監測過去30分鐘內的活躍用戶數量。顯示活躍用戶數和遊戲次數，0人表示該時段內沒有玩家進行遊戲。</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>最受歡迎遊戲</strong>
                            <p>分析哪個遊戲被玩得最多。顯示遊戲名稱、總遊戲次數和勝率百分比，幫助了解玩家偏好。</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>使用趨勢</strong>
                            <p>比較今日與昨日的使用量變化。上升趨勢表示使用量增加，下降趨勢表示使用量減少，持平表示無變化。</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>高峰使用時段</strong>
                            <p>分析一天中最活躍的使用時段。顯示24小時中遊戲次數最多的時段，幫助了解玩家使用習慣。</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>平均遊戲時長</strong>
                            <p>計算用戶平均遊戲時間。較短（<2分鐘）為警告，正常（2-5分鐘）為成功，較長（>5分鐘）為資訊。基於有時間記錄的遊戲計算。</p>
                        </div>
                    </div>
                </div>

                <div class="legend-section">
                    <h4>🔍 狀態指示器詳細說明</h4>
                    <div class="legend-list">
                        <div class="legend-list-item">
                            <strong>🟢 成功（綠色）</strong>
                            <p>系統功能正常運作，無需任何操作。表示該項目檢查通過，運行良好。</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>🟡 警告（黃色）</strong>
                            <p>系統功能正常，但需要注意或可能需要關注。建議檢查相關設置或等待改善。</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>🔴 錯誤（紅色）</strong>
                            <p>系統出現問題，需要立即處理或檢查。可能影響系統正常運作，建議優先解決。</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>🔵 資訊（藍色）</strong>
                            <p>提供系統相關資訊，通常為正常狀態。用於顯示統計數據或無法檢測的項目。</p>
                        </div>
                    </div>
                </div>

                <div class="legend-section">
                    <h4>💡 常見問題說明</h4>
                    <div class="legend-list">
                        <div class="legend-list-item">
                            <strong>「數據過舊」是什麼意思？</strong>
                            <p>表示最後一次數據更新已超過30分鐘。可能原因：1) 目前沒有玩家進行遊戲（正常情況）；2) 系統無法記錄新數據（需要檢查）；3) 網路或Firebase連接問題。</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>「活躍用戶 0 人」正常嗎？</strong>
                            <p>在非遊戲時間或系統剛部署時是正常的。如果長時間顯示0人且「數據過舊」，建議檢查遊戲頁面是否正常運作。</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>「記憶體使用 無法檢測」怎麼辦？</strong>
                            <p>這是正常的，某些瀏覽器（如Safari）不支援記憶體檢測功能。不影響系統正常運作。</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>「使用趨勢 持平」表示什麼？</strong>
                            <p>表示今日與昨日的遊戲次數相同。在系統剛部署或使用量穩定的情況下是正常的。</p>
                        </div>
                        <div class="legend-list-item">
                            <strong>如何判斷系統是否正常？</strong>
                            <p>查看「整體系統狀態」：綠色「系統正常」表示一切良好；黃色「系統警告」表示需要注意；紅色「系統異常」表示需要立即處理。</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase Configuration -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <!-- SheetJS for Excel Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD5x_L2yAP9ndQJRBeC31Z6nNrh4okt9uo",
            authDomain: "stem-by-me-app.firebaseapp.com",
            projectId: "stem-by-me-app",
            storageBucket: "stem-by-me-app.firebasestorage.app",
            messagingSenderId: "216736327145",
            appId: "1:216736327145:web:e01721f8e0c6a960a19778",
            measurementId: "G-WWSS5PJVP1"
        };

        // Initialize Firebase
        let db;
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            window.db = db; // 設置全局變數
            console.log('✅ Firebase initialized successfully');

            // 測試連接
            db.collection('test').doc('test').get().then(() => {
                console.log('✅ Firebase connection test successful');
            }).catch(error => {
                console.warn('⚠️ Firebase connection test failed:', error);
            });
        } catch (error) {
            console.error('❌ Firebase initialization error:', error);
            window.db = null;
        }

        // Firebase 連接狀態檢查函數
        function checkFirebaseConnection() {
            console.log('🔍 Checking Firebase connection...');
            console.log('window.db:', window.db);
            console.log('firebase:', typeof firebase);
            console.log('firebase.firestore:', typeof firebase.firestore);

            if (!window.db) {
                console.error('❌ window.db is null or undefined');
                return false;
            }

            if (!firebase) {
                console.error('❌ firebase is not available');
                return false;
            }

            console.log('✅ Firebase connection check passed');
            return true;
        }

        // Admin password
        const ADMIN_PASSWORD = 'ADMIN2025';

        // Global variables
        let allScores = [];
        let allPhotos = [];
        let isAuthenticated = false;

        // Check authentication on page load
        document.addEventListener('DOMContentLoaded', function () {
            checkAuthStatus();

            // Add event listeners for filters
            const gameFilter = document.getElementById('gameFilter');
            const statusFilter = document.getElementById('statusFilter');
            const playerFilter = document.getElementById('playerFilter');
            const adminPassword = document.getElementById('adminPassword');
            const reviewFilter = document.getElementById('review-filter');

            if (gameFilter) {
                gameFilter.addEventListener('change', displayScores);
            }
            if (statusFilter) {
                statusFilter.addEventListener('change', displayScores);
            }
            if (playerFilter) {
                playerFilter.addEventListener('input', displayScores);
            }
            if (adminPassword) {
                adminPassword.addEventListener('keypress', function (e) {
                    if (e.key === 'Enter') {
                        login();
                    }
                });
            }
            if (reviewFilter) {
                reviewFilter.addEventListener('change', function () {
                    loadReviewPhotos();
                });
            }
        });

        function checkAuthStatus() {
            const authStatus = sessionStorage.getItem('adminAuthStatus');
            if (authStatus === 'authenticated') {
                isAuthenticated = true;
                showDashboard();
                loadScores();
            } else {
                showLoginForm();
            }
        }

        function login() {
            const password = document.getElementById('adminPassword').value;
            const errorMessage = document.getElementById('errorMessage');

            if (password === ADMIN_PASSWORD) {
                isAuthenticated = true;
                sessionStorage.setItem('adminAuthStatus', 'authenticated');
                showDashboard();
                loadScores();
                errorMessage.style.display = 'none';
            } else {
                errorMessage.textContent = '密碼錯誤，請重新輸入';
                errorMessage.style.display = 'block';
                document.getElementById('adminPassword').value = '';
            }
        }

        function logout() {
            isAuthenticated = false;
            sessionStorage.removeItem('adminAuthStatus');
            showLoginForm();
        }

        function showLoginForm() {
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('adminDashboard').style.display = 'none';
        }

        function showDashboard() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('adminDashboard').style.display = 'block';

            // Initialize admin panel functionality
            initializeAdminPanel();

            // Auto-load system status when dashboard is shown
            setTimeout(() => {
                checkSystemStatusInline();
            }, 1000);
        }

        async function loadScores() {
            const container = document.getElementById('scoresContainer');
            container.innerHTML = '<div class="loading">載入中...</div>';

            try {
                if (!db) {
                    throw new Error('Firebase not initialized');
                }

                const scoresRef = db.collection('gameScores');
                const snapshot = await scoresRef.orderBy('timestamp', 'desc').get();

                allScores = [];
                snapshot.forEach(doc => {
                    const data = doc.data();

                    // Safely handle timestamp conversion
                    let timestamp;
                    try {
                        if (data.timestamp) {
                            if (typeof data.timestamp.toDate === 'function') {
                                // Firestore Timestamp object
                                timestamp = data.timestamp.toDate();
                            } else if (data.timestamp instanceof Date) {
                                // Already a Date object
                                timestamp = data.timestamp;
                            } else if (typeof data.timestamp === 'string') {
                                // ISO string
                                timestamp = new Date(data.timestamp);
                            } else {
                                // Fallback to current date
                                timestamp = new Date();
                            }
                        } else {
                            timestamp = new Date();
                        }
                    } catch (error) {
                        console.warn('Error converting timestamp for score:', doc.id, error);
                        timestamp = new Date();
                    }

                    allScores.push({
                        id: doc.id,
                        ...data,
                        timestamp: timestamp
                    });
                });

                // If no real data exists, create test data for demonstration
                if (allScores.length === 0) {
                    console.log('No real data found, creating test data for demonstration...');
                    createTestData();
                } else {
                    updateStatistics();
                    displayScores();
                }

                // Load photos data
                await loadPhotosFromFirebase();

                // Auto-update system status when scores are loaded
                checkSystemStatusInline();

            } catch (error) {
                console.error('Error loading scores:', error);
                console.log('Creating test data due to error...');
                createTestData();
            }
        }

        function updateStatistics() {
            const totalPlayers = new Set(allScores.map(score => score.playerName || score.userID || '匿名玩家')).size;
            const totalGames = allScores.length;
            const totalWins = allScores.filter(score => score.status === 'win').length;
            const avgScore = totalGames > 0 ? Math.round(allScores.reduce((sum, score) => sum + (score.score || 0), 0) / totalGames) : 0;

            // Update old admin dashboard statistics
            document.getElementById('totalPlayers').textContent = totalPlayers;
            document.getElementById('totalGames').textContent = totalGames;
            document.getElementById('totalWins').textContent = totalWins;
            document.getElementById('avgScore').textContent = avgScore;

            // Update new admin panel statistics
            loadAdminStats();
            loadWinnersList();
        }

        // Function to load photos from Firebase
        async function loadPhotosFromFirebase() {
            try {
                console.log('Loading approved photos from Firebase...');

                // Load approved photos from reviewPhotos collection
                const approvedPhotosSnapshot = await db.collection('reviewPhotos')
                    .where('status', '==', 'approved')
                    .get();

                allPhotos = [];

                approvedPhotosSnapshot.forEach(doc => {
                    const data = doc.data();

                    // Safely handle timestamp conversion
                    let timestamp;
                    try {
                        if (data.timestamp) {
                            if (typeof data.timestamp.toDate === 'function') {
                                // Firestore Timestamp object
                                timestamp = data.timestamp.toDate();
                            } else if (data.timestamp instanceof Date) {
                                // Already a Date object
                                timestamp = data.timestamp;
                            } else if (typeof data.timestamp === 'string') {
                                // ISO string
                                timestamp = new Date(data.timestamp);
                            } else {
                                // Fallback to current date
                                timestamp = new Date();
                            }
                        } else {
                            timestamp = new Date();
                        }
                    } catch (error) {
                        console.warn('Error converting timestamp for photo:', doc.id, error);
                        timestamp = new Date();
                    }

                    allPhotos.push({
                        ...data,
                        timestamp: timestamp,
                        approvedScore: data.approvedScore || 0,
                        reviewedAt: data.reviewedAt,
                        reviewedBy: data.reviewedBy
                    });
                });

                console.log(`✅ Loaded ${allPhotos.length} approved photos from Firebase`);

                // If no approved photos exist and we're using test data, don't override
                if (allPhotos.length === 0 && allScores.length > 0) {
                    console.log('No approved photos found, but test scores exist - keeping test photos');
                } else {
                    // Update photos display
                    loadAllPhotos();
                    loadReviewPhotos(); // Load review photos as well
                }

            } catch (error) {
                console.error('Error loading approved photos from Firebase:', error);
                // Don't clear allPhotos if we're using test data
                if (allScores.length === 0) {
                    allPhotos = [];
                }
            }
        }

        // Function to load review photos
        async function loadReviewPhotos() {
            try {
                console.log('🔍 Loading review photos...');
                console.log('📊 Database reference:', db);

                if (!db) {
                    console.error('❌ Database not initialized');
                    showNotification('Firebase 數據庫未初始化', 'error');
                    displayReviewPhotos([]);
                    return;
                }

                const reviewPhotosSnapshot = await db.collection('reviewPhotos').get();
                console.log('📸 Review photos snapshot:', reviewPhotosSnapshot);
                console.log('📊 Total review photos found:', reviewPhotosSnapshot.size);

                const reviewPhotos = [];

                reviewPhotosSnapshot.forEach(doc => {
                    const data = doc.data();
                    console.log('📝 Processing review photo:', doc.id, data);
                    console.log('🔍 Document ID:', doc.id, 'User ID from data:', data.userID);

                    let timestamp;
                    try {
                        if (data.timestamp) {
                            if (typeof data.timestamp.toDate === 'function') {
                                timestamp = data.timestamp.toDate();
                            } else if (data.timestamp instanceof Date) {
                                timestamp = data.timestamp;
                            } else if (typeof data.timestamp === 'string') {
                                timestamp = new Date(data.timestamp);
                            } else {
                                timestamp = new Date();
                            }
                        } else {
                            timestamp = new Date();
                        }
                    } catch (error) {
                        console.warn('Error converting timestamp for review photo:', doc.id, error);
                        timestamp = new Date();
                    }

                    reviewPhotos.push({
                        firestoreDocId: doc.id,
                        ...data,
                        timestamp: timestamp
                    });
                });

                console.log('✅ Processed review photos:', reviewPhotos);
                displayReviewPhotos(reviewPhotos);

            } catch (error) {
                console.error('❌ Error loading review photos:', error);
                showNotification(`載入審核照片時發生錯誤: ${error.message}`, 'error');
                displayReviewPhotos([]);
            }
        }

        // Function to display review photos
        function displayReviewPhotos(reviewPhotos) {
            console.log('🎨 Displaying review photos...');
            console.log('📊 Total photos to display:', reviewPhotos.length);
            console.log('📋 Photos data:', reviewPhotos);

            const container = document.getElementById('review-photos-grid');
            const filter = document.getElementById('review-filter');

            if (!container) {
                console.error('❌ Review photos grid container not found');
                return;
            }

            if (!filter) {
                console.error('❌ Review filter not found');
                return;
            }

            const filterValue = filter.value;
            console.log('🔍 Current filter value:', filterValue);

            let filteredPhotos = reviewPhotos;
            if (filterValue !== 'all') {
                filteredPhotos = reviewPhotos.filter(photo => photo.status === filterValue);
                console.log(`🔍 Filtered photos for status "${filterValue}":`, filteredPhotos.length);
            }

            if (filteredPhotos.length === 0) {
                console.log('⚠️ No photos found matching the filter');
                container.innerHTML = `
                    <div class="no-photos" style="text-align: center; padding: 50px; color: #00ffff; font-style: italic;">
                        <h3>📸 沒有找到符合條件的照片</h3>
                        <p>總照片數: ${reviewPhotos.length}</p>
                        <p>當前篩選: ${filterValue}</p>
                        <p>💡 提示: 請確保已經有照片上傳到審核隊列</p>
                    </div>`;
                return;
            }

            let html = '';
            filteredPhotos.forEach(photo => {
                const statusClass = photo.status || 'pending';
                const statusText = {
                    'pending': '待審核',
                    'approved': '已通過',
                    'rejected': '已拒絕'
                }[statusClass] || '待審核';

                html += `
                    <div class="review-photo-card ${statusClass}">
                        <div class="review-photo-image-container">
                            <img src="${photo.dataURL || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMDAwIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzAwZmZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIEltYWdlPC90ZXh0Pjwvc3ZnPg=='}" 
                                 alt="Review Photo" class="review-photo-image">
                        </div>
                        <div class="review-photo-info">
                            <div class="review-photo-header">
                                <h5 style="color: #00ffff; margin: 0;">玩家 ${photo.userID}</h5>
                                <span class="review-status-badge ${statusClass}">${statusText}</span>
                            </div>
                            <div class="review-photo-details">
                                <p><strong>位置：</strong>${photo.locationName || '未指定'}</p>
                                <p><strong>遊戲類型：</strong>${photo.gameType || '未指定'}</p>
                                <p><strong>上傳時間：</strong>${photo.timestamp.toLocaleString('zh-TW')}</p>
                                <p><strong>檔案大小：</strong>${formatFileSize(photo.size || 0)}</p>
                                ${photo.reviewNote ? `<p><strong>審核備註：</strong>${photo.reviewNote}</p>` : ''}
                            </div>
                            <div class="review-photo-actions">
                                ${statusClass === 'pending' ? `
                                    <input type="number" class="review-score-input" 
                                           placeholder="輸入加分分數" 
                                           id="score-${photo.firestoreDocId}" 
                                           value="${photo.suggestedScore || 0}">
                                    <button class="review-action-btn approve" 
                                            onclick="approvePhoto('${photo.firestoreDocId}', '${photo.userID}')">
                                        通過
                                    </button>
                                    <button class="review-action-btn reject" 
                                            onclick="rejectPhoto('${photo.firestoreDocId}', '${photo.userID}')">
                                        拒絕
                                    </button>
                                ` : ''}
                                <button class="review-action-btn view" 
                                        onclick="viewPhotoDetails('${photo.firestoreDocId}')">
                                    查看詳情
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Function to approve photo
        async function approvePhoto(photoId, userId) {
            try {
                const scoreInput = document.getElementById(`score-${photoId}`);
                const score = parseInt(scoreInput.value) || 0;

                if (score <= 0) {
                    showNotification('請輸入有效的加分分數！', 'error');
                    return;
                }

                console.log('🔍 Approving photo with ID:', photoId, 'for user:', userId);

                // First, let's check if the document exists
                const photoDoc = await db.collection('reviewPhotos').doc(photoId).get();

                if (!photoDoc.exists) {
                    console.error('❌ Document not found:', photoId);
                    showNotification(`❌ 找不到文檔ID為 ${photoId} 的照片！請檢查文檔ID是否正確。`, 'error');
                    return;
                }

                // Update photo status in Firebase
                await db.collection('reviewPhotos').doc(photoId).update({
                    status: 'approved',
                    approvedScore: score,
                    reviewedAt: new Date(),
                    reviewedBy: 'admin'
                });

                // Add score to user's total score
                const userRef = db.collection('users').doc(userId);
                const userDoc = await userRef.get();

                if (userDoc.exists) {
                    const userData = userDoc.data();
                    const newTotalScore = (userData.totalScore || 0) + score;

                    await userRef.update({
                        totalScore: newTotalScore,
                        lastUpdated: new Date()
                    });
                }

                // Create a score record
                await db.collection('gameScores').add({
                    playerName: `玩家${userId}`,
                    userID: userId,
                    gameId: 'photo_review_approved',
                    score: score,
                    totalScore: score,
                    status: 'win',
                    timestamp: new Date(),
                    gameType: '人工審核加分',
                    locationCode: 'PHOTO_REVIEW',
                    locationName: '照片審核通過',
                    reviewNote: '管理員人工審核通過'
                });

                showNotification(`✅ 照片審核通過！玩家${userId}獲得${score}分`, 'success');

                // Refresh the review photos display
                loadReviewPhotos();

            } catch (error) {
                console.error('Error approving photo:', error);
                showNotification(`審核照片時發生錯誤！錯誤詳情: ${error.message}`, 'error');
            }
        }

        // Function to reject photo
        async function rejectPhoto(photoId, userId) {
            try {
                const reason = prompt('請輸入拒絕原因：');
                if (!reason) {
                    showNotification('請輸入拒絕原因！', 'error');
                    return;
                }

                console.log('🔍 Rejecting photo with ID:', photoId, 'for user:', userId);

                // First, let's check if the document exists
                const photoDoc = await db.collection('reviewPhotos').doc(photoId).get();

                if (!photoDoc.exists) {
                    console.error('❌ Document not found:', photoId);
                    showNotification(`❌ 找不到文檔ID為 ${photoId} 的照片！請檢查文檔ID是否正確。`, 'error');
                    return;
                }

                // Update photo status in Firebase
                await db.collection('reviewPhotos').doc(photoId).update({
                    status: 'rejected',
                    rejectedReason: reason,
                    reviewedAt: new Date(),
                    reviewedBy: 'admin'
                });

                showNotification(`❌ 照片已拒絕。原因：${reason}`, 'warning');

                // Refresh the review photos display
                loadReviewPhotos();

            } catch (error) {
                console.error('Error rejecting photo:', error);
                showNotification(`拒絕照片時發生錯誤！錯誤詳情: ${error.message}`, 'error');
            }
        }

        // Function to view photo details
        function viewPhotoDetails(photoId) {
            // This could open a modal with detailed photo information
            showNotification('查看照片詳情功能開發中...', 'info');
        }

        // Function to refresh review photos
        function refreshReviewPhotos() {
            loadReviewPhotos();
        }

        // Function to format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Function to create test review photo
        async function createTestReviewPhoto() {
            try {
                console.log('🧪 Creating test review photo...');

                if (!db) {
                    showNotification('Firebase 數據庫未初始化', 'error');
                    return;
                }

                // Create test review photo data
                const testPhotoData = {
                    userID: 'test_user_' + Date.now(),
                    fileName: 'test_photo_' + Date.now() + '.jpg',
                    originalName: 'test_photo.jpg',
                    timestamp: new Date(),
                    size: 1024000, // 1MB
                    type: 'image/jpeg',
                    dataURL: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8A',
                    locationCode: 'F3C9',
                    locationName: '軒尼斯道籃球場',
                    gameType: '趣味親子打卡',
                    score: 80,
                    coordinates: { lat: 22.2783, lng: 114.1747 },
                    locationDescription: '戶外籃球場，適合親子運動活動',
                    locationAddress: '灣仔軒尼斯道',
                    locationCategory: 'sports',
                    status: 'pending',
                    suggestedScore: 80,
                    reviewedAt: null,
                    reviewedBy: null,
                    approvedScore: null,
                    rejectedReason: null
                };

                // Add to reviewPhotos collection
                const reviewPhotoRef = db.collection('reviewPhotos').doc();
                await reviewPhotoRef.set(testPhotoData);

                console.log('✅ Test review photo created with ID:', reviewPhotoRef.id);
                showNotification(`✅ 測試審核照片已創建！ID: ${reviewPhotoRef.id}`, 'success');

                // Refresh the review photos display
                setTimeout(() => {
                    loadReviewPhotos();
                }, 1000);

            } catch (error) {
                console.error('❌ Error creating test review photo:', error);
                showNotification(`創建測試照片時發生錯誤: ${error.message}`, 'error');
            }
        }

        // Function to show notifications
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="notification-title">${type === 'success' ? '✅ 成功' : type === 'error' ? '❌ 錯誤' : type === 'warning' ? '⚠️ 警告' : 'ℹ️ 資訊'}</div>
                <div class="notification-message">${message}</div>
                <button class="notification-close" onclick="this.parentElement.remove()">&times;</button>
            `;

            document.body.appendChild(notification);

            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }

        // Photo Format Test Functions
        function showPhotoFormatTestResult(message, type = 'info') {
            const resultDiv = document.getElementById('photoFormatTestResult');
            if (resultDiv) {
                resultDiv.innerHTML = `<div class="test-result ${type}">${message}</div>`;
            }
        }

        function displayPhotoCard(photo) {
            const statusClass = photo.status || 'pending';
            const statusText = {
                'pending': '待審核',
                'approved': '已通過',
                'rejected': '已拒絕'
            }[statusClass] || '';

            const isReviewPhoto = photo.type === 'review';
            const cardClass = isReviewPhoto ? `photo-card review-photo ${statusClass}` : 'photo-card';

            return `
                <div class="${cardClass}">
                    <div class="photo-image-container">
                        <img src="${photo.dataURL || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMDAwIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzY2N2VlYSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIEltYWdlPC90ZXh0Pjwvc3ZnPg=='}" 
                             alt="Photo" class="photo-image">
                        ${isReviewPhoto ? `<div class="photo-status-badge ${statusClass}">${statusText}</div>` : ''}
                    </div>
                    <div class="photo-info">
                        <div class="photo-filename-display">${photo.fileName || photo.originalName || '未命名'}</div>
                        <div class="photo-user">玩家: ${photo.userID}</div>
                        <div class="photo-timestamp">${photo.timestamp.toLocaleString('zh-TW')}</div>
                        <div class="photo-size">${formatFileSize(photo.size || 0)}</div>
                        <div class="photo-game-type">${photo.gameType || '未指定'}</div>
                        <div class="photo-location-details">
                            <div><strong>位置:</strong> ${photo.locationName || '未指定'}</div>
                            <div><strong>代碼:</strong> ${photo.locationCode || '未指定'}</div>
                        </div>
                    </div>
                </div>
            `;
        }

        async function testPhotoFormatConsistency() {
            showPhotoFormatTestResult('🔍 測試照片格式一致性...', 'info');

            try {
                if (!db) {
                    throw new Error('Firebase 未初始化');
                }

                // Test data structure
                const testRegularPhoto = {
                    userID: 'test_user_001',
                    fileName: 'test_regular_photo.jpg',
                    originalName: 'test_regular_photo.jpg',
                    timestamp: new Date(),
                    size: 1024000,
                    type: 'image/jpeg',
                    dataURL: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8A',
                    locationCode: 'L8Q2',
                    locationName: '灣仔會展',
                    gameType: '闖關點',
                    score: 40,
                    type: 'regular'
                };

                const testReviewPhoto = {
                    userID: 'test_user_002',
                    fileName: 'test_review_photo.jpg',
                    originalName: 'test_review_photo.jpg',
                    timestamp: new Date(),
                    size: 2048000,
                    type: 'image/jpeg',
                    dataURL: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8A',
                    locationCode: 'F3C9',
                    locationName: '軒尼斯道籃球場',
                    gameType: '趣味親子打卡',
                    score: 80,
                    status: 'pending',
                    suggestedScore: 80,
                    type: 'review'
                };

                // Test display format
                const displayTest = document.getElementById('photoFormatDisplayTest');
                if (displayTest) {
                    displayTest.innerHTML = `
                        <h3>📸 照片顯示格式測試</h3>
                        <div class="photo-grid">
                            ${displayPhotoCard(testRegularPhoto)}
                            ${displayPhotoCard(testReviewPhoto)}
                        </div>
                    `;
                }

                showPhotoFormatTestResult('✅ 照片格式一致性測試完成！\n\n檢查項目：\n- 數據結構一致性 ✓\n- 顯示格式一致性 ✓\n- 審核狀態顯示 ✓\n- 照片信息顯示 ✓', 'success');

            } catch (error) {
                showPhotoFormatTestResult(`❌ 照片格式一致性測試失敗: ${error.message}`, 'error');
            }
        }

        async function createTestPhotos() {
            showPhotoFormatTestResult('🔍 創建測試照片...', 'info');

            try {
                if (!db) {
                    throw new Error('Firebase 未初始化');
                }

                // Create test regular photo
                const testRegularPhoto = {
                    userID: 'test_user_001',
                    fileName: 'test_regular_photo.jpg',
                    originalName: 'test_regular_photo.jpg',
                    timestamp: new Date(),
                    size: 1024000,
                    type: 'image/jpeg',
                    dataURL: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8A',
                    locationCode: 'L8Q2',
                    locationName: '灣仔會展',
                    gameType: '闖關點',
                    score: 40,
                    uploadedAt: new Date()
                };

                // Create test review photo
                const testReviewPhoto = {
                    userID: 'test_user_002',
                    fileName: 'test_review_photo.jpg',
                    originalName: 'test_review_photo.jpg',
                    timestamp: new Date(),
                    size: 2048000,
                    type: 'image/jpeg',
                    dataURL: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8A',
                    locationCode: 'F3C9',
                    locationName: '軒尼斯道籃球場',
                    gameType: '趣味親子打卡',
                    score: 80,
                    status: 'pending',
                    suggestedScore: 80,
                    uploadedAt: new Date()
                };

                // Save to Firebase
                await db.collection('photos').doc('test_user_001').set(testRegularPhoto);
                const reviewPhotoRef = db.collection('reviewPhotos').doc();
                await reviewPhotoRef.set(testReviewPhoto);

                showPhotoFormatTestResult(`✅ 測試照片創建成功！\n\n- 一般照片: test_user_001\n- 審核照片: ${reviewPhotoRef.id}`, 'success');

            } catch (error) {
                showPhotoFormatTestResult(`❌ 創建測試照片失敗: ${error.message}`, 'error');
            }
        }

        async function displayTestPhotos() {
            showPhotoFormatTestResult('🔍 載入並顯示測試照片...', 'info');

            try {
                if (!db) {
                    throw new Error('Firebase 未初始化');
                }

                const allPhotos = [];

                // Load regular photos
                const photosSnapshot = await db.collection('photos').get();
                photosSnapshot.forEach(doc => {
                    const data = doc.data();
                    allPhotos.push({
                        id: doc.id,
                        ...data,
                        type: 'regular',
                        timestamp: data.uploadedAt ? data.uploadedAt.toDate() : new Date()
                    });
                });

                // Load review photos
                const reviewPhotosSnapshot = await db.collection('reviewPhotos').get();
                reviewPhotosSnapshot.forEach(doc => {
                    const data = doc.data();
                    allPhotos.push({
                        id: doc.id,
                        ...data,
                        type: 'review',
                        timestamp: data.uploadedAt ? data.uploadedAt.toDate() : new Date()
                    });
                });

                // Sort by timestamp
                allPhotos.sort((a, b) => b.timestamp - a.timestamp);

                // Display photos
                const displayTest = document.getElementById('photoFormatDisplayTest');
                if (displayTest) {
                    if (allPhotos.length === 0) {
                        displayTest.innerHTML = '<h3>📸 沒有找到照片</h3><p>請先創建測試照片</p>';
                    } else {
                        let html = '<h3>📸 Firebase 中的照片</h3><div class="photo-grid">';
                        allPhotos.forEach(photo => {
                            html += displayPhotoCard(photo);
                        });
                        html += '</div>';
                        displayTest.innerHTML = html;
                    }
                }

                showPhotoFormatTestResult(`✅ 載入完成！共找到 ${allPhotos.length} 張照片`, 'success');

            } catch (error) {
                showPhotoFormatTestResult(`❌ 載入照片失敗: ${error.message}`, 'error');
            }
        }

        // Function to check Firebase connection status
        async function checkFirebaseStatus() {
            try {
                console.log('🔍 Checking Firebase connection status...');

                if (!db) {
                    console.error('❌ Firebase database not initialized');
                    showNotification('Firebase 數據庫未初始化', 'error');
                    return false;
                }

                // Test connection by trying to read from a test collection
                const testRef = db.collection('test').doc('connection');
                await testRef.set({ timestamp: new Date() });
                await testRef.delete();

                console.log('✅ Firebase connection is working');
                showNotification('Firebase 連接正常', 'success');
                return true;

            } catch (error) {
                console.error('❌ Firebase connection test failed:', error);
                showNotification(`Firebase 連接測試失敗: ${error.message}`, 'error');
                return false;
            }
        }

        // Function to debug review photos
        async function debugReviewPhotos() {
            try {
                console.log('🔍 Debugging review photos...');

                if (!db) {
                    showNotification('Firebase 數據庫未初始化', 'error');
                    return;
                }

                // Check all collections
                const collections = ['reviewPhotos', 'photos', 'gameScores'];

                for (const collectionName of collections) {
                    try {
                        const snapshot = await db.collection(collectionName).get();
                        console.log(`📊 Collection "${collectionName}": ${snapshot.size} documents`);

                        if (snapshot.size > 0) {
                            snapshot.forEach(doc => {
                                console.log(`  - Document ${doc.id}:`, doc.data());
                            });
                        }
                    } catch (error) {
                        console.error(`❌ Error reading collection "${collectionName}":`, error);
                    }
                }

                // Try to load review photos specifically
                await loadReviewPhotos();

                showNotification('調試完成，請查看控制台輸出', 'info');

            } catch (error) {
                console.error('❌ Error debugging review photos:', error);
                showNotification(`調試時發生錯誤: ${error.message}`, 'error');
            }
        }

        // Function to show document IDs for debugging
        async function showDocumentIDs() {
            try {
                console.log('🆔 Showing document IDs for debugging...');

                if (!db) {
                    showNotification('Firebase 數據庫未初始化', 'error');
                    return;
                }

                const reviewPhotosSnapshot = await db.collection('reviewPhotos').get();
                console.log('📸 Total review photos found:', reviewPhotosSnapshot.size);

                let debugInfo = '📋 審核照片文檔ID列表：\n\n';

                reviewPhotosSnapshot.forEach(doc => {
                    const data = doc.data();
                    debugInfo += `文檔ID: ${doc.id}\n`;
                    debugInfo += `用戶ID: ${data.userID}\n`;
                    debugInfo += `狀態: ${data.status || 'pending'}\n`;
                    debugInfo += `位置: ${data.locationName || '未指定'}\n`;
                    debugInfo += `遊戲類型: ${data.gameType || '未指定'}\n`;
                    debugInfo += `---\n`;
                });

                console.log(debugInfo);

                // Also show in a notification
                const shortInfo = `找到 ${reviewPhotosSnapshot.size} 張照片，文檔ID: ${Array.from(reviewPhotosSnapshot.docs).map(doc => doc.id).join(', ')}`;
                showNotification(shortInfo, 'info');

            } catch (error) {
                console.error('❌ Error showing document IDs:', error);
                showNotification(`顯示文檔ID時發生錯誤: ${error.message}`, 'error');
            }
        }

        // Function to create test data for demonstration (if no real data exists)
        function createTestData() {
            console.log('Creating test data for demonstration...');

            // Create test scores
            const testScores = [
                {
                    id: 'test1',
                    playerName: '測試玩家1',
                    userID: '101',
                    gameId: 'game_趣味親子打卡',
                    score: 85,
                    totalScore: 85,
                    status: 'win',
                    gameTime: 120,
                    timestamp: new Date(Date.now() - 3600000), // 1 hour ago
                    locationCode: 'L8Q2',
                    locationName: '灣仔海濱長廊',
                    gameType: '趣味親子打卡',
                    locationDescription: '美麗的海濱長廊，適合親子活動',
                    locationAddress: '灣仔海濱長廊',
                    locationCategory: 'community',
                    coordinates: { lat: 22.2783, lng: 114.1747 }
                },
                {
                    id: 'test2',
                    playerName: '測試玩家2',
                    userID: '102',
                    gameId: 'game_開發者遊戲挑戰',
                    score: 92,
                    totalScore: 92,
                    status: 'win',
                    gameTime: 95,
                    timestamp: new Date(Date.now() - 7200000), // 2 hours ago
                    locationCode: 'P9M8',
                    locationName: '金紫荊廣場',
                    gameType: '開發者遊戲挑戰',
                    locationDescription: '著名的金紫荊廣場，香港地標',
                    locationAddress: '金紫荊廣場',
                    locationCategory: 'landmark',
                    coordinates: { lat: 22.2783, lng: 114.1747 }
                },
                {
                    id: 'test3',
                    playerName: '測試玩家3',
                    userID: '103',
                    gameId: 'game_難題解答挑戰',
                    score: 78,
                    totalScore: 78,
                    status: 'lose',
                    gameTime: 180,
                    timestamp: new Date(Date.now() - 10800000), // 3 hours ago
                    locationCode: 'S2N6',
                    locationName: '中環廣場',
                    gameType: '難題解答挑戰',
                    locationDescription: '繁華的中環商業區',
                    locationAddress: '中環廣場',
                    locationCategory: 'commercial',
                    coordinates: { lat: 22.2783, lng: 114.1747 }
                }
            ];

            // Create test photos
            const testPhotos = [
                {
                    id: '101',
                    fileName: 'test_photo_1.jpg',
                    originalName: 'test_photo_1.jpg',
                    userID: '101',
                    timestamp: new Date(Date.now() - 3600000),
                    size: 1024000, // 1MB
                    type: 'image/jpeg',
                    dataURL: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8A',
                    locationCode: 'L8Q2',
                    locationName: '灣仔海濱長廊',
                    gameType: '趣味親子打卡',
                    score: 85,
                    coordinates: { lat: 22.2783, lng: 114.1747 },
                    locationDescription: '美麗的海濱長廊，適合親子活動',
                    locationAddress: '灣仔海濱長廊',
                    locationCategory: 'community'
                },
                {
                    id: '102',
                    fileName: 'test_photo_2.jpg',
                    originalName: 'test_photo_2.jpg',
                    userID: '102',
                    timestamp: new Date(Date.now() - 7200000),
                    size: 2048000, // 2MB
                    type: 'image/jpeg',
                    dataURL: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8A',
                    locationCode: 'P9M8',
                    locationName: '金紫荊廣場',
                    gameType: '開發者遊戲挑戰',
                    score: 92,
                    coordinates: { lat: 22.2783, lng: 114.1747 },
                    locationDescription: '著名的金紫荊廣場，香港地標',
                    locationAddress: '金紫荊廣場',
                    locationCategory: 'landmark'
                }
            ];

            // Add test data to arrays
            allScores = testScores;
            allPhotos = testPhotos;

            console.log('✅ Test data created successfully');
            console.log(`📊 Test scores: ${allScores.length}`);
            console.log(`📸 Test photos: ${allPhotos.length}`);

            // Update displays
            updateStatistics();
            displayScores();
            loadAllPhotos();
        }

        function displayScores() {
            const gameFilter = document.getElementById('gameFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            const playerFilter = document.getElementById('playerFilter').value.toLowerCase();

            let filteredScores = allScores.filter(score => {
                const matchGame = !gameFilter || score.gameId === gameFilter;
                const matchStatus = !statusFilter || score.status === statusFilter;
                const playerName = score.playerName || score.userID || '匿名玩家';
                const matchPlayer = !playerFilter || playerName.toLowerCase().includes(playerFilter);
                return matchGame && matchStatus && matchPlayer;
            });

            const container = document.getElementById('scoresContainer');

            if (filteredScores.length === 0) {
                container.innerHTML = '<div class="no-data">沒有找到符合條件的記錄</div>';
                return;
            }

            let tableHTML = `
                <table class="scores-table">
                    <thead>
                        <tr>
                            <th>玩家名稱</th>
                            <th>遊戲</th>
                            <th>分數</th>
                            <th>狀態</th>
                            <th>遊戲時間</th>
                            <th>總分</th>
                            <th>時間戳</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            filteredScores.forEach(score => {
                const gameName = score.gameId ? `遊戲 ${score.gameId.replace('game', '')}` : '未知遊戲';
                const statusClass = score.status === 'win' ? 'status-win' : 'status-lose';
                const statusText = score.status === 'win' ? '勝利' : '失敗';
                const gameTime = score.gameTime ? `${Math.round(score.gameTime)}秒` : 'N/A';
                let timestamp;
                try {
                    timestamp = score.timestamp && typeof score.timestamp.toLocaleString === 'function'
                        ? score.timestamp.toLocaleString('zh-TW')
                        : 'N/A';
                } catch (error) {
                    console.warn('Error formatting timestamp:', error);
                    timestamp = 'N/A';
                }

                const playerName = score.playerName || score.userID || '匿名玩家';
                tableHTML += `
                    <tr>
                        <td>${playerName}</td>
                        <td>${gameName}</td>
                        <td>${score.score || 0}</td>
                        <td><span class="${statusClass}">${statusText}</span></td>
                        <td>${gameTime}</td>
                        <td>${score.totalScore || score.score || 0}</td>
                        <td>${timestamp}</td>
                    </tr>
                `;
            });

            tableHTML += '</tbody></table>';
            container.innerHTML = tableHTML;
        }

        // Inline System Status Check function
        async function checkSystemStatusInline() {
            const container = document.getElementById('systemStatusContainer');
            container.innerHTML = '<div class="loading">🔍 正在進行全面系統檢查...</div>';

            const statusChecks = [];

            // 1. Check Firebase Connection
            try {
                console.log('🔍 Checking Firebase connection in system status...');
                console.log('window.db:', window.db);
                console.log('db:', db);
                console.log('firebase:', typeof firebase);

                if (!window.db && !db) {
                    statusChecks.push({
                        label: 'Firebase 連接',
                        status: 'error',
                        value: '未初始化',
                        details: 'Firebase 數據庫未正確初始化，window.db 和 db 都為空'
                    });
                } else {
                    // Test Firebase connection
                    const testRef = (window.db || db).collection('gameScores');
                    const testSnapshot = await testRef.limit(1).get();

                    statusChecks.push({
                        label: 'Firebase 連接',
                        status: 'success',
                        value: '正常',
                        details: `成功連接到 Firebase Firestore，使用 ${window.db ? 'window.db' : 'db'}`
                    });
                }
            } catch (error) {
                console.error('❌ Firebase connection test failed:', error);
                statusChecks.push({
                    label: 'Firebase 連接',
                    status: 'error',
                    value: '連接失敗',
                    details: `錯誤: ${error.message}`
                });
            }

            // 2. Check Authentication Status
            const authStatus = sessionStorage.getItem('adminAuthStatus');
            statusChecks.push({
                label: '管理員認證',
                status: authStatus === 'authenticated' ? 'success' : 'warning',
                value: authStatus === 'authenticated' ? '已登入' : '未登入',
                details: authStatus === 'authenticated' ? '管理員已成功登入' : '需要重新登入'
            });

            // 3. Check Data Availability
            try {
                if (allScores.length > 0) {
                    statusChecks.push({
                        label: '數據可用性',
                        status: 'success',
                        value: `${allScores.length} 筆記錄`,
                        details: `已載入 ${allScores.length} 筆玩家分數記錄`
                    });
                } else {
                    statusChecks.push({
                        label: '數據可用性',
                        status: 'warning',
                        value: '無數據',
                        details: '尚未載入任何玩家分數記錄'
                    });
                }
            } catch (error) {
                statusChecks.push({
                    label: '數據可用性',
                    status: 'error',
                    value: '載入失敗',
                    details: `錯誤: ${error.message}`
                });
            }

            // 4. Check Browser Compatibility
            const browserChecks = [];

            // Check if Firebase is available
            if (typeof firebase !== 'undefined') {
                browserChecks.push('Firebase SDK ✓');
            } else {
                browserChecks.push('Firebase SDK ✗');
            }

            // Check if XLSX is available
            if (typeof XLSX !== 'undefined') {
                browserChecks.push('Excel 導出 ✓');
            } else {
                browserChecks.push('Excel 導出 ✗');
            }

            // Check localStorage support
            if (typeof localStorage !== 'undefined') {
                browserChecks.push('本地存儲 ✓');
            } else {
                browserChecks.push('本地存儲 ✗');
            }

            // Check sessionStorage support
            if (typeof sessionStorage !== 'undefined') {
                browserChecks.push('會話存儲 ✓');
            } else {
                browserChecks.push('會話存儲 ✗');
            }

            const browserStatus = browserChecks.every(check => check.includes('✓')) ? 'success' : 'warning';
            const browserValue = browserChecks.every(check => check.includes('✓')) ? '完全支援' : '部分支援';

            statusChecks.push({
                label: '瀏覽器相容性',
                status: browserStatus,
                value: browserValue,
                details: browserChecks.join(', ')
            });

            // 5. Check Network Status
            if (navigator.onLine) {
                statusChecks.push({
                    label: '網路連接',
                    status: 'success',
                    value: '在線',
                    details: '網路連接正常'
                });
            } else {
                statusChecks.push({
                    label: '網路連接',
                    status: 'error',
                    value: '離線',
                    details: '網路連接已斷開'
                });
            }

            // 6. Check System Performance
            const memoryInfo = performance.memory ? {
                used: Math.round(performance.memory.usedJSHeapSize / 1024 / 1024),
                total: Math.round(performance.memory.totalJSHeapSize / 1024 / 1024),
                limit: Math.round(performance.memory.jsHeapSizeLimit / 1024 / 1024)
            } : null;

            if (memoryInfo) {
                const memoryUsage = Math.round((memoryInfo.used / memoryInfo.limit) * 100);
                const memoryStatus = memoryUsage < 80 ? 'success' : memoryUsage < 95 ? 'warning' : 'error';

                statusChecks.push({
                    label: '記憶體使用',
                    status: memoryStatus,
                    value: `${memoryUsage}%`,
                    details: `已使用 ${memoryInfo.used}MB / ${memoryInfo.limit}MB`
                });
            } else {
                statusChecks.push({
                    label: '記憶體使用',
                    status: 'info',
                    value: '無法檢測',
                    details: '瀏覽器不支援記憶體資訊檢測'
                });
            }

            // 7. Check Last Data Update
            if (allScores.length > 0) {
                const latestScore = allScores[0];
                const lastUpdate = latestScore.timestamp;
                const timeDiff = Date.now() - lastUpdate.getTime();
                const minutesDiff = Math.round(timeDiff / 1000 / 60);

                let updateStatus, updateValue, updateDetails;

                if (minutesDiff < 5) {
                    updateStatus = 'success';
                    updateValue = '最近更新';
                    updateDetails = `${minutesDiff} 分鐘前`;
                } else if (minutesDiff < 30) {
                    updateStatus = 'warning';
                    updateValue = '較舊數據';
                    updateDetails = `${minutesDiff} 分鐘前`;
                } else {
                    updateStatus = 'error';
                    updateValue = '數據過舊';
                    updateDetails = `${minutesDiff} 分鐘前`;
                }

                statusChecks.push({
                    label: '最後更新',
                    status: updateStatus,
                    value: updateValue,
                    details: updateDetails
                });
            } else {
                statusChecks.push({
                    label: '最後更新',
                    status: 'info',
                    value: '無數據',
                    details: '尚未載入任何數據'
                });
            }

            // 8. Check Active Users (Real-time monitoring)
            try {
                const recentScores = allScores.filter(score => {
                    const scoreTime = score.timestamp.getTime();
                    const timeDiff = Date.now() - scoreTime;
                    return timeDiff < 30 * 60 * 1000; // Last 30 minutes
                });

                const activeUsers = new Set(recentScores.map(score => score.playerName || score.userID || '匿名玩家')).size;
                const recentGames = recentScores.length;

                if (activeUsers > 0) {
                    statusChecks.push({
                        label: '活躍用戶',
                        status: 'success',
                        value: `${activeUsers} 人`,
                        details: `過去30分鐘內有 ${activeUsers} 位用戶進行了 ${recentGames} 場遊戲`
                    });
                } else {
                    statusChecks.push({
                        label: '活躍用戶',
                        status: 'warning',
                        value: '0 人',
                        details: '過去30分鐘內沒有用戶活動'
                    });
                }
            } catch (error) {
                statusChecks.push({
                    label: '活躍用戶',
                    status: 'error',
                    value: '檢測失敗',
                    details: `錯誤: ${error.message}`
                });
            }

            // 9. Check Game Activity Distribution
            try {
                const gameStats = {};
                allScores.forEach(score => {
                    const gameId = score.gameId || 'unknown';
                    if (!gameStats[gameId]) {
                        gameStats[gameId] = { total: 0, wins: 0 };
                    }
                    gameStats[gameId].total++;
                    if (score.status === 'win') {
                        gameStats[gameId].wins++;
                    }
                });

                const mostPlayedGame = Object.entries(gameStats)
                    .sort(([, a], [, b]) => b.total - a.total)[0];

                if (mostPlayedGame) {
                    const [gameId, stats] = mostPlayedGame;
                    const gameName = gameId === 'unknown' ? '未知遊戲' : `遊戲 ${gameId.replace('game', '')}`;
                    const winRate = Math.round((stats.wins / stats.total) * 100);

                    statusChecks.push({
                        label: '最受歡迎遊戲',
                        status: 'info',
                        value: gameName,
                        details: `總遊戲次數: ${stats.total}, 勝率: ${winRate}%`
                    });
                } else {
                    statusChecks.push({
                        label: '最受歡迎遊戲',
                        status: 'info',
                        value: '無數據',
                        details: '尚未有遊戲記錄'
                    });
                }
            } catch (error) {
                statusChecks.push({
                    label: '最受歡迎遊戲',
                    status: 'error',
                    value: '分析失敗',
                    details: `錯誤: ${error.message}`
                });
            }

            // 10. Check System Performance Trends
            try {
                const today = new Date();
                today.setHours(0, 0, 0, 0);

                const todayScores = allScores.filter(score => {
                    const scoreDate = new Date(score.timestamp);
                    scoreDate.setHours(0, 0, 0, 0);
                    return scoreDate.getTime() === today.getTime();
                });

                const yesterday = new Date(today);
                yesterday.setDate(yesterday.getDate() - 1);

                const yesterdayScores = allScores.filter(score => {
                    const scoreDate = new Date(score.timestamp);
                    scoreDate.setHours(0, 0, 0, 0);
                    return scoreDate.getTime() === yesterday.getTime();
                });

                const todayGames = todayScores.length;
                const yesterdayGames = yesterdayScores.length;

                let trendStatus, trendValue, trendDetails;

                if (todayGames > yesterdayGames) {
                    const increase = Math.round(((todayGames - yesterdayGames) / yesterdayGames) * 100);
                    trendStatus = 'success';
                    trendValue = '上升趨勢';
                    trendDetails = `今日 ${todayGames} 場 vs 昨日 ${yesterdayGames} 場 (+${increase}%)`;
                } else if (todayGames < yesterdayGames) {
                    const decrease = Math.round(((yesterdayGames - todayGames) / yesterdayGames) * 100);
                    trendStatus = 'warning';
                    trendValue = '下降趨勢';
                    trendDetails = `今日 ${todayGames} 場 vs 昨日 ${yesterdayGames} 場 (-${decrease}%)`;
                } else {
                    trendStatus = 'info';
                    trendValue = '持平';
                    trendDetails = `今日 ${todayGames} 場 vs 昨日 ${yesterdayGames} 場 (0%)`;
                }

                statusChecks.push({
                    label: '使用趨勢',
                    status: trendStatus,
                    value: trendValue,
                    details: trendDetails
                });
            } catch (error) {
                statusChecks.push({
                    label: '使用趨勢',
                    status: 'error',
                    value: '分析失敗',
                    details: `錯誤: ${error.message}`
                });
            }

            // 11. Check Peak Usage Times
            try {
                const hourStats = new Array(24).fill(0);
                allScores.forEach(score => {
                    const hour = score.timestamp.getHours();
                    hourStats[hour]++;
                });

                const peakHour = hourStats.indexOf(Math.max(...hourStats));
                const peakGames = hourStats[peakHour];

                if (peakGames > 0) {
                    statusChecks.push({
                        label: '高峰使用時段',
                        status: 'info',
                        value: `${peakHour}:00`,
                        details: `該時段有 ${peakGames} 場遊戲，為最活躍時段`
                    });
                } else {
                    statusChecks.push({
                        label: '高峰使用時段',
                        status: 'info',
                        value: '無數據',
                        details: '尚未有足夠的遊戲記錄來分析使用時段'
                    });
                }
            } catch (error) {
                statusChecks.push({
                    label: '高峰使用時段',
                    status: 'error',
                    value: '分析失敗',
                    details: `錯誤: ${error.message}`
                });
            }

            // 12. Check Average Session Duration
            try {
                const sessionsWithTime = allScores.filter(score => score.gameTime && score.gameTime > 0);

                if (sessionsWithTime.length > 0) {
                    const avgSessionTime = sessionsWithTime.reduce((sum, score) => sum + score.gameTime, 0) / sessionsWithTime.length;
                    const avgMinutes = Math.round(avgSessionTime / 60 * 10) / 10;

                    let sessionStatus, sessionValue;
                    if (avgMinutes < 2) {
                        sessionStatus = 'warning';
                        sessionValue = '較短';
                    } else if (avgMinutes < 5) {
                        sessionStatus = 'success';
                        sessionValue = '正常';
                    } else {
                        sessionStatus = 'info';
                        sessionValue = '較長';
                    }

                    statusChecks.push({
                        label: '平均遊戲時長',
                        status: sessionStatus,
                        value: sessionValue,
                        details: `平均 ${avgMinutes} 分鐘 (基於 ${sessionsWithTime.length} 場遊戲)`
                    });
                } else {
                    statusChecks.push({
                        label: '平均遊戲時長',
                        status: 'info',
                        value: '無數據',
                        details: '沒有記錄遊戲時長的數據'
                    });
                }
            } catch (error) {
                statusChecks.push({
                    label: '平均遊戲時長',
                    status: 'error',
                    value: '分析失敗',
                    details: `錯誤: ${error.message}`
                });
            }

            // Calculate summary statistics
            const successCount = statusChecks.filter(check => check.status === 'success').length;
            const errorCount = statusChecks.filter(check => check.status === 'error').length;
            const warningCount = statusChecks.filter(check => check.status === 'warning').length;
            const infoCount = statusChecks.filter(check => check.status === 'info').length;

            const overallStatus = errorCount > 0 ? 'error' : warningCount > 0 ? 'warning' : 'success';
            const overallValue = errorCount > 0 ? '系統異常' : warningCount > 0 ? '系統警告' : '系統正常';

            // Create status table with same style as scores table
            let statusHTML = `
                <table class="scores-table">
                    <thead>
                        <tr>
                            <th>檢查項目</th>
                            <th>狀態</th>
                            <th>詳細資訊</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            statusChecks.forEach(check => {
                statusHTML += `
                    <tr>
                        <td><strong>${check.label}</strong></td>
                        <td><span class="status-badge status-badge-${check.status}">${check.value}</span></td>
                        <td>${check.details}</td>
                    </tr>
                `;
            });

            statusHTML += '</tbody></table>';

            // Add summary statistics at the top (similar to stats-grid)
            const summaryHTML = `
                <div class="stats-grid" style="margin-bottom: 30px;">
                    <div class="stat-card">
                        <div class="stat-number" style="color: #28a745;">${successCount}</div>
                        <div class="stat-label">成功項目</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #ffc107;">${warningCount}</div>
                        <div class="stat-label">警告項目</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #dc3545;">${errorCount}</div>
                        <div class="stat-label">錯誤項目</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #17a2b8;">${infoCount}</div>
                        <div class="stat-label">資訊項目</div>
                    </div>
                </div>
                <div style="margin-bottom: 20px; padding: 15px; background: #000000; border-radius: 10px; border-left: 4px solid #667eea;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <h3 style="margin: 0; color: #00FFFF;">整體系統狀態</h3>
                        <span class="status-badge status-badge-${overallStatus}" style="font-size: 1em; padding: 8px 16px;">${overallValue}</span>
                    </div>
                </div>
            `;

            container.innerHTML = summaryHTML + statusHTML;
        }

        // Modal System Status Check function (for button click)
        async function checkSystemStatus() {
            const modal = document.getElementById('statusModal');
            const content = document.getElementById('statusContent');

            modal.style.display = 'block';
            content.innerHTML = '<div class="loading">🔍 正在進行全面系統檢查...</div>';

            // Use the same logic as inline function
            await checkSystemStatusInline();

            // Copy the content to modal
            const inlineContent = document.getElementById('systemStatusContainer').innerHTML;
            content.innerHTML = inlineContent;
        }

        function closeStatusModal() {
            document.getElementById('statusModal').style.display = 'none';
        }

        // Close modal when clicking outside
        window.onclick = function (event) {
            const statusModal = document.getElementById('statusModal');
            const legendModal = document.getElementById('legendModal');

            if (event.target === statusModal) {
                closeStatusModal();
            }
            if (event.target === legendModal) {
                closeLegendModal();
            }
        }

        // Real-time monitoring variables
        let monitoringInterval = null;
        let isMonitoring = false;

        // Real-time monitoring function
        function startRealTimeMonitoring() {
            const monitorBtn = document.getElementById('monitorBtn');

            if (!isMonitoring) {
                // Start monitoring
                isMonitoring = true;
                monitorBtn.textContent = '⏹️ 停止實時監測';
                monitorBtn.style.background = '#dc3545';

                // Set up interval for real-time updates (every 30 seconds)
                monitoringInterval = setInterval(() => {
                    loadScores().then(() => {
                        // Update statistics and system status
                        updateStatistics();
                        displayScores();
                        checkSystemStatusInline();
                    });
                }, 30000); // 30 seconds

                // Show notification
                showNotification('實時監測已啟動', '系統將每30秒自動更新數據', 'success');
            } else {
                // Stop monitoring
                isMonitoring = false;
                monitorBtn.textContent = '📡 開始實時監測';
                monitorBtn.style.background = '#28a745';

                if (monitoringInterval) {
                    clearInterval(monitoringInterval);
                    monitoringInterval = null;
                }

                // Show notification
                showNotification('實時監測已停止', '系統狀態監測已關閉', 'info');
            }
        }

        // Show status legend function
        function showStatusLegend() {
            const modal = document.getElementById('legendModal');
            modal.style.display = 'block';
        }

        // Close legend modal function
        function closeLegendModal() {
            document.getElementById('legendModal').style.display = 'none';
        }

        // Notification function
        function showNotification(title, message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#d4edda' : type === 'error' ? '#f8d7da' : '#d1ecf1'};
                color: ${type === 'success' ? '#155724' : type === 'error' ? '#721c24' : '#0c5460'};
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 10001;
                max-width: 300px;
                font-family: Arial, sans-serif;
                border-left: 4px solid ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : '#17a2b8'};
            `;

            notification.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 5px;">${title}</div>
                <div style="font-size: 0.9em;">${message}</div>
            `;

            document.body.appendChild(notification);

            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 5000);
        }

        // Export to Excel function
        function exportToExcel() {
            try {
                // Get current filtered scores
                const gameFilter = document.getElementById('gameFilter').value;
                const statusFilter = document.getElementById('statusFilter').value;
                const playerFilter = document.getElementById('playerFilter').value.toLowerCase();

                let filteredScores = allScores.filter(score => {
                    const matchGame = !gameFilter || score.gameId === gameFilter;
                    const matchStatus = !statusFilter || score.status === statusFilter;
                    const playerName = score.playerName || score.userID || '匿名玩家';
                    const matchPlayer = !playerFilter || playerName.toLowerCase().includes(playerFilter);
                    return matchGame && matchStatus && matchPlayer;
                });

                if (filteredScores.length === 0) {
                    alert('沒有數據可以導出！');
                    return;
                }

                // Prepare data for Excel
                const excelData = filteredScores.map(score => {
                    let timestamp;
                    try {
                        timestamp = score.timestamp && typeof score.timestamp.toLocaleString === 'function'
                            ? score.timestamp.toLocaleString('zh-TW')
                            : 'N/A';
                    } catch (error) {
                        timestamp = 'N/A';
                    }

                    const playerName = score.playerName || score.userID || '匿名玩家';
                    return {
                        '玩家名稱': playerName,
                        '遊戲': score.gameId ? `遊戲 ${score.gameId.replace('game', '')}` : '未知遊戲',
                        '分數': score.score || 0,
                        '狀態': score.status === 'win' ? '勝利' : '失敗',
                        '遊戲時間(秒)': score.gameTime ? Math.round(score.gameTime) : 'N/A',
                        '總分': score.totalScore || score.score || 0,
                        '時間戳': timestamp
                    };
                });

                // Create workbook and worksheet
                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.json_to_sheet(excelData);

                // Set column widths
                const colWidths = [
                    { wch: 15 }, // 玩家名稱
                    { wch: 10 }, // 遊戲
                    { wch: 8 },  // 分數
                    { wch: 8 },  // 狀態
                    { wch: 12 }, // 遊戲時間
                    { wch: 8 },  // 總分
                    { wch: 20 }  // 時間戳
                ];
                ws['!cols'] = colWidths;

                // Add worksheet to workbook
                XLSX.utils.book_append_sheet(wb, ws, '玩家分數統計');

                // Generate filename with current date
                const now = new Date();
                const dateStr = now.getFullYear() +
                    String(now.getMonth() + 1).padStart(2, '0') +
                    String(now.getDate()).padStart(2, '0') + '_' +
                    String(now.getHours()).padStart(2, '0') +
                    String(now.getMinutes()).padStart(2, '0');

                const filename = `STEM-by-ME_玩家分數統計_${dateStr}.xlsx`;

                // Export the file
                XLSX.writeFile(wb, filename);

                // Show success message
                alert(`✅ Excel 文件已成功導出！\n文件名：${filename}\n記錄數：${filteredScores.length} 筆`);

            } catch (error) {
                console.error('Export to Excel error:', error);
                alert('❌ 導出 Excel 時發生錯誤：' + error.message);
            }
        }

        // Admin Panel Toggle Function
        document.addEventListener('DOMContentLoaded', function () {
            const adminToggle = document.getElementById('admin-toggle');
            const adminPanel = document.getElementById('admin-panel');

            if (adminToggle && adminPanel) {
                adminToggle.addEventListener('click', function () {
                    if (adminPanel.style.display === 'none' || adminPanel.style.display === '') {
                        adminPanel.style.display = 'block';
                        adminToggle.classList.add('active');
                        adminToggle.textContent = '🔧 隱藏管理員面板';
                    } else {
                        adminPanel.style.display = 'none';
                        adminToggle.classList.remove('active');
                        adminToggle.textContent = '🔧 管理員面板';
                    }
                });
            }

            // Initialize admin panel functionality only if authenticated
            if (isAuthenticated) {
                initializeAdminPanel();
            }
        });

        // Initialize Admin Panel
        function initializeAdminPanel() {
            console.log('Initializing admin panel...');

            // Load admin stats
            loadAdminStats();

            // Load winners list
            loadWinnersList();

            // Load all photos
            loadAllPhotos();

            // Set up event listeners
            setupAdminEventListeners();
        }

        // Load Admin Stats
        function loadAdminStats() {
            try {
                // Update total users
                const uniqueUsers = new Set(allScores.map(score => score.playerName || score.userID || '匿名玩家')).size;
                document.getElementById('total-users').textContent = uniqueUsers;

                // Update active users (last 30 minutes)
                const recentScores = allScores.filter(score => {
                    const scoreTime = score.timestamp.getTime();
                    const timeDiff = Date.now() - scoreTime;
                    return timeDiff < 30 * 60 * 1000;
                });
                const activeUsers = new Set(recentScores.map(score => score.playerName || score.userID || '匿名玩家')).size;
                document.getElementById('active-users').textContent = activeUsers;

                // Update completed users (users who have won at least one game)
                const usersWithWins = new Set(allScores.filter(score => score.status === 'win').map(score => score.playerName || score.userID || '匿名玩家')).size;
                document.getElementById('completed-users').textContent = usersWithWins;

                // Update total score
                const totalScore = allScores.reduce((sum, score) => sum + (score.score || 0), 0);
                document.getElementById('total-score').textContent = totalScore;

            } catch (error) {
                console.error('Error loading admin stats:', error);
            }
        }

        // Load Winners List
        function loadWinnersList() {
            try {
                const winnersList = document.getElementById('winners-list');
                if (!winnersList) return;

                if (allScores.length === 0) {
                    winnersList.innerHTML = '<div class="no-photos">暫無排行榜數據</div>';
                    return;
                }

                // Get top 5 players by score
                const playerScores = {};
                allScores.forEach(score => {
                    const playerName = score.playerName || score.userID || '匿名玩家';
                    if (!playerScores[playerName]) {
                        playerScores[playerName] = {
                            totalScore: 0,
                            gameCount: 0,
                            winCount: 0
                        };
                    }
                    playerScores[playerName].totalScore += score.score || 0;
                    playerScores[playerName].gameCount++;
                    if (score.status === 'win') {
                        playerScores[playerName].winCount++;
                    }
                });

                const topPlayers = Object.entries(playerScores)
                    .sort(([, a], [, b]) => b.totalScore - a.totalScore)
                    .slice(0, 5);

                let winnersHTML = '';
                topPlayers.forEach(([playerName, stats], index) => {
                    const rank = index + 1;
                    const winRate = stats.gameCount > 0 ? Math.round((stats.winCount / stats.gameCount) * 100) : 0;

                    // Get player's latest game info for display
                    const playerLatestGame = allScores
                        .filter(score => (score.playerName || score.userID || '匿名玩家') === playerName)
                        .sort((a, b) => b.timestamp - a.timestamp)[0];

                    const latestGameType = playerLatestGame ? (playerLatestGame.gameType || '未知遊戲類型') : '未知遊戲類型';
                    const latestLocation = playerLatestGame ? (playerLatestGame.locationName || '未知位置') : '未知位置';
                    const latestLocationCode = playerLatestGame ? (playerLatestGame.locationCode || '未知代碼') : '未知代碼';

                    winnersHTML += `
                        <div class="winner-card">
                            <div class="rank-badge rank-${rank}">${rank}</div>
                            <div class="winner-photo">👤</div>
                            <div class="winner-info">
                                <h4>玩家編號: ${playerLatestGame ? playerLatestGame.userID : '未知'}</h4>
                                <p>遊戲次數: ${stats.gameCount}</p>
                                <p>勝利次數: ${stats.winCount} (${winRate}%)</p>
                                <p class="latest-game">最新遊戲: ${latestGameType}</p>
                                <p class="latest-location">最新位置: ${latestLocation} (${latestLocationCode})</p>
                                <div class="winner-score">${stats.totalScore} 分</div>
                            </div>
                        </div>
                    `;
                });

                winnersList.innerHTML = winnersHTML;

            } catch (error) {
                console.error('Error loading winners list:', error);
                const winnersList = document.getElementById('winners-list');
                if (winnersList) {
                    winnersList.innerHTML = '<div class="no-photos">載入排行榜時發生錯誤</div>';
                }
            }
        }

        // Load All Photos
        function loadAllPhotos() {
            try {
                const photosGrid = document.getElementById('all-photos-grid');
                if (!photosGrid) return;

                if (allPhotos.length === 0) {
                    photosGrid.innerHTML = '<div class="no-photos">暫無照片數據</div>';
                    return;
                }

                // Sort photos based on selected order
                const sortOrder = document.getElementById('sort-order').value;
                let sortedPhotos = [...allPhotos];

                switch (sortOrder) {
                    case 'newest':
                        sortedPhotos.sort((a, b) => b.timestamp - a.timestamp);
                        break;
                    case 'oldest':
                        sortedPhotos.sort((a, b) => a.timestamp - b.timestamp);
                        break;
                    case 'score-high':
                        sortedPhotos.sort((a, b) => (b.approvedScore || 0) - (a.approvedScore || 0));
                        break;
                    case 'score-low':
                        sortedPhotos.sort((a, b) => (a.approvedScore || 0) - (b.approvedScore || 0));
                        break;
                    case 'high-to-low':
                        sortedPhotos.sort((a, b) => (b.size || 0) - (a.size || 0));
                        break;
                    case 'low-to-high':
                        sortedPhotos.sort((a, b) => (a.size || 0) - (b.size || 0));
                        break;
                }

                let photosHTML = '';
                sortedPhotos.forEach(photo => {
                    const timestamp = photo.timestamp ? photo.timestamp.toLocaleString('zh-TW') : 'N/A';
                    const size = photo.size ? `${Math.round(photo.size / 1024)} KB` : 'N/A';
                    const userID = photo.userID || '未知用戶';
                    const locationCode = photo.locationCode || '未知位置';
                    const locationName = photo.locationName || '未知位置名稱';
                    const gameType = photo.gameType || '未知遊戲類型';
                    const locationDescription = photo.locationDescription || '無描述';
                    const locationAddress = photo.locationAddress || '無地址';
                    const locationCategory = photo.locationCategory || '未知類別';
                    const approvedScore = photo.approvedScore || 0;
                    const reviewedAt = photo.reviewedAt ? (typeof photo.reviewedAt.toDate === 'function' ? photo.reviewedAt.toDate().toLocaleString('zh-TW') : photo.reviewedAt.toLocaleString('zh-TW')) : 'N/A';
                    const reviewedBy = photo.reviewedBy || 'admin';

                    photosHTML += `
                        <div class="photo-card approved-photo">
                            <div class="photo-image-container">
                                ${photo.dataURL ?
                            `<img src="${photo.dataURL}" alt="照片" class="photo-image">` :
                            `<div class="photo-image-placeholder">
                                        <div class="photo-icon">📸</div>
                                        <div class="photo-filename">無圖片數據</div>
                                    </div>`
                        }
                            </div>
                            <div class="photo-info">
                                <div class="photo-filename-display">${locationCode} - ${locationName}</div>
                                <div class="photo-user">用戶: ${userID}</div>
                                <div class="photo-game-type">遊戲類型: ${gameType}</div>
                                <div class="photo-approval-info">
                                    <div class="approval-badge">✅ 已批准</div>
                                    <div class="approved-score">批准分數: ${approvedScore}分</div>
                                    <div class="reviewed-by">審核者: ${reviewedBy}</div>
                                    <div class="reviewed-at">審核時間: ${reviewedAt}</div>
                                </div>
                                <div class="photo-location-details">
                                    <div>地址: ${locationAddress}</div>
                                    <div>類別: ${locationCategory}</div>
                                    <div>描述: ${locationDescription}</div>
                                </div>
                                <div class="photo-timestamp">上傳時間: ${timestamp}</div>
                                <div class="photo-size">大小: ${size}</div>
                            </div>
                        </div>
                    `;
                });

                photosGrid.innerHTML = photosHTML;

            } catch (error) {
                console.error('Error loading photos:', error);
                const photosGrid = document.getElementById('all-photos-grid');
                if (photosGrid) {
                    photosGrid.innerHTML = '<div class="no-photos">載入照片時發生錯誤</div>';
                }
            }
        }

        // Setup Admin Event Listeners
        function setupAdminEventListeners() {
            // Refresh photos button
            const refreshPhotosBtn = document.getElementById('refresh-photos');
            if (refreshPhotosBtn) {
                refreshPhotosBtn.addEventListener('click', function () {
                    loadAllPhotos();
                    showNotification('照片已重新載入', '照片列表已更新', 'success');
                });
            }

            // Export data button
            const exportDataBtn = document.getElementById('export-data');
            if (exportDataBtn) {
                exportDataBtn.addEventListener('click', function () {
                    exportToExcel();
                });
            }

            // Export users button
            const exportUsersBtn = document.getElementById('export-users');
            if (exportUsersBtn) {
                exportUsersBtn.addEventListener('click', function () {
                    exportUsersToExcel();
                });
            }

            // Reset all users button
            const resetUsersBtn = document.getElementById('reset-all-users');
            if (resetUsersBtn) {
                resetUsersBtn.addEventListener('click', function () {
                    if (confirm('確定要重置所有玩家數據嗎？此操作不可撤銷！')) {
                        resetAllUsers();
                    }
                });
            }

            // Clear all photos button
            const clearPhotosBtn = document.getElementById('clear-all-photos');
            if (clearPhotosBtn) {
                clearPhotosBtn.addEventListener('click', function () {
                    if (confirm('確定要清除所有照片嗎？此操作不可撤銷！')) {
                        clearAllPhotos();
                    }
                });
            }

            // User search functionality
            const searchUserBtn = document.getElementById('search-user-btn');
            const userSearchInput = document.getElementById('user-search-input');

            if (searchUserBtn && userSearchInput) {
                searchUserBtn.addEventListener('click', function () {
                    searchUser(userSearchInput.value);
                });

                userSearchInput.addEventListener('keypress', function (e) {
                    if (e.key === 'Enter') {
                        searchUser(userSearchInput.value);
                    }
                });
            }

            // Update user points button
            const updatePointsBtn = document.getElementById('update-user-points-btn');
            if (updatePointsBtn) {
                updatePointsBtn.addEventListener('click', function () {
                    updateUserPoints();
                });
            }

            // Sort order change
            const sortOrderSelect = document.getElementById('sort-order');
            if (sortOrderSelect) {
                sortOrderSelect.addEventListener('change', function () {
                    loadAllPhotos();
                });
            }
        }

        // Export Users to Excel
        function exportUsersToExcel() {
            try {
                const uniqueUsers = new Set(allScores.map(score => score.playerName || score.userID || '匿名玩家'));
                const userData = Array.from(uniqueUsers).map(userName => {
                    const userScores = allScores.filter(score => (score.playerName || score.userID || '匿名玩家') === userName);
                    const totalScore = userScores.reduce((sum, score) => sum + (score.score || 0), 0);
                    const winCount = userScores.filter(score => score.status === 'win').length;
                    const totalGames = userScores.length;
                    const winRate = totalGames > 0 ? Math.round((winCount / totalGames) * 100) : 0;

                    return {
                        '玩家名稱': userName,
                        '總分數': totalScore,
                        '遊戲次數': totalGames,
                        '勝利次數': winCount,
                        '勝率': `${winRate}%`,
                        '最後遊戲時間': userScores.length > 0 ? userScores[0].timestamp.toLocaleString('zh-TW') : 'N/A'
                    };
                });

                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.json_to_sheet(userData);
                XLSX.utils.book_append_sheet(wb, ws, '玩家統計');

                const now = new Date();
                const dateStr = now.getFullYear() +
                    String(now.getMonth() + 1).padStart(2, '0') +
                    String(now.getDate()).padStart(2, '0') + '_' +
                    String(now.getHours()).padStart(2, '0') +
                    String(now.getMinutes()).padStart(2, '0');

                const filename = `STEM-by-ME_玩家統計_${dateStr}.xlsx`;
                XLSX.writeFile(wb, filename);

                alert(`✅ 玩家統計已成功導出！\n文件名：${filename}\n玩家數：${userData.length} 人`);

            } catch (error) {
                console.error('Export users error:', error);
                alert('❌ 導出玩家統計時發生錯誤：' + error.message);
            }
        }

        // Reset All Users
        async function resetAllUsers() {
            try {
                console.log('🔄 Starting reset all users...');

                // 詳細的 Firebase 連接檢查
                if (!checkFirebaseConnection()) {
                    showNotification('重置失敗', 'Firebase 未連接，請檢查網絡連接和 Firebase 配置', 'error');
                    return;
                }

                if (!confirm('確定要重置所有玩家數據嗎？此操作不可撤銷！\n\n這將清除：\n• 所有遊戲分數記錄\n• 所有玩家統計數據\n• 排行榜數據\n• 所有完成位置記錄\n• 本地存儲的進度數據')) {
                    return;
                }

                showNotification('重置中', '正在清除所有玩家數據...', 'info');

                console.log('📊 Fetching gameScores collection...');
                // 清除 gameScores 集合中的所有數據
                const scoresSnapshot = await window.db.collection('gameScores').get();
                console.log(`📊 Found ${scoresSnapshot.size} score records`);

                const deletePromises = scoresSnapshot.docs.map(doc => doc.ref.delete());
                await Promise.all(deletePromises);
                console.log('✅ All score records deleted');

                console.log('📸 Fetching photos collection...');
                // 清除 photos 集合中的所有數據
                const photosSnapshot = await window.db.collection('photos').get();
                console.log(`📸 Found ${photosSnapshot.size} photo records`);

                const deletePhotoPromises = photosSnapshot.docs.map(doc => doc.ref.delete());
                await Promise.all(deletePhotoPromises);
                console.log('✅ All photo records deleted');

                // 清除所有用戶的 localStorage 中的位置數據
                console.log('🗂️ Clearing localStorage location data...');
                clearAllUsersLocationData();
                console.log('✅ All users location data cleared from localStorage');

                // 重置本地數據
                allScores = [];
                allPhotos = [];
                console.log('🔄 Local data arrays reset');

                // 更新顯示
                updateStatistics();
                displayScores();
                loadAllPhotos();
                loadWinnersList();
                console.log('🔄 All displays updated');

                showNotification('重置成功', `已清除 ${scoresSnapshot.size} 條分數記錄、${photosSnapshot.size} 張照片和所有位置進度`, 'success');

                console.log(`✅ 重置完成：清除 ${scoresSnapshot.size} 條分數記錄，${photosSnapshot.size} 張照片，所有位置進度`);

            } catch (error) {
                console.error('❌ Reset users error:', error);
                showNotification('重置失敗', '重置玩家數據時發生錯誤：' + error.message, 'error');
            }
        }

        // Clear All Photos
        async function clearAllPhotos() {
            try {
                console.log('🗑️ Starting clear all photos...');

                // 詳細的 Firebase 連接檢查
                if (!checkFirebaseConnection()) {
                    showNotification('清除失敗', 'Firebase 未連接，請檢查網絡連接和 Firebase 配置', 'error');
                    return;
                }

                if (!confirm('確定要清除所有照片嗎？此操作不可撤銷！\n\n這將清除：\n• 所有上傳的照片\n• 照片相關的統計數據\n• 所有完成位置記錄')) {
                    return;
                }

                showNotification('清除中', '正在清除所有照片...', 'info');

                console.log('📸 Fetching photos collection...');
                // 清除 photos 集合中的所有數據
                const photosSnapshot = await window.db.collection('photos').get();
                console.log(`📸 Found ${photosSnapshot.size} photo records`);

                const deletePromises = photosSnapshot.docs.map(doc => doc.ref.delete());
                await Promise.all(deletePromises);
                console.log('✅ All photo records deleted');

                // 清除所有用戶的 localStorage 中的位置數據
                console.log('🗂️ Clearing localStorage location data...');
                clearAllUsersLocationData();
                console.log('✅ All users location data cleared from localStorage');

                // 重置本地照片數據
                allPhotos = [];
                console.log('🔄 Local photos array reset');

                // 更新顯示
                loadAllPhotos();
                updateStatistics();
                console.log('🔄 Photo displays updated');

                showNotification('清除成功', `已清除 ${photosSnapshot.size} 張照片和所有位置進度`, 'success');

                console.log(`✅ 照片清除完成：清除 ${photosSnapshot.size} 張照片，所有位置進度`);

            } catch (error) {
                console.error('❌ Clear photos error:', error);
                showNotification('清除失敗', '清除照片時發生錯誤：' + error.message, 'error');
            }
        }

        // Function to clear all users' location data from localStorage
        function clearAllUsersLocationData() {
            try {
                console.log('🗂️ Starting to clear all users location data from localStorage...');

                // Get all users from localStorage
                const allUsers = JSON.parse(localStorage.getItem('scavengerHuntUsers') || '{}');
                let clearedCount = 0;

                // Clear completedLocations and totalScore for each user
                Object.keys(allUsers).forEach(userId => {
                    if (allUsers[userId]) {
                        // Reset user's progress data
                        allUsers[userId].completedLocations = [];
                        allUsers[userId].totalScore = 0;
                        allUsers[userId].lastPlayed = null;
                        clearedCount++;
                        console.log(`🔄 Cleared location data for user ${userId}`);
                    }
                });

                // Save updated users data back to localStorage
                localStorage.setItem('scavengerHuntUsers', JSON.stringify(allUsers));
                console.log(`✅ Cleared location data for ${clearedCount} users`);

                // Also clear current user's data if exists
                const currentUser = localStorage.getItem('currentUser');
                if (currentUser) {
                    console.log(`🔄 Clearing current user ${currentUser} location data`);
                    // Clear current user's completed locations and total score
                    if (window.loginSystem) {
                        window.loginSystem.setCompletedLocations([]);
                        window.loginSystem.setTotalScore(0);
                    }
                }

                // Clear any other location-related data
                localStorage.removeItem('loginRedirectFlag');
                localStorage.removeItem('loginTimestamp');

                // Try to clear game.html progress items if the page is open
                try {
                    if (window.clearAllProgressItems && typeof window.clearAllProgressItems === 'function') {
                        console.log('🔄 Calling game.html clearAllProgressItems function...');
                        window.clearAllProgressItems();
                    } else {
                        console.log('ℹ️ game.html clearAllProgressItems function not available');
                    }
                } catch (error) {
                    console.log('ℹ️ Could not call game.html clearAllProgressItems function:', error.message);
                }

                // Dispatch a custom event to notify other pages about the reset
                window.dispatchEvent(new CustomEvent('allDataReset', {
                    detail: {
                        timestamp: new Date().toISOString(),
                        clearedUsers: clearedCount
                    }
                }));

                console.log('✅ All location data cleared from localStorage');

            } catch (error) {
                console.error('❌ Error clearing location data:', error);
                throw error;
            }
        }



        // Search User
        function searchUser(userId) {
            try {
                const userDetails = document.getElementById('user-details');
                const selectedUserName = document.getElementById('selected-user-name');
                const userCompletedCount = document.getElementById('user-completed-count');
                const userCurrentScore = document.getElementById('user-current-score');

                if (!userId.trim()) {
                    alert('請輸入玩家編號');
                    return;
                }

                const userScores = allScores.filter(score => (score.playerName || score.userID || '匿名玩家') === userId);

                if (userScores.length === 0) {
                    alert('找不到該玩家');
                    return;
                }

                const totalScore = userScores.reduce((sum, score) => sum + (score.score || 0), 0);
                const completedCount = userScores.filter(score => score.status === 'win').length;

                selectedUserName.textContent = `玩家: ${userId}`;
                userCompletedCount.textContent = completedCount;
                userCurrentScore.textContent = totalScore;

                userDetails.style.display = 'block';
                showNotification('玩家搜尋成功', `找到玩家 ${userId} 的數據`, 'success');

            } catch (error) {
                console.error('Search user error:', error);
                showNotification('搜尋失敗', '搜尋玩家時發生錯誤', 'error');
            }
        }

        // Update User Points
        function updateUserPoints() {
            try {
                const pointsInput = document.getElementById('user-points-input');
                const newPoints = parseInt(pointsInput.value);

                if (isNaN(newPoints) || newPoints < 0) {
                    alert('請輸入有效的分數');
                    return;
                }

                // This would normally update points in Firebase
                // For now, just show a notification
                showNotification('更新功能', '更新分數功能需要 Firebase 整合', 'info');

            } catch (error) {
                console.error('Update points error:', error);
                showNotification('更新失敗', '更新分數時發生錯誤', 'error');
            }
        }

        // Test Photo Upload
        function testPhotoUpload() {
            showNotification('測試功能', '照片上傳測試功能需要 Firebase 整合', 'info');
        }

        // Create Test Photo
        function createTestPhoto() {
            showNotification('測試功能', '創建測試照片功能需要 Firebase 整合', 'info');
        }

        // Function to approve all pending photos
        async function approveAllPendingPhotos() {
            try {
                if (!db) {
                    showNotification('Firebase 數據庫未初始化', 'error');
                    return;
                }

                // Confirm action
                const confirmed = confirm('⚠️ 確定要批量批准所有待審核的照片嗎？\n\n此操作將：\n• 批准所有狀態為 "pending" 的照片\n• 為每個玩家添加相應的分數\n• 無法撤銷此操作\n\n點擊 "確定" 繼續，或 "取消" 中止操作。');

                if (!confirmed) {
                    showNotification('操作已取消', 'info');
                    return;
                }

                console.log('🚀 Starting batch approval of all pending photos...');

                // Get all pending photos
                const pendingPhotosSnapshot = await db.collection('reviewPhotos')
                    .where('status', '==', 'pending')
                    .get();

                if (pendingPhotosSnapshot.empty) {
                    showNotification('📸 沒有找到待審核的照片', 'info');
                    return;
                }

                console.log(`📊 Found ${pendingPhotosSnapshot.size} pending photos to approve`);

                let successCount = 0;
                let errorCount = 0;
                const errors = [];

                // Process each pending photo
                for (const doc of pendingPhotosSnapshot.docs) {
                    try {
                        const photoData = doc.data();
                        const photoId = doc.id;
                        const userId = photoData.userID;
                        const suggestedScore = photoData.suggestedScore || 80; // Default score for 趣味親子打卡

                        console.log(`✅ Approving photo ${photoId} for user ${userId} with score ${suggestedScore}`);

                        // Update photo status to approved
                        await db.collection('reviewPhotos').doc(photoId).update({
                            status: 'approved',
                            approvedScore: suggestedScore,
                            reviewedAt: new Date(),
                            reviewedBy: 'admin_batch'
                        });

                        // Add score to user's total score
                        const userRef = db.collection('users').doc(userId);
                        const userDoc = await userRef.get();

                        if (userDoc.exists) {
                            const userData = userDoc.data();
                            const newTotalScore = (userData.totalScore || 0) + suggestedScore;

                            await userRef.update({
                                totalScore: newTotalScore,
                                lastUpdated: new Date()
                            });
                        }

                        // Create a score record
                        await db.collection('gameScores').add({
                            playerName: `玩家${userId}`,
                            userID: userId,
                            gameId: 'photo_review_batch_approved',
                            score: suggestedScore,
                            totalScore: suggestedScore,
                            status: 'win',
                            timestamp: new Date(),
                            gameType: '批量人工審核加分',
                            locationCode: photoData.locationCode || 'PHOTO_REVIEW',
                            locationName: photoData.locationName || '照片批量審核通過',
                            reviewNote: '管理員批量審核通過'
                        });

                        successCount++;
                        console.log(`✅ Successfully approved photo ${photoId}`);

                    } catch (error) {
                        errorCount++;
                        const errorMsg = `照片 ${doc.id}: ${error.message}`;
                        errors.push(errorMsg);
                        console.error(`❌ Error approving photo ${doc.id}:`, error);
                    }
                }

                // Show results
                let resultMessage = `✅ 批量審核完成！\n\n`;
                resultMessage += `📊 成功批准: ${successCount} 張照片\n`;

                if (errorCount > 0) {
                    resultMessage += `❌ 失敗: ${errorCount} 張照片\n`;
                    resultMessage += `\n錯誤詳情:\n${errors.join('\n')}`;
                }

                console.log(resultMessage);
                showNotification(resultMessage, errorCount > 0 ? 'warning' : 'success');

                // Refresh the review photos display
                loadReviewPhotos();

            } catch (error) {
                console.error('❌ Error in batch approval:', error);
                showNotification(`批量審核時發生錯誤: ${error.message}`, 'error');
            }
        }

        // Check Firebase Status
        function checkFirebaseStatus() {
            try {
                const statusDisplay = document.getElementById('firebase-status-display');
                if (statusDisplay) {
                    statusDisplay.innerHTML = `
                        <p>✅ Firebase 連接正常</p>
                        <p>📊 數據庫: stem-by-me-app</p>
                        <p>🔗 項目 ID: stem-by-me-app</p>
                        <p>⏰ 最後檢查: ${new Date().toLocaleString('zh-TW')}</p>
                    `;
                }
            } catch (error) {
                console.error('Firebase status check error:', error);
                const statusDisplay = document.getElementById('firebase-status-display');
                if (statusDisplay) {
                    statusDisplay.innerHTML = `
                        <p>❌ Firebase 連接失敗</p>
                        <p>錯誤: ${error.message}</p>
                    `;
                }
            }
        }


    </script>
</body>

</html>